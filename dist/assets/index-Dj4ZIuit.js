var h=class extends String{constructor(e,n,t){const r=new Uint32Array(e,n,t),s=Array.from(r),i=String.fromCodePoint(...s);super(i)}},A=new TextDecoder("latin1");function g(e){const n=new DataView(e);if(String.fromCharCode(n.getUint8(0),n.getUint8(1),n.getUint8(2),n.getUint8(3),n.getUint8(4),n.getUint8(5))!=="Â“NUMPY")throw new Error("Not an .npy file");const r=n.getUint8(6),s=n.getUint8(7);let i;return r<=1?(i=n.getUint16(8,!0),{headerOffset:10,headerLen:i,version:[r,s]}):(i=Number(n.getUint32(8,!0)),{headerOffset:12,headerLen:i,version:[r,s]})}function d(e){const n=/'descr'\s*:\s*'([^']+)'/.exec(e)?.[1],t=/'fortran_order'\s*:\s*(True|False)/.exec(e)?.[1]==="True",s=(/'shape'\s*:\s*\(([^)]*)\)/.exec(e)?.[1]??"").split(",").map(i=>i.trim()).filter(Boolean).map(i=>Number(i));return s.length===1&&e.includes("(n,)"),{dtype:n,fortranOrder:t,shape:s}}function p(e,n,t,r){const s=e.startsWith("<")||e.startsWith("|"),i=e.substring(e.length-2);if(i[0]==="U"){const o=parseInt(i.substring(1)),a=String(new h(n,t)),c=[];for(let u=0;u<a.length;u+=o)c.push(a.substring(u,u+o).replace(/\0/g,""));return c}switch(i){case"b1":if(s){const o=new Uint8Array(n,t),a=new Array(o.length);for(let c=0;c<o.length;c++)a[c]=o[c]!==0;return a}else return new Uint8Array(n,t);case"i1":return new Int8Array(n,t);case"u1":return new Uint8Array(n,t);case"i2":return new Int16Array(n,t);case"u2":return new Uint16Array(n,t);case"i4":return new Int32Array(n,t);case"u4":return new Uint32Array(n,t);case"i8":return new BigInt64Array(n,t);case"u8":return new BigUint64Array(n,t);case"f4":return new Float32Array(n,t);case"f8":return new Float64Array(n,t);case"f2":{if(r.convertFloat16!==!1){const o=new Uint16Array(n,t),a=new Float32Array(o.length);for(let c=0;c<o.length;c++)a[c]=l(o[c]);return a}return new Uint16Array(n,t)}default:throw new Error(`Unsupported dtype: ${e}`)}}function l(e){const n=(e&32768)>>15,t=(e&31744)>>10,r=e&1023;return t===0?(n?-1:1)*Math.pow(2,-14)*(r/Math.pow(2,10)):t===31?r?NaN:n?-1/0:1/0:(n?-1:1)*Math.pow(2,t-15)*(1+r/Math.pow(2,10))}async function y(e,n={}){let t;typeof e=="string"?t=await(await fetch(e)).arrayBuffer():e instanceof ArrayBuffer?t=e:e instanceof Blob?t=await e.arrayBuffer():t=e.buffer;const{headerOffset:r,headerLen:s}=g(t),i=new Uint8Array(t,r,s),o=A.decode(i).trim(),{dtype:a,fortranOrder:c,shape:u}=d(o);if(!a||!u)throw new Error("Malformed .npy header");const f=r+s;return{data:p(a,t,f,n),shape:u,dtype:a.slice(1),fortranOrder:c}}function U(e){if(e instanceof Uint8Array||e instanceof Uint8ClampedArray)return"u1";if(e instanceof Int8Array)return"i1";if(e instanceof Uint16Array)return"u2";if(e instanceof Int16Array)return"i2";if(e instanceof Uint32Array)return"u4";if(e instanceof Int32Array)return"i4";if(e instanceof Float32Array)return"f4";if(e instanceof BigUint64Array)return"u8";if(e instanceof BigInt64Array)return"i8";if(e instanceof Float64Array)return"f8";const n=typeof e=="object"?e?.constructor?.name:typeof e;throw new TypeError(`Unsupported dtype for ${n}`)}function m(e,n){if(!Array.isArray(n))throw new TypeError("Expected an array");if(e.startsWith("U")){const t=parseInt(e.substring(1)),r=new ArrayBuffer(n.length*t*4),s=new Uint32Array(r);for(let i=0;i<n.length;i++){const o=n[i];for(let a=0;a<t;a++){const c=a<o.length?o.codePointAt(a)??0:0;s[i*t+a]=c}}return new Uint8Array(r)}switch(e){case"b1":return new Uint8Array(n);case"i1":return new Int8Array(n);case"u1":return new Uint8Array(n);case"i2":return new Int16Array(n);case"u2":return new Uint16Array(n);case"i4":return new Int32Array(n);case"u4":return new Uint32Array(n);case"i8":return new BigInt64Array(n);case"u8":return new BigUint64Array(n);case"f4":return new Float32Array(n);case"f8":return new Float64Array(n);default:throw new Error(`Unsupported dtype: ${e}`)}}function I(e){let n=e[0].length;for(let t=1;t<e.length;t++){const r=e[t];typeof r=="string"&&r.length>n&&(n=r.length)}return`U${Math.max(1,n)}`}function b(e){let n=!0,t=!0,r=0;for(const s of e){Number.isInteger(s)||(n=!1),s<0&&(t=!1);const i=Math.abs(s);i>r&&(r=i)}return n?t?r<=255?"u1":r<=65535?"u2":r<=4294967295?"u4":"u8":r<=127?"i1":r<=32767?"i2":r<=2147483647?"i4":"i8":r<=340282347e30?"f4":"f8"}function w(e){if(e.length===0)return"f8";const n=e[0];if(typeof n=="number")return b(e);if(typeof n=="string")return I(e);if(Array.isArray(n))return w(n);if(typeof n=="boolean")return"b1";throw new TypeError("Array elements must be numbers, strings or booleans")}function B(){return new Uint32Array(new Uint8Array([1,0,0,0]).buffer)[0]===1}function F(e,n){const s=`${e=="u1"||e=="i1"?"|":B()?"<":">"}${e}`;let i=n.map(o=>`${o}`).join(",");return n.length===1&&(i+=","),`{'descr':'${s}','fortran_order':False,'shape':(${i})}`}function x(e,n){const t=e instanceof Array?w(e):U(e);e=e instanceof Array?m(t,e):e;let r=F(t,n??[e.length]),s=10+r.length;const i=8-(s+1)%8;r=r+" ".repeat(i)+`
`,s+=i+1;const o=new ArrayBuffer(s+e.byteLength),a=new DataView(o);a.setUint32(0,2471384397,!1),a.setUint32(4,1348010240,!1),a.setUint16(8,r.length,!0);const c=new TextEncoder,u=new Uint8Array(o,10,r.length);return c.encodeInto(r,u),new Uint8Array(o,10+r.length).set(new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),o}var D=class{constructor(e={}){this.opts=e}async load(e){return y(e,this.opts)}static float16ToFloat32(e){return l(e)}dump(e,n){return x(e,n)}};export{m as arrayToTypedArray,D as default,x as dump,w as inferDtypeFromArray,y as load};
