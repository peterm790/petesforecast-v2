const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/geotiff-8Ew76D87.js","assets/index-mSIEmeO2.js","assets/index-Cw5YF5Dn.css"])))=>i.map(i=>d[i]);
import{p as Jt,c as qo,_ as ir}from"./index-mSIEmeO2.js";import{p as nr,J as or,C as H,U as sr,X as rr,F as ar,v as cr,Y as Lt,x as Re,Z as ii,d as it,h as Ko,_ as lr,t as _e,$ as Xo,q as Ae,a0 as ur,O as $i,a1 as zt}from"./deep-equal-D6CKYaOP.js";import{M as Pt,u as dr,g as gr,a as hr,f as fr,m as tn,P as pr,C as bi}from"./collision-filter-extension-CBFjfxVe.js";import{e as vt,k as Ar,T as ki,d as st,P as wt,C as Fe,A as Ot,m as bt,n as ni,o as kt,L as mr,W as en,c as Ii,f as vr}from"./webgl-device-hXSGq3cL.js";const Cr=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,yr=`#version 300 es
${Cr}`;function Er(n){const{input:t,inputChannels:e,output:i}={};if(!t)return yr;if(!e)throw new Error("inputChannels");const o=br(e),s=Ir(t,e);return`#version 300 es
in ${o} ${t};
out vec4 ${i};
void main() {
  ${i} = ${s};
}`}function br(n){switch(n){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${n}`)}}function Ir(n,t){switch(t){case 1:return`vec4(${n}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${n}, 0.0, 1.0)`;case 3:return`vec4(${n}, 1.0)`;case 4:return n;default:throw new Error(`invalid channels: ${t}`)}}const xr=[0,1,1,1],wr=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

out vec4 picking_vRGBcolor_Avalid;

// Normalize unsigned byte color to 0-1 range
vec3 picking_normalizeColor(vec3 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

// Normalize unsigned byte color to 0-1 range
vec4 picking_normalizeColor(vec4 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

bool picking_isColorZero(vec3 color) {
  return dot(color, vec3(1.0)) < 0.00001;
}

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.00001;
}

// Check if this vertex is highlighted 
bool isVertexHighlighted(vec3 vertexColor) {
  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
  return
    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}

// Set the current picking color
void picking_setPickingColor(vec3 pickingColor) {
  pickingColor = picking_normalizeColor(pickingColor);

  if (bool(picking.isActive)) {
    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!bool(picking.isAttribute)) {
      // Stores the picking color so that the fragment shader can render it during picking
      picking_vRGBcolor_Avalid.rgb = pickingColor;
    }
  } else {
    // Do the comparison with selected item color in vertex shader as it should mean fewer compares
    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.r = value;
  }
}

void picking_setPickingAttribute(vec2 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}

void picking_setPickingAttribute(vec3 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,Pr=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

in vec4 picking_vRGBcolor_Avalid;

/*
 * Returns highlight color if this item is selected.
 */
vec4 picking_filterHighlightColor(vec4 color) {
  // If we are still picking, we don't highlight
  if (picking.isActive > 0.5) {
    return color;
  }

  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    // Blend in highlight color based on its alpha value
    float highLightAlpha = picking.highlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 picking_filterPickingColor(vec4 color) {
  if (bool(picking.isActive)) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 picking_filterColor(vec4 color) {
  vec4 highlightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highlightColor);
}
`,nn={props:{},uniforms:{},name:"picking",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:xr},vs:wr,fs:Pr,getUniforms:Tr};function Tr(n={},t){const e={};if(n.highlightedObjectColor!==void 0)if(n.highlightedObjectColor===null)e.isHighlightActive=!1;else{e.isHighlightActive=!0;const i=n.highlightedObjectColor.slice(0,3);e.highlightedObjectColor=i}if(n.highlightColor){const i=Array.from(n.highlightColor,o=>o/255);Number.isFinite(i[3])||(i[3]=1),e.highlightColor=i}return n.isActive!==void 0&&(e.isActive=!!n.isActive,e.isAttribute=!!n.isAttribute),n.useFloatColors!==void 0&&(e.useFloatColors=!!n.useFloatColors),e}const Br=`// Define a structure to hold both the clip-space position and the common position.
struct ProjectResult {
  clipPosition: vec4<f32>,
  commonPosition: vec4<f32>,
};

// This function mimics the GLSL version with the 'out' parameter by returning both values.
fn project_position_to_clipspace_and_commonspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> ProjectResult {
  // Compute the projected position.
  let projectedPosition: vec3<f32> = project_position_vec3_f64(position, position64Low);

  // Start with the provided offset.
  var finalOffset: vec3<f32> = offset;

  // Get whether a rotation is needed and the rotation matrix.
  let rotationResult = project_needs_rotation(projectedPosition);

  // If rotation is needed, update the offset.
  if (rotationResult.needsRotation) {
    finalOffset = rotationResult.transform * offset;
  }

  // Compute the common position.
  let commonPosition: vec4<f32> = vec4<f32>(projectedPosition + finalOffset, 1.0);

  // Convert to clip-space.
  let clipPosition: vec4<f32> = project_common_position_to_clipspace(commonPosition);

  return ProjectResult(clipPosition, commonPosition);
}

// A convenience overload that returns only the clip-space position.
fn project_position_to_clipspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> vec4<f32> {
  return project_position_to_clipspace_and_commonspace(position, position64Low, offset).clipPosition;
}
`,_r=`vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,qt={name:"project32",dependencies:[nr],source:Br,vs:_r},Kt={...nn,defaultUniforms:{...nn.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},on=[0,0,0];function oi(n,t,e=!1){const i=t.projectPosition(n);if(e&&t instanceof cr){const[o,s,r=0]=n,a=t.getDistanceScales([o,s]);i[2]=r*a.unitsPerMeter[2]}return i}function Sr(n){const{viewport:t,modelMatrix:e,coordinateOrigin:i}=n;let{coordinateSystem:o,fromCoordinateSystem:s,fromCoordinateOrigin:r}=n;return o===H.DEFAULT&&(o=t.isGeospatial?H.LNGLAT:H.CARTESIAN),s===void 0&&(s=o),r===void 0&&(r=i),{viewport:t,coordinateSystem:o,coordinateOrigin:i,modelMatrix:e,fromCoordinateSystem:s,fromCoordinateOrigin:r}}function Yo(n,{viewport:t,modelMatrix:e,coordinateSystem:i,coordinateOrigin:o,offsetMode:s}){let[r,a,c=0]=n;switch(e&&([r,a,c]=or([],[r,a,c,1],e)),i){case H.LNGLAT:return oi([r,a,c],t,s);case H.LNGLAT_OFFSETS:return oi([r+o[0],a+o[1],c+(o[2]||0)],t,s);case H.METER_OFFSETS:return oi(sr(o,[r,a,c]),t,s);case H.CARTESIAN:default:return t.isGeospatial?[r+o[0],a+o[1],c+o[2]]:t.projectPosition([r,a,c])}}function Lr(n,t){const{viewport:e,coordinateSystem:i,coordinateOrigin:o,modelMatrix:s,fromCoordinateSystem:r,fromCoordinateOrigin:a}=Sr(t),{autoOffset:c=!0}=t,{geospatialOrigin:l=on,shaderCoordinateOrigin:u=on,offsetMode:d=!1}=c?rr(e,i,o):{},g=Yo(n,{viewport:e,modelMatrix:s,coordinateSystem:r,coordinateOrigin:a,offsetMode:d});if(d){const h=e.projectPosition(l||u);ar(g,g,h)}return g}class Rt{device;model;transformFeedback;static defaultProps={...Pt.defaultProps,outputs:void 0,feedbackBuffers:void 0};static isSupported(t){return t?.info?.type==="webgl"}constructor(t,e=Rt.defaultProps){if(!Rt.isSupported(t))throw new Error("BufferTransform not yet implemented on WebGPU");this.device=t,this.model=new Pt(this.device,{id:e.id||"buffer-transform-model",fs:e.fs||Er(),topology:e.topology||"point-list",varyings:e.outputs||e.varyings,...e}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:e.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(t){t?.inputBuffers&&this.model.setAttributes(t.inputBuffers),t?.outputBuffers&&this.transformFeedback.setBuffers(t.outputBuffers);const e=this.device.beginRenderPass(t);this.model.draw(e),e.end()}getBuffer(t){return this.transformFeedback.getBuffer(t)}readAsync(t){const e=this.getBuffer(t);if(!e)throw new Error("BufferTransform#getBuffer");if(e instanceof Lt)return e.readAsync();const{buffer:i,byteOffset:o=0,byteLength:s=i.byteLength}=e;return i.readAsync(o,s)}}class ue{id;topology;vertexCount;indices;attributes;userData={};constructor(t){const{attributes:e={},indices:i=null,vertexCount:o=null}=t;this.id=t.id||dr("geometry"),this.topology=t.topology,i&&(this.indices=ArrayBuffer.isView(i)?{value:i,size:1}:i),this.attributes={};for(const[s,r]of Object.entries(e)){const a=ArrayBuffer.isView(r)?{value:r}:r;if(!ArrayBuffer.isView(a.value))throw new Error(`${this._print(s)}: must be typed array or object with value as typed array`);if((s==="POSITION"||s==="positions")&&!a.size&&(a.size=3),s==="indices"){if(this.indices)throw new Error("Multiple indices detected");this.indices=a}else this.attributes[s]=a}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=o||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(t){return`Geometry ${this.id} attribute ${t}`}_setAttributes(t,e){return this}_calculateVertexCount(t,e){if(e)return e.value.length;let i=1/0;for(const o of Object.values(t)){const{value:s,size:r,constant:a}=o;!a&&s&&r!==void 0&&r>=1&&(i=Math.min(i,s.length/r))}return i}}function Mr(n){switch(n){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return hr(n)}}const Qr=gr;function me(n,t,e){const i=e==="webgpu"&&t.type==="uint8"?"unorm8":t.type;return{attribute:n,format:t.size>1?`${i}x${t.size}`:t.type,byteOffset:t.offset||0}}function Mt(n){return n.stride||n.size*n.bytesPerElement}function Or(n,t){return n.type===t.type&&n.size===t.size&&Mt(n)===Mt(t)&&(n.offset||0)===(t.offset||0)}function xi(n,t){t.offset&&it.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const e=Mt(n),i=t.vertexOffset!==void 0?t.vertexOffset:n.vertexOffset||0,o=t.elementOffset||0,s=i*e+o*n.bytesPerElement+(n.offset||0);return{...t,offset:s,stride:e}}function Rr(n,t){const e=xi(n,t);return{high:e,low:{...e,offset:e.offset+n.size*4}}}class Fr{constructor(t,e,i){this._buffer=null,this.device=t,this.id=e.id||"",this.size=e.size||1;const o=e.logicalType||e.type,s=o==="float64";let{defaultValue:r}=e;r=Number.isFinite(r)?[r]:r||new Array(this.size).fill(0);let a;s?a="float32":!o&&e.isIndexed?a="uint32":a=o||"float32";let c=Mr(o||a);this.doublePrecision=s,s&&e.fp64===!1&&(c=Float32Array),this.value=null,this.settings={...e,defaultType:c,defaultValue:r,logicalType:o,type:a,normalized:a.includes("norm"),size:this.size,bytesPerElement:c.BYTES_PER_ELEMENT},this.state={...i,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const t=this.getAccessor();return t.vertexOffset?t.vertexOffset*Mt(t):0}get numInstances(){return this.state.numInstances}set numInstances(t){this.state.numInstances=t}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),Re.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(t=this.id,e=null){const i={};if(this.state.constant){const o=this.value;if(e){const s=xi(this.getAccessor(),e),r=s.offset/o.BYTES_PER_ELEMENT,a=s.size||this.size;i[t]=o.subarray(r,r+a)}else i[t]=o}else i[t]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?i[`${t}64Low`]=i[t]:i[`${t}64Low`]=new Float32Array(this.size)),i}_getBufferLayout(t=this.id,e=null){const i=this.getAccessor(),o=[],s={name:this.id,byteStride:Mt(i),attributes:o};if(this.doublePrecision){const r=Rr(i,e||{});o.push(me(t,{...i,...r.high},this.device.type),me(`${t}64Low`,{...i,...r.low},this.device.type))}else if(e){const r=xi(i,e);o.push(me(t,{...i,...r},this.device.type))}else o.push(me(t,i,this.device.type));return s}setAccessor(t){this.state.bufferAccessor=t}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let t=null;if(this.state.constant&&this.value){const e=Array.from(this.value);t=[e,e]}else{const{value:e,numInstances:i,size:o}=this,s=i*o;if(e&&s&&e.length>=s){const r=new Array(o).fill(1/0),a=new Array(o).fill(-1/0);for(let c=0;c<s;)for(let l=0;l<o;l++){const u=e[c++];u<r[l]&&(r[l]=u),u>a[l]&&(a[l]=u)}t=[r,a]}}return this.state.bounds=t,t}setData(t){const{state:e}=this;let i;ArrayBuffer.isView(t)?i={value:t}:t instanceof Lt?i={buffer:t}:i=t;const o={...this.settings,...i};if(ArrayBuffer.isView(i.value)){if(!i.type)if(this.doublePrecision&&i.value instanceof Float64Array)o.type="float32";else{const r=Qr(i.value);o.type=o.normalized?r.replace("int","norm"):r}o.bytesPerElement=i.value.BYTES_PER_ELEMENT,o.stride=Mt(o)}if(e.bounds=null,i.constant){let s=i.value;if(s=this._normalizeValue(s,[],0),this.settings.normalized&&(s=this.normalizeConstant(s)),!(!e.constant||!this._areValuesEqual(s,this.value)))return!1;e.externalBuffer=null,e.constant=!0,this.value=ArrayBuffer.isView(s)?s:new Float32Array(s)}else if(i.buffer){const s=i.buffer;e.externalBuffer=s,e.constant=!1,this.value=i.value||null}else if(i.value){this._checkExternalBuffer(i);let s=i.value;e.externalBuffer=null,e.constant=!1,this.value=s;let{buffer:r}=this;const a=Mt(o),c=(o.vertexOffset||0)*a;if(this.doublePrecision&&s instanceof Float64Array&&(s=ii(s,o)),this.settings.isIndexed){const u=this.settings.defaultType;s.constructor!==u&&(s=new u(s))}const l=s.byteLength+c+a*2;(!r||r.byteLength<l)&&(r=this._createBuffer(l)),r.write(s,c)}return this.setAccessor(o),!0}updateSubBuffer(t={}){this.state.bounds=null;const e=this.value,{startOffset:i=0,endOffset:o}=t;this.buffer.write(this.doublePrecision&&e instanceof Float64Array?ii(e,{size:this.size,startIndex:i,endIndex:o}):e.subarray(i,o),i*e.BYTES_PER_ELEMENT+this.byteOffset)}allocate(t,e=!1){const{state:i}=this,o=i.allocatedValue,s=Re.allocate(o,t+1,{size:this.size,type:this.settings.defaultType,copy:e});this.value=s;const{byteOffset:r}=this;let{buffer:a}=this;return(!a||a.byteLength<s.byteLength+r)&&(a=this._createBuffer(s.byteLength+r),e&&o&&a.write(o instanceof Float64Array?ii(o,this):o,r)),i.allocatedValue=s,i.constant=!1,i.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(t){const{value:e}=t;if(!ArrayBuffer.isView(e))throw new Error(`Attribute ${this.id} value is not TypedArray`);const i=this.settings.defaultType;let o=!1;if(this.doublePrecision&&(o=e.BYTES_PER_ELEMENT<4),o)throw new Error(`Attribute ${this.id} does not support ${e.constructor.name}`);!(e instanceof i)&&this.settings.normalized&&!("normalized"in t)&&it.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(t){switch(this.settings.type){case"snorm8":return new Float32Array(t).map(e=>(e+128)/255*2-1);case"snorm16":return new Float32Array(t).map(e=>(e+32768)/65535*2-1);case"unorm8":return new Float32Array(t).map(e=>e/255);case"unorm16":return new Float32Array(t).map(e=>e/65535);default:return t}}_normalizeValue(t,e,i){const{defaultValue:o,size:s}=this.settings;if(Number.isFinite(t))return e[i]=t,e;if(!t){let r=s;for(;--r>=0;)e[i+r]=o[r];return e}switch(s){case 4:e[i+3]=Number.isFinite(t[3])?t[3]:o[3];case 3:e[i+2]=Number.isFinite(t[2])?t[2]:o[2];case 2:e[i+1]=Number.isFinite(t[1])?t[1]:o[1];case 1:e[i+0]=Number.isFinite(t[0])?t[0]:o[0];break;default:let r=s;for(;--r>=0;)e[i+r]=Number.isFinite(t[r])?t[r]:o[r]}return e}_areValuesEqual(t,e){if(!t||!e)return!1;const{size:i}=this;for(let o=0;o<i;o++)if(t[o]!==e[o])return!1;return!0}_createBuffer(t){this._buffer&&this._buffer.destroy();const{isIndexed:e,type:i}=this.settings;return this._buffer=this.device.createBuffer({...this._buffer?.props,id:this.id,usage:(e?Lt.INDEX:Lt.VERTEX)|Lt.COPY_DST,indexType:e?i:void 0,byteLength:t}),this._buffer}}const sn=[],rn=[];function Xe(n,t=0,e=1/0){let i=sn;const o={index:-1,data:n,target:[]};return n?typeof n[Symbol.iterator]=="function"?i=n:n.length>0&&(rn.length=n.length,i=rn):i=sn,(t>0||Number.isFinite(e))&&(i=(Array.isArray(i)?i:Array.from(i)).slice(t,e),o.index=t-1),{iterable:i,objectInfo:o}}function Ho(n){return n&&n[Symbol.asyncIterator]}function $o(n,t){const{size:e,stride:i,offset:o,startIndices:s,nested:r}=t,a=n.BYTES_PER_ELEMENT,c=i?i/a:e,l=o?o/a:0,u=Math.floor((n.length-l)/c);return(d,{index:g,target:h})=>{if(!s){const C=g*c+l;for(let y=0;y<e;y++)h[y]=n[C+y];return h}const p=s[g],A=s[g+1]||u;let f;if(r){f=new Array(A-p);for(let C=p;C<A;C++){const y=C*c+l;h=new Array(e);for(let v=0;v<e;v++)h[v]=n[y+v];f[C-p]=h}}else if(c===e)f=n.subarray(p*e+l,A*e+l);else{f=new n.constructor((A-p)*e);let C=0;for(let y=p;y<A;y++){const v=y*c+l;for(let b=0;b<e;b++)f[C++]=n[v+b]}}return f}}const Ur=[],Se=[[0,1/0]];function Dr(n,t){if(n===Se||(t[0]<0&&(t[0]=0),t[0]>=t[1]))return n;const e=[],i=n.length;let o=0;for(let s=0;s<i;s++){const r=n[s];r[1]<t[0]?(e.push(r),o=s+1):r[0]>t[1]?e.push(r):t=[Math.min(r[0],t[0]),Math.max(r[1],t[1])]}return e.splice(o,0,t),e}const kr={interpolation:{duration:0,easing:n=>n},spring:{stiffness:.05,damping:.5}};function ts(n,t){if(!n)return null;Number.isFinite(n)&&(n={type:"interpolation",duration:n});const e=n.type||"interpolation";return{...kr[e],...t,...n,type:e}}class es extends Fr{constructor(t,e){super(t,e,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:Se}),this.constant=!1,this.settings.update=e.update||(e.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(t){this.state.startIndices=t}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:t=!1}={}){const e=this.state.needsRedraw;return this.state.needsRedraw=e&&!t,e}layoutChanged(){return this.state.layoutChanged}setAccessor(t){var e;(e=this.state).layoutChanged||(e.layoutChanged=!Or(t,this.getAccessor())),super.setAccessor(t)}getUpdateTriggers(){const{accessor:t}=this.settings;return[this.id].concat(typeof t!="function"&&t||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(t){if(!t||!this.supportsTransition())return null;const{accessor:e}=this.settings,i=this.settings.transition,o=Array.isArray(e)?t[e.find(s=>t[s])]:t[e];return ts(o,i)}setNeedsUpdate(t=this.id,e){if(this.state.needsUpdate=this.state.needsUpdate||t,this.setNeedsRedraw(t),e){const{startRow:i=0,endRow:o=1/0}=e;this.state.updateRanges=Dr(this.state.updateRanges,[i,o])}else this.state.updateRanges=Se}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=Ur}setNeedsRedraw(t=this.id){this.state.needsRedraw=this.state.needsRedraw||t}allocate(t){const{state:e,settings:i}=this;return i.noAlloc?!1:i.update?(super.allocate(t,e.updateRanges!==Se),!0):!1}updateBuffer({numInstances:t,data:e,props:i,context:o}){if(!this.needsUpdate())return!1;const{state:{updateRanges:s},settings:{update:r,noAlloc:a}}=this;let c=!0;if(r){for(const[l,u]of s)r.call(o,this,{data:e,startRow:l,endRow:u,props:i,numInstances:t});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[l,u]of s){const d=Number.isFinite(l)?this.getVertexOffset(l):0,g=Number.isFinite(u)?this.getVertexOffset(u):a||!Number.isFinite(t)?this.value.length:t*this.size;super.updateSubBuffer({startOffset:d,endOffset:g})}this._checkAttributeArray()}else c=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),c}setConstantValue(t){return this.device.type==="webgpu"||t===void 0||typeof t=="function"?!1:(this.setData({constant:!0,value:t})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(t){const{state:e}=this;return t?(this.clearNeedsUpdate(),e.lastExternalBuffer===t||(e.lastExternalBuffer=t,this.setNeedsRedraw(),this.setData(t)),!0):(e.lastExternalBuffer=null,!1)}setBinaryValue(t,e=null){const{state:i,settings:o}=this;if(!t)return i.binaryValue=null,i.binaryAccessor=null,!1;if(o.noAlloc)return!1;if(i.binaryValue===t)return this.clearNeedsUpdate(),!0;if(i.binaryValue=t,this.setNeedsRedraw(),o.transform||e!==this.startIndices){ArrayBuffer.isView(t)&&(t={value:t});const r=t;vt(ArrayBuffer.isView(r.value),`invalid ${o.accessor}`);const a=!!r.size&&r.size!==this.size;return i.binaryAccessor=$o(r.value,{size:r.size||this.size,stride:r.stride,offset:r.offset,startIndices:e,nested:a}),!1}return this.clearNeedsUpdate(),this.setData(t),!0}getVertexOffset(t){const{startIndices:e}=this;return(e?t<e.length?e[t]:this.numInstances:t)*this.size}getValue(){const t=this.settings.shaderAttributes,e=super.getValue();if(!t)return e;for(const i in t)Object.assign(e,super.getValue(i,t[i]));return e}getBufferLayout(t){this.state.layoutChanged=!1;const e=this.settings.shaderAttributes,i=super._getBufferLayout(),{stepMode:o}=this.settings;if(o==="dynamic"?i.stepMode=t?t.isInstanced?"instance":"vertex":"instance":i.stepMode=o??"vertex",!e)return i;for(const s in e){const r=super._getBufferLayout(s,e[s]);i.attributes.push(...r.attributes)}return i}_autoUpdater(t,{data:e,startRow:i,endRow:o,props:s,numInstances:r}){if(t.constant&&this.context.device.type!=="webgpu")return;const{settings:a,state:c,value:l,size:u,startIndices:d}=t,{accessor:g,transform:h}=a;let p=c.binaryAccessor||(typeof g=="function"?g:s[g]);typeof p!="function"&&(p=()=>p),vt(typeof p=="function",`accessor "${g}" is not a function`);let A=t.getVertexOffset(i);const{iterable:f,objectInfo:C}=Xe(e,i,o);for(const y of f){C.index++;let v=p(y,C);if(h&&(v=h.call(this,v)),d){const b=(C.index<d.length-1?d[C.index+1]:r)-d[C.index];if(v&&Array.isArray(v[0])){let x=A;for(const I of v)t._normalizeValue(I,l,x),x+=u}else v&&v.length>u?l.set(v,A):(t._normalizeValue(v,C.target,0),Ar({target:l,source:C.target,start:A,count:b}));A+=b*u}else t._normalizeValue(v,l,A),A+=u}}_validateAttributeUpdaters(){const{settings:t}=this;if(!(t.noAlloc||typeof t.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:t}=this,e=Math.min(4,this.size);if(t&&t.length>=e){let i=!0;switch(e){case 4:i=i&&Number.isFinite(t[3]);case 3:i=i&&Number.isFinite(t[2]);case 2:i=i&&Number.isFinite(t[1]);case 1:i=i&&Number.isFinite(t[0]);break;default:i=!1}if(!i)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function si(n){const{source:t,target:e,start:i=0,size:o,getData:s}=n,r=n.end||e.length,a=t.length,c=r-i;if(a>c){e.set(t.subarray(0,c),i);return}if(e.set(t,i),!s)return;let l=a;for(;l<c;){const u=s(l,t);for(let d=0;d<o;d++)e[i+l]=u[d]||0,l++}}function Nr({source:n,target:t,size:e,getData:i,sourceStartIndices:o,targetStartIndices:s}){if(!o||!s)return si({source:n,target:t,size:e,getData:i}),t;let r=0,a=0;const c=i&&((u,d)=>i(u+a,d)),l=Math.min(o.length,s.length);for(let u=1;u<l;u++){const d=o[u]*e,g=s[u]*e;si({source:n.subarray(r,d),target:t,start:a,end:g,size:e,getData:c}),r=d,a=g}return a<t.length&&si({source:[],target:t,start:a,size:e,getData:c}),t}function zr(n){const{device:t,settings:e,value:i}=n,o=new es(t,e);return o.setData({value:i instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:e.normalized}),o}function is(n){switch(n){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${n}"`)}}function ns(n){switch(n){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function os(n){n.push(n.shift())}function Vr(n,t){const{doublePrecision:e,settings:i,value:o,size:s}=n,r=e&&o instanceof Float64Array?2:1;let a=0;const{shaderAttributes:c}=n.settings;if(c)for(const l of Object.values(c))a=Math.max(a,l.vertexOffset??0);return(i.noAlloc?o.length:(t+a)*s)*r}function ss({device:n,source:t,target:e}){return(!e||e.byteLength<t.byteLength)&&(e?.destroy(),e=n.createBuffer({byteLength:t.byteLength,usage:t.usage})),e}function rs({device:n,buffer:t,attribute:e,fromLength:i,toLength:o,fromStartIndices:s,getData:r=a=>a}){const a=e.doublePrecision&&e.value instanceof Float64Array?2:1,c=e.size*a,l=e.byteOffset,u=e.settings.bytesPerElement<4?l/e.settings.bytesPerElement*4:l,d=e.startIndices,g=s&&d,h=e.isConstant;if(!g&&t&&i>=o)return t;const p=e.value instanceof Float64Array?Float32Array:e.value.constructor,A=h?e.value:new p(e.getBuffer().readSyncWebGL(l,o*p.BYTES_PER_ELEMENT).buffer);if(e.settings.normalized&&!h){const v=r;r=(b,x)=>e.normalizeConstant(v(b,x))}const f=h?(v,b)=>r(A,b):(v,b)=>r(A.subarray(v+l,v+l+c),b),C=t?new Float32Array(t.readSyncWebGL(u,i*4).buffer):new Float32Array(0),y=new Float32Array(o);return Nr({source:C,target:y,sourceStartIndices:s,targetStartIndices:d,size:c,getData:f}),(!t||t.byteLength<y.byteLength+u)&&(t?.destroy(),t=n.createBuffer({byteLength:y.byteLength+u,usage:35050})),t.write(y,u),t}class as{constructor({device:t,attribute:e,timeline:i}){this.buffers=[],this.currentLength=0,this.device=t,this.transition=new ki(i),this.attribute=e,this.attributeInTransition=zr(e),this.currentStartIndices=e.startIndices}get inProgress(){return this.transition.inProgress}start(t,e,i=1/0){this.settings=t,this.currentStartIndices=this.attribute.startIndices,this.currentLength=Vr(this.attribute,e),this.transition.start({...t,duration:i})}update(){const t=this.transition.update();return t&&this.onUpdate(),t}setBuffer(t){this.attributeInTransition.setData({buffer:t,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const t of this.buffers)t.destroy();this.buffers.length=0}}class Wr extends as{constructor({device:t,attribute:e,timeline:i}){super({device:t,attribute:e,timeline:i}),this.type="interpolation",this.transform=Jr(t,e)}start(t,e){const i=this.currentLength,o=this.currentStartIndices;if(super.start(t,e,t.duration),t.duration<=0){this.transition.cancel();return}const{buffers:s,attribute:r}=this;os(s),s[0]=rs({device:this.device,buffer:s[0],attribute:r,fromLength:i,toLength:this.currentLength,fromStartIndices:o,getData:t.enter}),s[1]=ss({device:this.device,source:s[0],target:s[1]}),this.setBuffer(s[1]);const{transform:a}=this,c=a.model;let l=Math.floor(this.currentLength/r.size);cs(r)&&(l/=2),c.setVertexCount(l),r.isConstant?(c.setAttributes({aFrom:s[0]}),c.setConstantAttributes({aTo:r.value})):c.setAttributes({aFrom:s[0],aTo:r.getBuffer()}),a.transformFeedback.setBuffers({vCurrent:s[1]})}onUpdate(){const{duration:t,easing:e}=this.settings,{time:i}=this.transition;let o=i/t;e&&(o=e(o));const{model:s}=this.transform,r={time:o};s.shaderInputs.setProps({interpolation:r}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const Gr=`uniform interpolationUniforms {
  float time;
} interpolation;
`,an={name:"interpolation",vs:Gr,uniformTypes:{time:"f32"}},jr=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, interpolation.time);
  gl_Position = vec4(0.0);
}
`,Zr=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), interpolation.time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function cs(n){return n.doublePrecision&&n.value instanceof Float64Array}function Jr(n,t){const e=t.size,i=is(e),o=ns(e),s=t.getBufferLayout();return cs(t)?new Rt(n,{vs:Zr,bufferLayout:[{name:"aFrom",byteStride:8*e,attributes:[{attribute:"aFrom",format:o,byteOffset:0},{attribute:"aFrom64Low",format:o,byteOffset:4*e}]},{name:"aTo",byteStride:8*e,attributes:[{attribute:"aTo",format:o,byteOffset:0},{attribute:"aTo64Low",format:o,byteOffset:4*e}]}],modules:[fr,an],defines:{ATTRIBUTE_TYPE:i,ATTRIBUTE_SIZE:e},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new Rt(n,{vs:jr,bufferLayout:[{name:"aFrom",format:o},{name:"aTo",format:s.attributes[0].format}],modules:[an],defines:{ATTRIBUTE_TYPE:i},varyings:["vCurrent"],disableWarnings:!0})}class qr extends as{constructor({device:t,attribute:e,timeline:i}){super({device:t,attribute:e,timeline:i}),this.type="spring",this.texture=ta(t),this.framebuffer=ea(t,this.texture),this.transform=$r(t,e)}start(t,e){const i=this.currentLength,o=this.currentStartIndices;super.start(t,e);const{buffers:s,attribute:r}=this;for(let c=0;c<2;c++)s[c]=rs({device:this.device,buffer:s[c],attribute:r,fromLength:i,toLength:this.currentLength,fromStartIndices:o,getData:t.enter});s[2]=ss({device:this.device,source:s[0],target:s[2]}),this.setBuffer(s[1]);const{model:a}=this.transform;a.setVertexCount(Math.floor(this.currentLength/r.size)),r.isConstant?a.setConstantAttributes({aTo:r.value}):a.setAttributes({aTo:r.getBuffer()})}onUpdate(){const{buffers:t,transform:e,framebuffer:i,transition:o}=this,s=this.settings;e.model.setAttributes({aPrev:t[0],aCur:t[1]}),e.transformFeedback.setBuffers({vNext:t[2]});const r={stiffness:s.stiffness,damping:s.damping};e.model.shaderInputs.setProps({spring:r}),e.run({framebuffer:i,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),os(t),this.setBuffer(t[1]),this.device.readPixelsToArrayWebGL(i)[0]>0||o.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const Kr=`uniform springUniforms {
  float damping;
  float stiffness;
} spring;
`,Xr={name:"spring",vs:Kr,uniformTypes:{damping:"f32",stiffness:"f32"}},Yr=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE force = delta * spring.stiffness;
  ATTRIBUTE_TYPE resistance = velocity * spring.damping;
  return force - resistance + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,Hr=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function $r(n,t){const e=is(t.size),i=ns(t.size);return new Rt(n,{vs:Yr,fs:Hr,bufferLayout:[{name:"aPrev",format:i},{name:"aCur",format:i},{name:"aTo",format:t.getBufferLayout().attributes[0].format}],varyings:["vNext"],modules:[Xr],defines:{ATTRIBUTE_TYPE:e},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function ta(n){return n.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}function ea(n,t){return n.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[t]})}const ia={interpolation:Wr,spring:qr};class na{constructor(t,{id:e,timeline:i}){if(!t)throw new Error("AttributeTransitionManager is constructed without device");this.id=e,this.device=t,this.timeline=i,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const t in this.transitions)this._removeTransition(t)}update({attributes:t,transitions:e,numInstances:i}){this.numInstances=i||1;for(const o in t){const s=t[o],r=s.getTransitionSetting(e);r&&this._updateAttribute(o,s,r)}for(const o in this.transitions){const s=t[o];(!s||!s.getTransitionSetting(e))&&this._removeTransition(o)}}hasAttribute(t){const e=this.transitions[t];return e&&e.inProgress}getAttributes(){const t={};for(const e in this.transitions){const i=this.transitions[e];i.inProgress&&(t[e]=i.attributeInTransition)}return t}run(){if(this.numInstances===0)return!1;for(const e in this.transitions)this.transitions[e].update()&&(this.needsRedraw=!0);const t=this.needsRedraw;return this.needsRedraw=!1,t}_removeTransition(t){this.transitions[t].delete(),delete this.transitions[t]}_updateAttribute(t,e,i){const o=this.transitions[t];let s=!o||o.type!==i.type;if(s){o&&this._removeTransition(t);const r=ia[i.type];r?this.transitions[t]=new r({attribute:e,timeline:this.timeline,device:this.device}):(it.error(`unsupported transition type '${i.type}'`)(),s=!1)}(s||e.needsRedraw())&&(this.needsRedraw=!0,this.transitions[t].start(i,this.numInstances))}}const cn="attributeManager.invalidate",oa="attributeManager.updateStart",sa="attributeManager.updateEnd",ra="attribute.updateStart",aa="attribute.allocate",ca="attribute.updateEnd";class la{constructor(t,{id:e="attribute-manager",stats:i,timeline:o}={}){this.mergeBoundsMemoized=Ko(lr),this.id=e,this.device=t,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=i,this.attributeTransitionManager=new na(t,{id:`${e}-transitions`,timeline:o}),Object.seal(this)}finalize(){for(const t in this.attributes)this.attributes[t].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(t={clearRedrawFlags:!1}){const e=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!t.clearRedrawFlags,e&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(t){this._add(t)}addInstanced(t){this._add(t,{stepMode:"instance"})}remove(t){for(const e of t)this.attributes[e]!==void 0&&(this.attributes[e].delete(),delete this.attributes[e])}invalidate(t,e){const i=this._invalidateTrigger(t,e);st(cn,this,t,i)}invalidateAll(t){for(const e in this.attributes)this.attributes[e].setNeedsUpdate(e,t);st(cn,this,"all")}update({data:t,numInstances:e,startIndices:i=null,transitions:o,props:s={},buffers:r={},context:a={}}){let c=!1;st(oa,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const l in this.attributes){const u=this.attributes[l],d=u.settings.accessor;u.startIndices=i,u.numInstances=e,s[l]&&it.removed(`props.${l}`,`data.attributes.${l}`)(),u.setExternalBuffer(r[l])||u.setBinaryValue(typeof d=="string"?r[d]:void 0,t.startIndices)||typeof d=="string"&&!r[d]&&u.setConstantValue(s[d])||u.needsUpdate()&&(c=!0,this._updateAttribute({attribute:u,numInstances:e,data:t,props:s,context:a})),this.needsRedraw=this.needsRedraw||u.needsRedraw()}c&&st(sa,this,e),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:e,transitions:o})}updateTransition(){const{attributeTransitionManager:t}=this,e=t.run();return this.needsRedraw=this.needsRedraw||e,e}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(t){const e=t.map(i=>this.attributes[i]?.getBounds());return this.mergeBoundsMemoized(e)}getChangedAttributes(t={clearChangedFlags:!1}){const{attributes:e,attributeTransitionManager:i}=this,o={...i.getAttributes()};for(const s in e){const r=e[s];r.needsRedraw(t)&&!i.hasAttribute(s)&&(o[s]=r)}return o}getBufferLayouts(t){return Object.values(this.getAttributes()).map(e=>e.getBufferLayout(t))}_add(t,e){for(const i in t){const o=t[i],s={...o,id:i,size:o.isIndexed&&1||o.size||1,...e};this.attributes[i]=new es(this.device,s)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const t={};for(const e in this.attributes)this.attributes[e].getUpdateTriggers().forEach(o=>{t[o]||(t[o]=[]),t[o].push(e)});this.updateTriggers=t}_invalidateTrigger(t,e){const{attributes:i,updateTriggers:o}=this,s=o[t];return s&&s.forEach(r=>{const a=i[r];a&&a.setNeedsUpdate(a.id,e)}),s}_updateAttribute(t){const{attribute:e,numInstances:i}=t;if(st(ra,e),e.constant){e.setConstantValue(e.value);return}e.allocate(i)&&st(aa,e,i),e.updateBuffer(t)&&(this.needsRedraw=!0,st(ca,e,i))}}class ua extends ki{get value(){return this._value}_onUpdate(){const{time:t,settings:{fromValue:e,toValue:i,duration:o,easing:s}}=this,r=s(t/o);this._value=_e(e,i,r)}}const ln=1e-5;function un(n,t,e,i,o){const s=t-n,a=(e-t)*o,c=-s*i;return a+c+s+t}function da(n,t,e,i,o){if(Array.isArray(e)){const s=[];for(let r=0;r<e.length;r++)s[r]=un(n[r],t[r],e[r],i,o);return s}return un(n,t,e,i,o)}function dn(n,t){if(Array.isArray(n)){let e=0;for(let i=0;i<n.length;i++){const o=n[i]-t[i];e+=o*o}return Math.sqrt(e)}return Math.abs(n-t)}class ga extends ki{get value(){return this._currValue}_onUpdate(){const{fromValue:t,toValue:e,damping:i,stiffness:o}=this.settings,{_prevValue:s=t,_currValue:r=t}=this;let a=da(s,r,e,i,o);const c=dn(a,e),l=dn(a,r);c<ln&&l<ln&&(a=e,this.end()),this._prevValue=r,this._currValue=a}}const ha={interpolation:ua,spring:ga};class fa{constructor(t){this.transitions=new Map,this.timeline=t}get active(){return this.transitions.size>0}add(t,e,i,o){const{transitions:s}=this;if(s.has(t)){const c=s.get(t),{value:l=c.settings.fromValue}=c;e=l,this.remove(t)}if(o=ts(o),!o)return;const r=ha[o.type];if(!r){it.error(`unsupported transition type '${o.type}'`)();return}const a=new r(this.timeline);a.start({...o,fromValue:e,toValue:i}),s.set(t,a)}remove(t){const{transitions:e}=this;e.has(t)&&(e.get(t).cancel(),e.delete(t))}update(){const t={};for(const[e,i]of this.transitions)i.update(),t[e]=i.value,i.inProgress||this.remove(e);return t}clear(){for(const t of this.transitions.keys())this.remove(t)}}function pa(n){const t=n[wt];for(const e in t){const i=t[e],{validate:o}=i;if(o&&!o(n[e],i))throw new Error(`Invalid prop ${e}: ${n[e]}`)}}function Aa(n,t){const e=ls({newProps:n,oldProps:t,propTypes:n[wt],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),i=va(n,t);let o=!1;return i||(o=Ca(n,t)),{dataChanged:i,propsChanged:e,updateTriggersChanged:o,extensionsChanged:ya(n,t),transitionsChanged:ma(n,t)}}function ma(n,t){if(!n.transitions)return!1;const e={},i=n[wt];let o=!1;for(const s in n.transitions){const r=i[s],a=r&&r.type;(a==="number"||a==="color"||a==="array")&&wi(n[s],t[s],r)&&(e[s]=!0,o=!0)}return o?e:!1}function ls({newProps:n,oldProps:t,ignoreProps:e={},propTypes:i={},triggerName:o="props"}){if(t===n)return!1;if(typeof n!="object"||n===null)return`${o} changed shallowly`;if(typeof t!="object"||t===null)return`${o} changed shallowly`;for(const s of Object.keys(n))if(!(s in e)){if(!(s in t))return`${o}.${s} added`;const r=wi(n[s],t[s],i[s]);if(r)return`${o}.${s} ${r}`}for(const s of Object.keys(t))if(!(s in e)){if(!(s in n))return`${o}.${s} dropped`;if(!Object.hasOwnProperty.call(n,s)){const r=wi(n[s],t[s],i[s]);if(r)return`${o}.${s} ${r}`}}return!1}function wi(n,t,e){let i=e&&e.equal;return i&&!i(n,t,e)||!i&&(i=n&&t&&n.equals,i&&!i.call(n,t))?"changed deeply":!i&&t!==n?"changed shallowly":null}function va(n,t){if(t===null)return"oldProps is null, initial diff";let e=!1;const{dataComparator:i,_dataDiff:o}=n;return i?i(n.data,t.data)||(e="Data comparator detected a change"):n.data!==t.data&&(e="A new data container was supplied"),e&&o&&(e=o(n.data,t.data)||e),e}function Ca(n,t){if(t===null)return{all:!0};if("all"in n.updateTriggers&&gn(n,t,"all"))return{all:!0};const e={};let i=!1;for(const o in n.updateTriggers)o!=="all"&&gn(n,t,o)&&(e[o]=!0,i=!0);return i?e:!1}function ya(n,t){if(t===null)return!0;const e=t.extensions,{extensions:i}=n;if(i===e)return!1;if(!e||!i||i.length!==e.length)return!0;for(let o=0;o<i.length;o++)if(!i[o].equals(e[o]))return!0;return!1}function gn(n,t,e){let i=n.updateTriggers[e];i=i??{};let o=t.updateTriggers[e];return o=o??{},ls({oldProps:o,newProps:i,triggerName:e})}const Ea="count(): argument not an object",ba="count(): argument not a container";function Ia(n){if(!wa(n))throw new Error(Ea);if(typeof n.count=="function")return n.count();if(Number.isFinite(n.size))return n.size;if(Number.isFinite(n.length))return n.length;if(xa(n))return Object.keys(n).length;throw new Error(ba)}function xa(n){return n!==null&&typeof n=="object"&&n.constructor===Object}function wa(n){return n!==null&&typeof n=="object"}const Pa={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},Pi={};function Ta(n,t,e,i){if(e instanceof Xo)return e;e.constructor&&e.constructor.name!=="Object"&&(e={data:e});let o=null;e.compressed&&(o={minFilter:"linear",mipmapFilter:e.data.length>1?"nearest":"linear"});const s=t.createTexture({...e,sampler:{...Pa,...o,...i},mipmaps:!0});return Pi[s.id]=n,s}function Ba(n,t){!t||!(t instanceof Xo)||Pi[t.id]===n&&(t.delete(),delete Pi[t.id])}const _a={boolean:{validate(n,t){return!0},equal(n,t,e){return!!n==!!t}},number:{validate(n,t){return Number.isFinite(n)&&(!("max"in t)||n<=t.max)&&(!("min"in t)||n>=t.min)}},color:{validate(n,t){return t.optional&&!n||Ti(n)&&(n.length===3||n.length===4)},equal(n,t,e){return Ae(n,t,1)}},accessor:{validate(n,t){const e=Ue(n);return e==="function"||e===Ue(t.value)},equal(n,t,e){return typeof t=="function"?!0:Ae(n,t,1)}},array:{validate(n,t){return t.optional&&!n||Ti(n)},equal(n,t,e){const{compare:i}=e,o=Number.isInteger(i)?i:i?1:0;return i?Ae(n,t,o):n===t}},object:{equal(n,t,e){if(e.ignore)return!0;const{compare:i}=e,o=Number.isInteger(i)?i:i?1:0;return i?Ae(n,t,o):n===t}},function:{validate(n,t){return t.optional&&!n||typeof n=="function"},equal(n,t,e){return!e.compare&&e.ignore!==!1||n===t}},data:{transform:(n,t,e)=>{if(!n)return n;const{dataTransform:i}=e.props;return i?i(n):typeof n.shape=="string"&&n.shape.endsWith("-table")&&Array.isArray(n.data)?n.data:n}},image:{transform:(n,t,e)=>{const i=e.context;return!i||!i.device?null:Ta(e.id,i.device,n,{...t.parameters,...e.props.textureParameters})},release:(n,t,e)=>{Ba(e.id,n)}}};function Sa(n){const t={},e={},i={};for(const[o,s]of Object.entries(n)){const r=s?.deprecatedFor;if(r)i[o]=Array.isArray(r)?r:[r];else{const a=La(o,s);t[o]=a,e[o]=a.value}}return{propTypes:t,defaultProps:e,deprecatedProps:i}}function La(n,t){switch(Ue(t)){case"object":return $t(n,t);case"array":return $t(n,{type:"array",value:t,compare:!1});case"boolean":return $t(n,{type:"boolean",value:t});case"number":return $t(n,{type:"number",value:t});case"function":return $t(n,{type:"function",value:t,compare:!0});default:return{name:n,type:"unknown",value:t}}}function $t(n,t){return"type"in t?{name:n,..._a[t.type],...t}:"value"in t?{name:n,type:Ue(t.value),...t}:{name:n,type:"object",value:t}}function Ti(n){return Array.isArray(n)||ArrayBuffer.isView(n)}function Ue(n){return Ti(n)?"array":n===null?"null":typeof n}function Ma(n,t){let e;for(let s=t.length-1;s>=0;s--){const r=t[s];"extensions"in r&&(e=r.extensions)}const i=Bi(n.constructor,e),o=Object.create(i);o[Fe]=n,o[Ot]={},o[bt]={};for(let s=0;s<t.length;++s){const r=t[s];for(const a in r)o[a]=r[a]}return Object.freeze(o),o}const Qa="_mergedDefaultProps";function Bi(n,t){if(!(n instanceof Ye.constructor))return{};let e=Qa;if(t)for(const o of t){const s=o.constructor;s&&(e+=`:${s.extensionName||s.name}`)}const i=us(n,e);return i||(n[e]=Oa(n,t||[]))}function Oa(n,t){if(!n.prototype)return null;const i=Object.getPrototypeOf(n),o=Bi(i),s=us(n,"defaultProps")||{},r=Sa(s),a=Object.assign(Object.create(null),o,r.defaultProps),c=Object.assign(Object.create(null),o?.[wt],r.propTypes),l=Object.assign(Object.create(null),o?.[ni],r.deprecatedProps);for(const u of t){const d=Bi(u.constructor);d&&(Object.assign(a,d),Object.assign(c,d[wt]),Object.assign(l,d[ni]))}return Ra(a,n),Ua(a,c),Fa(a,l),a[wt]=c,a[ni]=l,t.length===0&&!Ni(n,"_propTypes")&&(n._propTypes=c),a}function Ra(n,t){const e=ka(t);Object.defineProperties(n,{id:{writable:!0,value:e}})}function Fa(n,t){for(const e in t)Object.defineProperty(n,e,{enumerable:!1,set(i){const o=`${this.id}: ${e}`;for(const s of t[e])Ni(this,s)||(this[s]=i);it.deprecated(o,t[e].join("/"))()}})}function Ua(n,t){const e={},i={};for(const o in t){const s=t[o],{name:r,value:a}=s;s.async&&(e[r]=a,i[r]=Da(r))}n[kt]=e,n[Ot]={},Object.defineProperties(n,i)}function Da(n){return{enumerable:!0,set(t){typeof t=="string"||t instanceof Promise||Ho(t)?this[Ot][n]=t:this[bt][n]=t},get(){if(this[bt]){if(n in this[bt])return this[bt][n]||this[kt][n];if(n in this[Ot]){const t=this[Fe]&&this[Fe].internalState;if(t&&t.hasAsyncProp(n))return t.getAsyncProp(n)||this[kt][n]}}return this[kt][n]}}}function Ni(n,t){return Object.prototype.hasOwnProperty.call(n,t)}function us(n,t){return Ni(n,t)&&n[t]}function ka(n){const t=n.componentName;return t||it.warn(`${n.name}.componentName not specified`)(),t||n.name}let Na=0;class Ye{constructor(...t){this.props=Ma(this,t),this.id=this.props.id,this.count=Na++}clone(t){const{props:e}=this,i={};for(const o in e[kt])o in e[bt]?i[o]=e[bt][o]:o in e[Ot]&&(i[o]=e[Ot][o]);return new this.constructor({...e,...i,...t})}}Ye.componentName="Component";Ye.defaultProps={};const za=Object.freeze({});class Va{constructor(t){this.component=t,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const t in this.asyncProps){const e=this.asyncProps[t];e&&e.type&&e.type.release&&e.type.release(e.resolvedValue,e.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||za}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(t){return t in this.asyncProps}getAsyncProp(t){const e=this.asyncProps[t];return e&&e.resolvedValue}isAsyncPropLoading(t){if(t){const e=this.asyncProps[t];return!!(e&&e.pendingLoadCount>0&&e.pendingLoadCount!==e.resolvedLoadCount)}for(const e in this.asyncProps)if(this.isAsyncPropLoading(e))return!0;return!1}reloadAsyncProp(t,e){this._watchPromise(t,Promise.resolve(e))}setAsyncProps(t){this.component=t[Fe]||this.component;const e=t[bt]||{},i=t[Ot]||t,o=t[kt]||{};for(const s in e){const r=e[s];this._createAsyncPropData(s,o[s]),this._updateAsyncProp(s,r),e[s]=this.getAsyncProp(s)}for(const s in i){const r=i[s];this._createAsyncPropData(s,o[s]),this._updateAsyncProp(s,r)}}_fetch(t,e){return null}_onResolve(t,e){}_onError(t,e){}_updateAsyncProp(t,e){if(this._didAsyncInputValueChange(t,e)){if(typeof e=="string"&&(e=this._fetch(t,e)),e instanceof Promise){this._watchPromise(t,e);return}if(Ho(e)){this._resolveAsyncIterable(t,e);return}this._setPropValue(t,e)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const t in this.asyncProps)Object.defineProperty(this.oldAsyncProps,t,{enumerable:!0,value:this.oldProps[t]})}}_didAsyncInputValueChange(t,e){const i=this.asyncProps[t];return e===i.resolvedValue||e===i.lastValue?!1:(i.lastValue=e,!0)}_setPropValue(t,e){this._freezeAsyncOldProps();const i=this.asyncProps[t];i&&(e=this._postProcessValue(i,e),i.resolvedValue=e,i.pendingLoadCount++,i.resolvedLoadCount=i.pendingLoadCount)}_setAsyncPropValue(t,e,i){const o=this.asyncProps[t];o&&i>=o.resolvedLoadCount&&e!==void 0&&(this._freezeAsyncOldProps(),o.resolvedValue=e,o.resolvedLoadCount=i,this.onAsyncPropUpdated(t,e))}_watchPromise(t,e){const i=this.asyncProps[t];if(i){i.pendingLoadCount++;const o=i.pendingLoadCount;e.then(s=>{this.component&&(s=this._postProcessValue(i,s),this._setAsyncPropValue(t,s,o),this._onResolve(t,s))}).catch(s=>{this._onError(t,s)})}}async _resolveAsyncIterable(t,e){if(t!=="data"){this._setPropValue(t,e);return}const i=this.asyncProps[t];if(!i)return;i.pendingLoadCount++;const o=i.pendingLoadCount;let s=[],r=0;for await(const a of e){if(!this.component)return;const{dataTransform:c}=this.component.props;c?s=c(a,s):s=s.concat(a),Object.defineProperty(s,"__diff",{enumerable:!1,value:[{startRow:r,endRow:s.length}]}),r=s.length,this._setAsyncPropValue(t,s,o)}this._onResolve(t,s)}_postProcessValue(t,e){const i=t.type;return i&&this.component&&(i.release&&i.release(t.resolvedValue,i,this.component),i.transform)?i.transform(e,i,this.component):e}_createAsyncPropData(t,e){if(!this.asyncProps[t]){const o=this.component&&this.component.props[wt];this.asyncProps[t]={type:o&&o[t],lastValue:null,resolvedValue:e,pendingLoadCount:0,resolvedLoadCount:0}}}}class Wa extends Va{constructor({attributeManager:t,layer:e}){super(e),this.attributeManager=t,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(t,e){const i=this.layer,o=i?.props.fetch;return o?o(e,{propName:t,layer:i}):super._fetch(t,e)}_onResolve(t,e){const i=this.layer;if(i){const o=i.props.onDataLoad;t==="data"&&o&&o(e,{propName:t,layer:i})}}_onError(t,e){const i=this.layer;i&&i.raiseError(e,`loading ${t} of ${this.layer}`)}}const Ga="layer.changeFlag",ja="layer.initialize",Za="layer.update",Ja="layer.finalize",qa="layer.matched",hn=2**24-1,Ka=Object.freeze([]),Xa=Ko(({oldViewport:n,viewport:t})=>n.equals(t));let at=new Uint8ClampedArray(0);const Ya={data:{type:"data",value:Ka,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:n=>n&&n.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(n,{propName:t,layer:e,loaders:i,loadOptions:o,signal:s})=>{const{resourceManager:r}=e.context;o=o||e.getLoadOptions(),i=i||e.props.loaders,s&&(o={...o,fetch:{...o?.fetch,signal:s}});let a=r.contains(n);return!a&&!o&&(r.add({resourceId:n,data:Ii(n,i),persistent:!1}),a=!0),a?r.subscribe({resourceId:n,onChange:c=>e.internalState?.reloadAsyncProp(t,c),consumerId:e.id,requestId:t}):Ii(n,i,o)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:H.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:n})=>[0,-n*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class Ct extends Ye{constructor(){super(...arguments),this.internalState=null,this.lifecycle=mr.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let t=this;for(;t.parent;)t=t.parent;return t}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(t){vt(this.internalState);const e=this.internalState.viewport||this.context.viewport,i=Yo(t,{viewport:e,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[o,s,r]=ur(i,e.pixelProjectionMatrix);return t.length===2?[o,s]:[o,s,r]}unproject(t){return vt(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(t)}projectPosition(t,e){vt(this.internalState);const i=this.internalState.viewport||this.context.viewport;return Lr(t,{viewport:i,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...e})}get isComposite(){return!1}get isDrawable(){return!0}setState(t){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,t),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const t=this.state;return t&&(t.models||t.model&&[t.model])||[]}setShaderModuleProps(...t){for(const e of this.getModels())e.shaderInputs.setProps(...t)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:t}=this.props;return t===H.DEFAULT||t===H.LNGLAT||t===H.CARTESIAN}onHover(t,e){return this.props.onHover&&this.props.onHover(t,e)||!1}onClick(t,e){return this.props.onClick&&this.props.onClick(t,e)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(t,e=[]){return e[0]=t+1&255,e[1]=t+1>>8&255,e[2]=t+1>>8>>8&255,e}decodePickingColor(t){vt(t instanceof Uint8Array);const[e,i,o]=t;return e+i*256+o*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:Ia(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){return this.getAttributeManager()?.getBounds(["positions","instancePositions"])}getShaders(t){t=tn(t,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const e of this.props.extensions)t=tn(t,e.getShaders.call(this,e));return t}shouldUpdateState(t){return t.changeFlags.propsOrDataChanged}updateState(t){const e=this.getAttributeManager(),{dataChanged:i}=t.changeFlags;if(i&&e)if(Array.isArray(i))for(const o of i)e.invalidateAll(o);else e.invalidateAll();if(e){const{props:o}=t,s=this.internalState.hasPickingBuffer,r=Number.isInteger(o.highlightedObjectIndex)||o.pickable||o.extensions.some(a=>a.getNeedsPickingBuffer.call(this,a));if(s!==r){this.internalState.hasPickingBuffer=r;const{pickingColors:a,instancePickingColors:c}=e.attributes,l=a||c;l&&(r&&l.constant&&(l.constant=!1,e.invalidate(l.id)),!l.value&&!r&&(l.constant=!0,l.value=[0,0,0]))}}}finalizeState(t){for(const i of this.getModels())i.destroy();const e=this.getAttributeManager();e&&e.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(t){for(const e of this.getModels())e.draw(t.renderPass)}getPickingInfo({info:t,mode:e,sourceLayer:i}){const{index:o}=t;return o>=0&&Array.isArray(this.props.data)&&(t.object=this.props.data[o]),t}raiseError(t,e){e&&(t=new Error(`${e}: ${t.message}`,{cause:t})),this.props.onError?.(t)||this.context?.onError?.(t,this)}getNeedsRedraw(t={clearRedrawFlags:!1}){return this._getNeedsRedraw(t)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){return this.internalState?.uniformTransitions.active||!1}activateViewport(t){if(!this.internalState)return;const e=this.internalState.viewport;this.internalState.viewport=t,(!e||!Xa({oldViewport:e,viewport:t}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(t="all"){const e=this.getAttributeManager();e&&(t==="all"?e.invalidateAll():e.invalidate(t))}updateAttributes(t){let e=!1;for(const i in t)t[i].layoutChanged()&&(e=!0);for(const i of this.getModels())this._setModelAttributes(i,t,e)}_updateAttributes(){const t=this.getAttributeManager();if(!t)return;const e=this.props,i=this.getNumInstances(),o=this.getStartIndices();t.update({data:e.data,numInstances:i,startIndices:o,props:e,transitions:e.transitions,buffers:e.data.attributes,context:this});const s=t.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(s)}_updateAttributeTransition(){const t=this.getAttributeManager();t&&t.updateTransition()}_updateUniformTransition(){const{uniformTransitions:t}=this.internalState;if(t.active){const e=t.update(),i=Object.create(this.props);for(const o in e)Object.defineProperty(i,o,{value:e[o]});return i}return this.props}calculateInstancePickingColors(t,{numInstances:e}){if(t.constant)return;const i=Math.floor(at.length/4);if(this.internalState.usesPickingColorCache=!0,i<e){e>hn&&it.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),at=Re.allocate(at,e,{size:4,copy:!0,maxCount:Math.max(e,hn)});const o=Math.floor(at.length/4),s=[0,0,0];for(let r=i;r<o;r++)this.encodePickingColor(r,s),at[r*4+0]=s[0],at[r*4+1]=s[1],at[r*4+2]=s[2],at[r*4+3]=0}t.value=at.subarray(0,e*4)}_setModelAttributes(t,e,i=!1){if(!Object.keys(e).length)return;if(i){const a=this.getAttributeManager();t.setBufferLayout(a.getBufferLayouts(t)),e=a.getAttributes()}const o=t.userData?.excludeAttributes||{},s={},r={};for(const a in e){if(o[a])continue;const c=e[a].getValue();for(const l in c){const u=c[l];u instanceof Lt?e[a].settings.isIndexed?t.setIndexBuffer(u):s[l]=u:u&&(r[l]=u)}}t.setAttributes(s),t.setConstantAttributes(r)}disablePickingIndex(t){const e=this.props.data;if(!("attributes"in e)){this._disablePickingIndex(t);return}const{pickingColors:i,instancePickingColors:o}=this.getAttributeManager().attributes,s=i||o,r=s&&e.attributes&&e.attributes[s.id];if(r&&r.value){const a=r.value,c=this.encodePickingColor(t);for(let l=0;l<e.length;l++){const u=s.getVertexOffset(l);a[u]===c[0]&&a[u+1]===c[1]&&a[u+2]===c[2]&&this._disablePickingIndex(l)}}else this._disablePickingIndex(t)}_disablePickingIndex(t){const{pickingColors:e,instancePickingColors:i}=this.getAttributeManager().attributes,o=e||i;if(!o)return;const s=o.getVertexOffset(t),r=o.getVertexOffset(t+1);o.buffer.write(new Uint8Array(r-s),s)}restorePickingColors(){const{pickingColors:t,instancePickingColors:e}=this.getAttributeManager().attributes,i=t||e;i&&(this.internalState.usesPickingColorCache&&i.value.buffer!==at.buffer&&(i.value=at.subarray(0,i.value.length)),i.updateSubBuffer({startOffset:0}))}_initialize(){vt(!this.internalState),vt(Number.isFinite(this.props.coordinateSystem)),st(ja,this);const t=this._getAttributeManager();t&&t.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new Wa({attributeManager:t,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(it.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),t)}),this.internalState.uniformTransitions=new fa(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const e of this.props.extensions)e.initializeState.call(this,this.context,e);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(t){st(qa,this,this===t);const{state:e,internalState:i}=t;this!==t&&(this.internalState=i,this.state=e,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const t=this.needsUpdate();if(st(Za,this,t),!t)return;const e=this.props,i=this.context,o=this.internalState,s=i.viewport,r=this._updateUniformTransition();o.propsInTransition=r,i.viewport=o.viewport||s,this.props=r;try{const a=this._getUpdateParams(),c=this.getModels();if(i.device)this.updateState(a);else try{this.updateState(a)}catch{}for(const u of this.props.extensions)u.updateState.call(this,a,u);this.setNeedsRedraw(),this._updateAttributes();const l=this.getModels()[0]!==c[0];this._postUpdate(a,l)}finally{i.viewport=s,this.props=e,this._clearChangeFlags(),o.needsUpdate=!1,o.resetOldProps()}}_finalize(){st(Ja,this),this.finalizeState(this.context);for(const t of this.props.extensions)t.finalizeState.call(this,this.context,t)}_drawLayer({renderPass:t,shaderModuleProps:e=null,uniforms:i={},parameters:o={}}){this._updateAttributeTransition();const s=this.props,r=this.context;this.props=this.internalState.propsInTransition||s;try{e&&this.setShaderModuleProps(e);const{getPolygonOffset:a}=this.props,c=a&&a(i)||[0,0];r.device instanceof en&&r.device.setParametersWebGL({polygonOffset:c});for(const l of this.getModels())l.device.type==="webgpu"?l.setParameters({...l.parameters,...o}):l.setParameters(o);if(r.device instanceof en)r.device.withParametersWebGL(o,()=>{const l={renderPass:t,shaderModuleProps:e,uniforms:i,parameters:o,context:r};for(const u of this.props.extensions)u.draw.call(this,l,u);this.draw(l)});else{const l={renderPass:t,shaderModuleProps:e,uniforms:i,parameters:o,context:r};for(const u of this.props.extensions)u.draw.call(this,l,u);this.draw(l)}}finally{this.props=s}}getChangeFlags(){return this.internalState?.changeFlags}setChangeFlags(t){if(!this.internalState)return;const{changeFlags:e}=this.internalState;for(const o in t)if(t[o]){let s=!1;switch(o){case"dataChanged":const r=t[o],a=e[o];r&&Array.isArray(a)&&(e.dataChanged=Array.isArray(r)?a.concat(r):r,s=!0);default:e[o]||(e[o]=t[o],s=!0)}s&&st(Ga,this,o,t)}const i=!!(e.dataChanged||e.updateTriggersChanged||e.propsChanged||e.extensionsChanged);e.propsOrDataChanged=i,e.somethingChanged=i||e.viewportChanged||e.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(t,e){const i=Aa(t,e);if(i.updateTriggersChanged)for(const o in i.updateTriggersChanged)i.updateTriggersChanged[o]&&this.invalidateAttribute(o);if(i.transitionsChanged)for(const o in i.transitionsChanged)this.internalState.uniformTransitions.add(o,e[o],t[o],t.transitions?.[o]);return this.setChangeFlags(i)}validateProps(){pa(this.props)}updateAutoHighlight(t){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(t)}_updateAutoHighlight(t){const e={highlightedObjectColor:t.picked?t.color:null},{highlightColor:i}=this.props;t.picked&&typeof i=="function"&&(e.highlightColor=i(t)),this.setShaderModuleProps({picking:e}),this.setNeedsRedraw()}_getAttributeManager(){const t=this.context;return new la(t.device,{id:this.props.id,stats:t.stats,timeline:t.timeline})}_postUpdate(t,e){const{props:i,oldProps:o}=t,s=this.state.model;s?.isInstanced&&s.setInstanceCount(this.getNumInstances());const{autoHighlight:r,highlightedObjectIndex:a,highlightColor:c}=i;if(e||o.autoHighlight!==r||o.highlightedObjectIndex!==a||o.highlightColor!==c){const l={};Array.isArray(c)&&(l.highlightColor=c),(e||o.autoHighlight!==r||a!==o.highlightedObjectIndex)&&(l.highlightedObjectColor=Number.isFinite(a)&&a>=0?this.encodePickingColor(a):null),this.setShaderModuleProps({picking:l})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(t){if(!this.internalState)return!1;let e=!1;e=e||this.internalState.needsRedraw&&this.id;const i=this.getAttributeManager(),o=i?i.getNeedsRedraw(t):!1;if(e=e||o,e)for(const s of this.props.extensions)s.onNeedsRedraw.call(this,s);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!t.clearRedrawFlags,e}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}Ct.defaultProps=Ya;Ct.layerName="Layer";const Ha="compositeLayer.renderLayers";class dt extends Ct{get isComposite(){return!0}get isDrawable(){return!1}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(t=>t.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(t){}setState(t){super.setState(t),this.setNeedsUpdate()}getPickingInfo({info:t}){const{object:e}=t;return e&&e.__source&&e.__source.parent&&e.__source.parent.id===this.id&&(t.object=e.__source.object,t.index=e.__source.index),t}filterSubLayer(t){return!0}shouldRenderSubLayer(t,e){return e&&e.length}getSubLayerClass(t,e){const{_subLayerProps:i}=this.props;return i&&i[t]&&i[t].type||e}getSubLayerRow(t,e,i){return t.__source={parent:this,object:e,index:i},t}getSubLayerAccessor(t){if(typeof t=="function"){const e={index:-1,data:this.props.data,target:[]};return(i,o)=>i&&i.__source?(e.index=i.__source.index,t(i.__source.object,e)):t(i,o)}return t}getSubLayerProps(t={}){const{opacity:e,pickable:i,visible:o,parameters:s,getPolygonOffset:r,highlightedObjectIndex:a,autoHighlight:c,highlightColor:l,coordinateSystem:u,coordinateOrigin:d,wrapLongitude:g,positionFormat:h,modelMatrix:p,extensions:A,fetch:f,operation:C,_subLayerProps:y}=this.props,v={id:"",updateTriggers:{},opacity:e,pickable:i,visible:o,parameters:s,getPolygonOffset:r,highlightedObjectIndex:a,autoHighlight:c,highlightColor:l,coordinateSystem:u,coordinateOrigin:d,wrapLongitude:g,positionFormat:h,modelMatrix:p,extensions:A,fetch:f,operation:C},b=y&&t.id&&y[t.id],x=b&&b.updateTriggers,I=t.id||"sublayer";if(b){const Q=this.props[wt],R=t.type?t.type._propTypes:{};for(const M in b){const z=R[M]||Q[M];z&&z.type==="accessor"&&(b[M]=this.getSubLayerAccessor(b[M]))}}Object.assign(v,t,b),v.id=`${this.props.id}-${I}`,v.updateTriggers={all:this.props.updateTriggers?.all,...t.updateTriggers,...x};for(const Q of A){const R=Q.getSubLayerProps.call(this,Q);R&&Object.assign(v,R,{updateTriggers:Object.assign(v.updateTriggers,R.updateTriggers)})}return v}_updateAutoHighlight(t){for(const e of this.getSubLayers())e.updateAutoHighlight(t)}_getAttributeManager(){return null}_postUpdate(t,e){let i=this.internalState.subLayers;const o=!i||this.needsUpdate();if(o){const s=this.renderLayers();i=vr(s,Boolean),this.internalState.subLayers=i}st(Ha,this,o,i);for(const s of i)s.parent=this}}dt.layerName="CompositeLayer";class $a{constructor(t){this.indexStarts=[0],this.vertexStarts=[0],this.vertexCount=0,this.instanceCount=0;const{attributes:e={}}=t;this.typedArrayManager=Re,this.attributes={},this._attributeDefs=e,this.opts=t,this.updateGeometry(t)}updateGeometry(t){Object.assign(this.opts,t);const{data:e,buffers:i={},getGeometry:o,geometryBuffer:s,positionFormat:r,dataChanged:a,normalize:c=!0}=this.opts;if(this.data=e,this.getGeometry=o,this.positionSize=s&&s.size||(r==="XY"?2:3),this.buffers=i,this.normalize=c,s&&(vt(e.startIndices),this.getGeometry=this.getGeometryFromBuffer(s),c||(i.vertexPositions=s)),this.geometryBuffer=i.vertexPositions,Array.isArray(a))for(const l of a)this._rebuildGeometry(l);else this._rebuildGeometry()}updatePartialGeometry({startRow:t,endRow:e}){this._rebuildGeometry({startRow:t,endRow:e})}getGeometryFromBuffer(t){const e=t.value||t;return ArrayBuffer.isView(e)?$o(e,{size:this.positionSize,offset:t.offset,stride:t.stride,startIndices:this.data.startIndices}):null}_allocate(t,e){const{attributes:i,buffers:o,_attributeDefs:s,typedArrayManager:r}=this;for(const a in s)if(a in o)r.release(i[a]),i[a]=null;else{const c=s[a];c.copy=e,i[a]=r.allocate(i[a],t,c)}}_forEachGeometry(t,e,i){const{data:o,getGeometry:s}=this,{iterable:r,objectInfo:a}=Xe(o,e,i);for(const c of r){a.index++;const l=s?s(c,a):null;t(l,a.index)}}_rebuildGeometry(t){if(!this.data)return;let{indexStarts:e,vertexStarts:i,instanceCount:o}=this;const{data:s,geometryBuffer:r}=this,{startRow:a=0,endRow:c=1/0}=t||{},l={};if(t||(e=[0],i=[0]),this.normalize||!r)this._forEachGeometry((d,g)=>{const h=d&&this.normalizeGeometry(d);l[g]=h,i[g+1]=i[g]+(h?this.getGeometrySize(h):0)},a,c),o=i[i.length-1];else if(i=s.startIndices,o=i[s.length]||0,ArrayBuffer.isView(r))o=o||r.length/this.positionSize;else if(r instanceof Lt){const d=this.positionSize*4;o=o||r.byteLength/d}else if(r.buffer){const d=r.stride||this.positionSize*4;o=o||r.buffer.byteLength/d}else if(r.value){const d=r.value,g=r.stride/d.BYTES_PER_ELEMENT||this.positionSize;o=o||d.length/g}this._allocate(o,!!t),this.indexStarts=e,this.vertexStarts=i,this.instanceCount=o;const u={};this._forEachGeometry((d,g)=>{const h=l[g]||d;u.vertexStart=i[g],u.indexStart=e[g];const p=g<i.length-1?i[g+1]:o;u.geometrySize=p-i[g],u.geometryIndex=g,this.updateGeometryAttributes(h,u)},a,c),this.vertexCount=e[e.length-1]}}const tc=new Uint32Array([0,2,1,0,3,2]),ec=new Float32Array([0,1,0,0,1,0,1,1]);function ic(n,t){if(!t)return nc(n);const e=Math.max(Math.abs(n[0][0]-n[3][0]),Math.abs(n[1][0]-n[2][0])),i=Math.max(Math.abs(n[1][1]-n[0][1]),Math.abs(n[2][1]-n[3][1])),o=Math.ceil(e/t)+1,s=Math.ceil(i/t)+1,r=(o-1)*(s-1)*6,a=new Uint32Array(r),c=new Float32Array(o*s*2),l=new Float64Array(o*s*3);let u=0,d=0;for(let g=0;g<o;g++){const h=g/(o-1);for(let p=0;p<s;p++){const A=p/(s-1),f=oc(n,h,A);l[u*3+0]=f[0],l[u*3+1]=f[1],l[u*3+2]=f[2]||0,c[u*2+0]=h,c[u*2+1]=1-A,g>0&&p>0&&(a[d++]=u-s,a[d++]=u-s-1,a[d++]=u-1,a[d++]=u-s,a[d++]=u-1,a[d++]=u),u++}}return{vertexCount:r,positions:l,indices:a,texCoords:c}}function nc(n){const t=new Float64Array(12);for(let e=0;e<n.length;e++)t[e*3+0]=n[e][0],t[e*3+1]=n[e][1],t[e*3+2]=n[e][2]||0;return{vertexCount:6,positions:t,indices:tc,texCoords:ec}}function oc(n,t,e){return _e(_e(n[0],n[1],e),_e(n[3],n[2],e),t)}const fn=`uniform bitmapUniforms {
  vec4 bounds;
  float coordinateConversion;
  float desaturate;
  vec3 tintColor;
  vec4 transparentColor;
} bitmap;
`,sc={name:"bitmap",vs:fn,fs:fn,uniformTypes:{bounds:"vec4<f32>",coordinateConversion:"f32",desaturate:"f32",tintColor:"vec3<f32>",transparentColor:"vec4<f32>"}},rc=`#version 300 es
#define SHADER_NAME bitmap-layer-vertex-shader

in vec2 texCoords;
in vec3 positions;
in vec3 positions64Low;

out vec2 vTexCoord;
out vec2 vTexPos;

const vec3 pickingColor = vec3(1.0, 0.0, 0.0);

void main(void) {
  geometry.worldPosition = positions;
  geometry.uv = texCoords;
  geometry.pickingColor = pickingColor;

  gl_Position = project_position_to_clipspace(positions, positions64Low, vec3(0.0), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  vTexCoord = texCoords;

  if (bitmap.coordinateConversion < -0.5) {
    vTexPos = geometry.position.xy + project.commonOrigin.xy;
  } else if (bitmap.coordinateConversion > 0.5) {
    vTexPos = geometry.worldPosition.xy;
  }

  vec4 color = vec4(0.0);
  DECKGL_FILTER_COLOR(color, geometry);
}
`,ac=`
vec3 packUVsIntoRGB(vec2 uv) {
  // Extract the top 8 bits. We want values to be truncated down so we can add a fraction
  vec2 uv8bit = floor(uv * 256.);

  // Calculate the normalized remainders of u and v parts that do not fit into 8 bits
  // Scale and clamp to 0-1 range
  vec2 uvFraction = fract(uv * 256.);
  vec2 uvFraction4bit = floor(uvFraction * 16.);

  // Remainder can be encoded in blue channel, encode as 4 bits for pixel coordinates
  float fractions = uvFraction4bit.x + uvFraction4bit.y * 16.;

  return vec3(uv8bit, fractions) / 255.;
}
`,cc=`#version 300 es
#define SHADER_NAME bitmap-layer-fragment-shader

#ifdef GL_ES
precision highp float;
#endif

uniform sampler2D bitmapTexture;

in vec2 vTexCoord;
in vec2 vTexPos;

out vec4 fragColor;

/* projection utils */
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / PI / 2.0;

// from degrees to Web Mercator
vec2 lnglat_to_mercator(vec2 lnglat) {
  float x = lnglat.x;
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// from Web Mercator to degrees
vec2 mercator_to_lnglat(vec2 xy) {
  xy /= WORLD_SCALE;
  return degrees(vec2(
    xy.x - PI,
    atan(exp(xy.y - PI)) * 2.0 - PI * 0.5
  ));
}
/* End projection utils */

// apply desaturation
vec3 color_desaturate(vec3 color) {
  float luminance = (color.r + color.g + color.b) * 0.333333333;
  return mix(color, vec3(luminance), bitmap.desaturate);
}

// apply tint
vec3 color_tint(vec3 color) {
  return color * bitmap.tintColor;
}

// blend with background color
vec4 apply_opacity(vec3 color, float alpha) {
  if (bitmap.transparentColor.a == 0.0) {
    return vec4(color, alpha);
  }
  float blendedAlpha = alpha + bitmap.transparentColor.a * (1.0 - alpha);
  float highLightRatio = alpha / blendedAlpha;
  vec3 blendedRGB = mix(bitmap.transparentColor.rgb, color, highLightRatio);
  return vec4(blendedRGB, blendedAlpha);
}

vec2 getUV(vec2 pos) {
  return vec2(
    (pos.x - bitmap.bounds[0]) / (bitmap.bounds[2] - bitmap.bounds[0]),
    (pos.y - bitmap.bounds[3]) / (bitmap.bounds[1] - bitmap.bounds[3])
  );
}

${ac}

void main(void) {
  vec2 uv = vTexCoord;
  if (bitmap.coordinateConversion < -0.5) {
    vec2 lnglat = mercator_to_lnglat(vTexPos);
    uv = getUV(lnglat);
  } else if (bitmap.coordinateConversion > 0.5) {
    vec2 commonPos = lnglat_to_mercator(vTexPos);
    uv = getUV(commonPos);
  }
  vec4 bitmapColor = texture(bitmapTexture, uv);

  fragColor = apply_opacity(color_tint(color_desaturate(bitmapColor.rgb)), bitmapColor.a * layer.opacity);

  geometry.uv = uv;
  DECKGL_FILTER_COLOR(fragColor, geometry);

  if (bool(picking.isActive) && !bool(picking.isAttribute)) {
    // Since instance information is not used, we can use picking color for pixel index
    fragColor.rgb = packUVsIntoRGB(uv);
  }
}
`,lc={image:{type:"image",value:null,async:!0},bounds:{type:"array",value:[1,0,0,1],compare:!0},_imageCoordinateSystem:H.DEFAULT,desaturate:{type:"number",min:0,max:1,value:0},transparentColor:{type:"color",value:[0,0,0,0]},tintColor:{type:"color",value:[255,255,255]},textureParameters:{type:"object",ignore:!0,value:null}};class He extends Ct{getShaders(){return super.getShaders({vs:rc,fs:cc,modules:[qt,Kt,sc]})}initializeState(){const t=this.getAttributeManager();t.remove(["instancePickingColors"]);const e=!0;t.add({indices:{size:1,isIndexed:!0,update:i=>i.value=this.state.mesh.indices,noAlloc:e},positions:{size:3,type:"float64",fp64:this.use64bitPositions(),update:i=>i.value=this.state.mesh.positions,noAlloc:e},texCoords:{size:2,update:i=>i.value=this.state.mesh.texCoords,noAlloc:e}})}updateState({props:t,oldProps:e,changeFlags:i}){const o=this.getAttributeManager();if(i.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),o.invalidateAll()),t.bounds!==e.bounds){const s=this.state.mesh,r=this._createMesh();this.state.model.setVertexCount(r.vertexCount);for(const a in r)s&&s[a]!==r[a]&&o.invalidate(a);this.setState({mesh:r,...this._getCoordinateUniforms()})}else t._imageCoordinateSystem!==e._imageCoordinateSystem&&this.setState(this._getCoordinateUniforms())}getPickingInfo(t){const{image:e}=this.props,i=t.info;if(!i.color||!e)return i.bitmap=null,i;const{width:o,height:s}=e;i.index=0;const r=uc(i.color);return i.bitmap={size:{width:o,height:s},uv:r,pixel:[Math.floor(r[0]*o),Math.floor(r[1]*s)]},i}disablePickingIndex(){this.setState({disablePicking:!0})}restorePickingColors(){this.setState({disablePicking:!1})}_updateAutoHighlight(t){super._updateAutoHighlight({...t,color:this.encodePickingColor(0)})}_createMesh(){const{bounds:t}=this.props;let e=t;return pn(t)&&(e=[[t[0],t[1]],[t[0],t[3]],[t[2],t[3]],[t[2],t[1]]]),ic(e,this.context.viewport.resolution)}_getModel(){return new Pt(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),topology:"triangle-list",isInstanced:!1})}draw(t){const{shaderModuleProps:e}=t,{model:i,coordinateConversion:o,bounds:s,disablePicking:r}=this.state,{image:a,desaturate:c,transparentColor:l,tintColor:u}=this.props;if(!(e.picking.isActive&&r)&&a&&i){const d={bitmapTexture:a,bounds:s,coordinateConversion:o,desaturate:c,tintColor:u.slice(0,3).map(g=>g/255),transparentColor:l.map(g=>g/255)};i.shaderInputs.setProps({bitmap:d}),i.draw(this.context.renderPass)}}_getCoordinateUniforms(){const{LNGLAT:t,CARTESIAN:e,DEFAULT:i}=H;let{_imageCoordinateSystem:o}=this.props;if(o!==i){const{bounds:s}=this.props;if(!pn(s))throw new Error("_imageCoordinateSystem only supports rectangular bounds");const r=this.context.viewport.resolution?t:e;if(o=o===t?t:e,o===t&&r===e)return{coordinateConversion:-1,bounds:s};if(o===e&&r===t){const a=$i([s[0],s[1]]),c=$i([s[2],s[3]]);return{coordinateConversion:1,bounds:[a[0],a[1],c[0],c[1]]}}}return{coordinateConversion:0,bounds:[0,0,0,0]}}}He.layerName="BitmapLayer";He.defaultProps=lc;function uc(n){const[t,e,i]=n,o=(i&240)/256,s=(i&15)/16;return[(t+s)/256,(e+o)/256]}function pn(n){return Number.isFinite(n[0])}const An=`uniform iconUniforms {
  float sizeScale;
  vec2 iconsTextureDim;
  float sizeMinPixels;
  float sizeMaxPixels;
  bool billboard;
  highp int sizeUnits;
  float alphaCutoff;
} icon;
`,dc={name:"icon",vs:An,fs:An,uniformTypes:{sizeScale:"f32",iconsTextureDim:"vec2<f32>",sizeMinPixels:"f32",sizeMaxPixels:"f32",billboard:"f32",sizeUnits:"i32",alphaCutoff:"f32"}},gc=`#version 300 es
#define SHADER_NAME icon-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceSizes;
in float instanceAngles;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec4 instanceIconFrames;
in float instanceColorModes;
in vec2 instanceOffsets;
in vec2 instancePixelOffset;
out float vColorMode;
out vec4 vColor;
out vec2 vTextureCoords;
out vec2 uv;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = angle * PI / 180.0;
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vec2 iconSize = instanceIconFrames.zw;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * icon.sizeScale, icon.sizeUnits),
icon.sizeMinPixels, icon.sizeMaxPixels
);
float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;
vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
pixelOffset += instancePixelOffset;
pixelOffset.y *= -1.0;
if (icon.billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vTextureCoords = mix(
instanceIconFrames.xy,
instanceIconFrames.xy + iconSize,
(positions.xy + 1.0) / 2.0
) / icon.iconsTextureDim;
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
vColorMode = instanceColorModes;
}
`,hc=`#version 300 es
#define SHADER_NAME icon-layer-fragment-shader
precision highp float;
uniform sampler2D iconsTexture;
in float vColorMode;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec4 texColor = texture(iconsTexture, vTextureCoords);
vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
float a = texColor.a * layer.opacity * vColor.a;
if (a < icon.alphaCutoff) {
discard;
}
fragColor = vec4(color, a);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,fc=1024,pc=4,mn=()=>{},vn={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},Ac={x:0,y:0,width:0,height:0};function mc(n){return Math.pow(2,Math.ceil(Math.log2(n)))}function vc(n,t,e,i){const o=Math.min(e/t.width,i/t.height),s=Math.floor(t.width*o),r=Math.floor(t.height*o);return o===1?{image:t,width:s,height:r}:(n.canvas.height=r,n.canvas.width=s,n.clearRect(0,0,s,r),n.drawImage(t,0,0,t.width,t.height,0,0,s,r),{image:n.canvas,width:s,height:r})}function le(n){return n&&(n.id||n.url)}function Cc(n,t,e,i){const{width:o,height:s,device:r}=n,a=r.createTexture({format:"rgba8unorm",width:t,height:e,sampler:i,mipmaps:!0}),c=r.createCommandEncoder();return c.copyTextureToTexture({sourceTexture:n,destinationTexture:a,width:o,height:s}),c.finish(),n.destroy(),a}function Cn(n,t,e){for(let i=0;i<t.length;i++){const{icon:o,xOffset:s}=t[i],r=le(o);n[r]={...o,x:s,y:e}}}function yc({icons:n,buffer:t,mapping:e={},xOffset:i=0,yOffset:o=0,rowHeight:s=0,canvasWidth:r}){let a=[];for(let c=0;c<n.length;c++){const l=n[c],u=le(l);if(!e[u]){const{height:d,width:g}=l;i+g+t>r&&(Cn(e,a,o),i=0,o=s+o+t,s=0,a=[]),a.push({icon:l,xOffset:i}),i=i+g+t,s=Math.max(s,d)}}return a.length>0&&Cn(e,a,o),{mapping:e,rowHeight:s,xOffset:i,yOffset:o,canvasWidth:r,canvasHeight:mc(s+o+t)}}function Ec(n,t,e){if(!n||!t)return null;e=e||{};const i={},{iterable:o,objectInfo:s}=Xe(n);for(const r of o){s.index++;const a=t(r,s),c=le(a);if(!a)throw new Error("Icon is missing.");if(!a.url)throw new Error("Icon url is missing.");!i[c]&&(!e[c]||a.url!==e[c].url)&&(i[c]={...a,source:r,sourceIndex:s.index})}return i}class bc{constructor(t,{onUpdate:e=mn,onError:i=mn}){this._loadOptions=null,this._texture=null,this._externalTexture=null,this._mapping={},this._samplerParameters=null,this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=pc,this._canvasWidth=fc,this._canvasHeight=0,this._canvas=null,this.device=t,this.onUpdate=e,this.onError=i}finalize(){this._texture?.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(t){const e=this._autoPacking?le(t):t;return this._mapping[e]||Ac}setProps({loadOptions:t,autoPacking:e,iconAtlas:i,iconMapping:o,textureParameters:s}){t&&(this._loadOptions=t),e!==void 0&&(this._autoPacking=e),o&&(this._mapping=o),i&&(this._texture?.delete(),this._texture=null,this._externalTexture=i),s&&(this._samplerParameters=s)}get isLoaded(){return this._pendingCount===0}packIcons(t,e){if(!this._autoPacking||typeof document>"u")return;const i=Object.values(Ec(t,e,this._mapping)||{});if(i.length>0){const{mapping:o,xOffset:s,yOffset:r,rowHeight:a,canvasHeight:c}=yc({icons:i,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=a,this._mapping=o,this._xOffset=s,this._yOffset=r,this._canvasHeight=c,this._texture||(this._texture=this.device.createTexture({format:"rgba8unorm",width:this._canvasWidth,height:this._canvasHeight,sampler:this._samplerParameters||vn,mipmaps:!0})),this._texture.height!==this._canvasHeight&&(this._texture=Cc(this._texture,this._canvasWidth,this._canvasHeight,this._samplerParameters||vn)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(i)}}_loadIcons(t){const e=this._canvas.getContext("2d",{willReadFrequently:!0});for(const i of t)this._pendingCount++,Ii(i.url,this._loadOptions).then(o=>{const s=le(i),r=this._mapping[s],{x:a,y:c,width:l,height:u}=r,{image:d,width:g,height:h}=vc(e,o,l,u);this._texture?.copyExternalImage({image:d,x:a+(l-g)/2,y:c+(u-h)/2,width:g,height:h}),r.width=g,r.height=h,this._texture.generateMipmap(),this.onUpdate()}).catch(o=>{this.onError({url:i.url,source:i.source,sourceIndex:i.sourceIndex,loadOptions:this._loadOptions,error:o})}).finally(()=>{this._pendingCount--})}}const ds=[0,0,0,255],Ic={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:n=>n.position},getIcon:{type:"accessor",value:n=>n.icon},getColor:{type:"accessor",value:ds},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0,value:null}};class de extends Ct{getShaders(){return super.getShaders({vs:gc,fs:hc,modules:[qt,Kt,dc]})}initializeState(){this.state={iconManager:new bc(this.context.device,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:"uint8",accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:ds},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(t){super.updateState(t);const{props:e,oldProps:i,changeFlags:o}=t,s=this.getAttributeManager(),{iconAtlas:r,iconMapping:a,data:c,getIcon:l,textureParameters:u}=e,{iconManager:d}=this.state;if(typeof r=="string")return;const g=r||this.internalState.isAsyncPropLoading("iconAtlas");d.setProps({loadOptions:e.loadOptions,autoPacking:!g,iconAtlas:r,iconMapping:g?a:null,textureParameters:u}),g?i.iconMapping!==e.iconMapping&&s.invalidate("getIcon"):(o.dataChanged||o.updateTriggersChanged&&(o.updateTriggersChanged.all||o.updateTriggersChanged.getIcon))&&d.packIcons(c,l),o.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),s.invalidateAll())}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(t){super.finalizeState(t),this.state.iconManager.finalize()}draw({uniforms:t}){const{sizeScale:e,sizeMinPixels:i,sizeMaxPixels:o,sizeUnits:s,billboard:r,alphaCutoff:a}=this.props,{iconManager:c}=this.state,l=c.getTexture();if(l){const u=this.state.model,d={iconsTexture:l,iconsTextureDim:[l.width,l.height],sizeUnits:zt[s],sizeScale:e,sizeMinPixels:i,sizeMaxPixels:o,billboard:r,alphaCutoff:a};u.shaderInputs.setProps({icon:d}),u.draw(this.context.renderPass)}}_getModel(){const t=[-1,-1,1,-1,-1,1,1,1];return new Pt(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new ue({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array(t)}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(t){const e=this.getCurrentLayer()?.props.onIconError;e?e(t):it.error(t.error.message)()}getInstanceOffset(t){const{width:e,height:i,anchorX:o=e/2,anchorY:s=i/2}=this.state.iconManager.getIconMapping(t);return[e/2-o,i/2-s]}getInstanceColorMode(t){return this.state.iconManager.getIconMapping(t).mask?1:0}getInstanceIconFrame(t){const{x:e,y:i,width:o,height:s}=this.state.iconManager.getIconMapping(t);return[e,i,o,s]}}de.defaultProps=Ic;de.layerName="IconLayer";const xc=`struct LineUniforms {
  widthScale: f32,
  widthMinPixels: f32,
  widthMaxPixels: f32,
  useShortestPath: f32,
  widthUnits: i32,
};

@group(0) @binding(1)
var<uniform> line: LineUniforms;
`,yn=`uniform lineUniforms {
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  float useShortestPath;
  highp int widthUnits;
} line;
`,wc={name:"line",source:xc,vs:yn,fs:yn,uniformTypes:{widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",useShortestPath:"f32",widthUnits:"i32"}},Pc=`// TODO(ibgreen): Hack for Layer uniforms (move to new "color" module?)
struct LayerUniforms {
  opacity: f32,
};
var<private> layer: LayerUniforms = LayerUniforms(1.0);
// @group(0) @binding(1) var<uniform> layer: LayerUniforms;

// ---------- Helper Structures & Functions ----------

// Placeholder filter functions.
fn deckgl_filter_size(offset: vec3<f32>, geometry: Geometry) -> vec3<f32> {
  return offset;
}
fn deckgl_filter_gl_position(p: vec4<f32>, geometry: Geometry) -> vec4<f32> {
  return p;
}
fn deckgl_filter_color(color: vec4<f32>, geometry: Geometry) -> vec4<f32> {
  return color;
}

// Compute an extrusion offset given a line direction (in clipspace),
// an offset direction (-1 or 1), and a width in pixels.
// Assumes a uniform "project" with a viewportSize field is available.
fn getExtrusionOffset(line_clipspace: vec2<f32>, offset_direction: f32, width: f32) -> vec2<f32> {
  // project.viewportSize should be provided as a uniform (not shown here)
  let dir_screenspace = normalize(line_clipspace * project.viewportSize);
  // Rotate by 90: (x,y) becomes (-y,x)
  let rotated = vec2<f32>(-dir_screenspace.y, dir_screenspace.x);
  return rotated * offset_direction * width / 2.0;
}

// Splits the line between two points at a given x coordinate.
// Interpolates the y and z components.
fn splitLine(a: vec3<f32>, b: vec3<f32>, x: f32) -> vec3<f32> {
  let t: f32 = (x - a.x) / (b.x - a.x);
  return vec3<f32>(x, a.yz + t * (b.yz - a.yz));
}

// ---------- Uniforms & Global Structures ----------

// Uniforms for line, layer, and project are assumed to be defined elsewhere.
// For example:
//
// @group(0) @binding(0)
// var<uniform> line: LineUniform;
//
// struct LayerUniform {
//   opacity: f32,
// };
// @group(0) @binding(1)
// var<uniform> layer: LayerUniform;
//
// struct ProjectUniform {
//   viewportSize: vec2<f32>,
// };
// @group(0) @binding(2)
// var<uniform> project: ProjectUniform;



// ---------- Vertex Output Structure ----------

struct Varyings {
  @builtin(position) gl_Position: vec4<f32>,
  @location(0) vColor: vec4<f32>,
  @location(1) uv: vec2<f32>,
};

// ---------- Vertex Shader Entry Point ----------

@vertex
fn vertexMain(
  @location(0) positions: vec3<f32>,
  @location(1) instanceSourcePositions: vec3<f32>,
  @location(2) instanceTargetPositions: vec3<f32>,
  @location(3) instanceSourcePositions64Low: vec3<f32>,
  @location(4) instanceTargetPositions64Low: vec3<f32>,
  @location(5) instanceColors: vec4<f32>,
  @location(6) instancePickingColors: vec3<f32>,
  @location(7) instanceWidths: f32
) -> Varyings {
  var geometry: Geometry;
  geometry.worldPosition = instanceSourcePositions;
  geometry.worldPositionAlt = instanceTargetPositions;

  var source_world: vec3<f32> = instanceSourcePositions;
  var target_world: vec3<f32> = instanceTargetPositions;
  var source_world_64low: vec3<f32> = instanceSourcePositions64Low;
  var target_world_64low: vec3<f32> = instanceTargetPositions64Low;

  // Apply shortest-path adjustments if needed.
  if (line.useShortestPath > 0.5 || line.useShortestPath < -0.5) {
    source_world.x = (source_world.x + 180.0 % 360.0) - 180.0;
    target_world.x = (target_world.x + 180.0 % 360.0) - 180.0;
    let deltaLng: f32 = target_world.x - source_world.x;

    if (deltaLng * line.useShortestPath > 180.0) {
      source_world.x = source_world.x + 360.0 * line.useShortestPath;
      source_world = splitLine(source_world, target_world, 180.0 * line.useShortestPath);
      source_world_64low = vec3<f32>(0.0, 0.0, 0.0);
    } else if (deltaLng * line.useShortestPath < -180.0) {
      target_world.x = target_world.x + 360.0 * line.useShortestPath;
      target_world = splitLine(source_world, target_world, 180.0 * line.useShortestPath);
      target_world_64low = vec3<f32>(0.0, 0.0, 0.0);
    } else if (line.useShortestPath < 0.0) {
      var abortOut: Varyings;
      abortOut.gl_Position = vec4<f32>(0.0);
      abortOut.vColor = vec4<f32>(0.0);
      abortOut.uv = vec2<f32>(0.0);
      return abortOut;
    }
  }

  // Project Pos and target positions to clip space.
  let sourceResult = project_position_to_clipspace_and_commonspace(source_world, source_world_64low, vec3<f32>(0.0));
  let targetResult = project_position_to_clipspace_and_commonspace(target_world, target_world_64low, vec3<f32>(0.0));
  let sourcePos: vec4<f32> = sourceResult.clipPosition;
  let targetPos: vec4<f32> = targetResult.clipPosition;
  let source_commonspace: vec4<f32> = sourceResult.commonPosition;
  let target_commonspace: vec4<f32> = targetResult.commonPosition;

  // Interpolate along the line segment.
  let segmentIndex: f32 = positions.x;
  let p: vec4<f32> = sourcePos + segmentIndex * (targetPos - sourcePos);
  geometry.position = source_commonspace + segmentIndex * (target_commonspace - source_commonspace);
  let uv: vec2<f32> = positions.xy;
  geometry.uv = uv;
  geometry.pickingColor = instancePickingColors;

  // Determine width in pixels.
  let widthPixels: f32 = clamp(
    project_unit_size_to_pixel(instanceWidths * line.widthScale, line.widthUnits),
    line.widthMinPixels, line.widthMaxPixels
  );

  // Compute extrusion offset.
  let extrusion: vec2<f32> = getExtrusionOffset(targetPos.xy - sourcePos.xy, positions.y, widthPixels);
  let offset: vec3<f32> = vec3<f32>(extrusion, 0.0);

  // Apply deck.gl filter functions.
  let filteredOffset = deckgl_filter_size(offset, geometry);
  let filteredP = deckgl_filter_gl_position(p, geometry);

  let clipOffset: vec2<f32> = project_pixel_size_to_clipspace(filteredOffset.xy);
  let finalPosition: vec4<f32> = filteredP + vec4<f32>(clipOffset, 0.0, 0.0);

  // Compute color.
  var vColor: vec4<f32> = vec4<f32>(instanceColors.rgb, instanceColors.a * layer.opacity);
  // vColor = deckgl_filter_color(vColor, geometry);

  var output: Varyings;
  output.gl_Position = finalPosition;
  output.vColor = vColor;
  output.uv = uv;
  return output;
}

@fragment
fn fragmentMain(
  @location(0) vColor: vec4<f32>,
  @location(1) uv: vec2<f32>
) -> @location(0) vec4<f32> {
  // Create and initialize geometry with the provided uv.
  var geometry: Geometry;
  geometry.uv = uv;

  // Start with the input color.
  var fragColor: vec4<f32> = vColor;

  // Apply the deck.gl filter to the color.
  fragColor = deckgl_filter_color(fragColor, geometry);

  return fragColor;
}
`,Tc=`#version 300 es
#define SHADER_NAME line-layer-vertex-shader
in vec3 positions;
in vec3 instanceSourcePositions;
in vec3 instanceTargetPositions;
in vec3 instanceSourcePositions64Low;
in vec3 instanceTargetPositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in float instanceWidths;
out vec4 vColor;
out vec2 uv;
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
vec2 dir_screenspace = normalize(line_clipspace * project.viewportSize);
dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
return dir_screenspace * offset_direction * width / 2.0;
}
vec3 splitLine(vec3 a, vec3 b, float x) {
float t = (x - a.x) / (b.x - a.x);
return vec3(x, mix(a.yz, b.yz, t));
}
void main(void) {
geometry.worldPosition = instanceSourcePositions;
geometry.worldPositionAlt = instanceTargetPositions;
vec3 source_world = instanceSourcePositions;
vec3 target_world = instanceTargetPositions;
vec3 source_world_64low = instanceSourcePositions64Low;
vec3 target_world_64low = instanceTargetPositions64Low;
if (line.useShortestPath > 0.5 || line.useShortestPath < -0.5) {
source_world.x = mod(source_world.x + 180., 360.0) - 180.;
target_world.x = mod(target_world.x + 180., 360.0) - 180.;
float deltaLng = target_world.x - source_world.x;
if (deltaLng * line.useShortestPath > 180.) {
source_world.x += 360. * line.useShortestPath;
source_world = splitLine(source_world, target_world, 180. * line.useShortestPath);
source_world_64low = vec3(0.0);
} else if (deltaLng * line.useShortestPath < -180.) {
target_world.x += 360. * line.useShortestPath;
target_world = splitLine(source_world, target_world, 180. * line.useShortestPath);
target_world_64low = vec3(0.0);
} else if (line.useShortestPath < 0.) {
gl_Position = vec4(0.);
return;
}
}
vec4 source_commonspace;
vec4 target_commonspace;
vec4 source = project_position_to_clipspace(source_world, source_world_64low, vec3(0.), source_commonspace);
vec4 target = project_position_to_clipspace(target_world, target_world_64low, vec3(0.), target_commonspace);
float segmentIndex = positions.x;
vec4 p = mix(source, target, segmentIndex);
geometry.position = mix(source_commonspace, target_commonspace, segmentIndex);
uv = positions.xy;
geometry.uv = uv;
geometry.pickingColor = instancePickingColors;
float widthPixels = clamp(
project_size_to_pixel(instanceWidths * line.widthScale, line.widthUnits),
line.widthMinPixels, line.widthMaxPixels
);
vec3 offset = vec3(
getExtrusionOffset(target.xy - source.xy, positions.y, widthPixels),
0.0);
DECKGL_FILTER_SIZE(offset, geometry);
DECKGL_FILTER_GL_POSITION(p, geometry);
gl_Position = p + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);
vColor = vec4(instanceColors.rgb, instanceColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Bc=`#version 300 es
#define SHADER_NAME line-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,_c=[0,0,0,255],Sc={getSourcePosition:{type:"accessor",value:n=>n.sourcePosition},getTargetPosition:{type:"accessor",value:n=>n.targetPosition},getColor:{type:"accessor",value:_c},getWidth:{type:"accessor",value:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}};class zi extends Ct{getBounds(){return this.getAttributeManager()?.getBounds(["instanceSourcePositions","instanceTargetPositions"])}getShaders(){return super.getShaders({vs:Tc,fs:Bc,source:Pc,modules:[qt,Kt,wc]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1}})}updateState(t){super.updateState(t),t.changeFlags.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:t}){const{widthUnits:e,widthScale:i,widthMinPixels:o,widthMaxPixels:s,wrapLongitude:r}=this.props,a=this.state.model,c={widthUnits:zt[e],widthScale:i,widthMinPixels:o,widthMaxPixels:s,useShortestPath:r?1:0};a.shaderInputs.setProps({line:c}),a.draw(this.context.renderPass),r&&(a.shaderInputs.setProps({line:{...c,useShortestPath:-1}}),a.draw(this.context.renderPass))}_getModel(){const t=[0,-1,0,0,1,0,1,-1,0,1,1,0];return new Pt(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new ue({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(t)}}}),isInstanced:!0})}}zi.layerName="LineLayer";zi.defaultProps=Sc;const En=`uniform scatterplotUniforms {
  float radiusScale;
  float radiusMinPixels;
  float radiusMaxPixels;
  float lineWidthScale;
  float lineWidthMinPixels;
  float lineWidthMaxPixels;
  float stroked;
  float filled;
  bool antialiasing;
  bool billboard;
  highp int radiusUnits;
  highp int lineWidthUnits;
} scatterplot;
`,Lc={name:"scatterplot",vs:En,fs:En,source:"",uniformTypes:{radiusScale:"f32",radiusMinPixels:"f32",radiusMaxPixels:"f32",lineWidthScale:"f32",lineWidthMinPixels:"f32",lineWidthMaxPixels:"f32",stroked:"f32",filled:"f32",antialiasing:"f32",billboard:"f32",radiusUnits:"i32",lineWidthUnits:"i32"}},Mc=`#version 300 es
#define SHADER_NAME scatterplot-layer-vertex-shader
in vec3 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceRadius;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out vec2 unitPosition;
out float innerUnitRadius;
out float outerRadiusPixels;
void main(void) {
geometry.worldPosition = instancePositions;
outerRadiusPixels = clamp(
project_size_to_pixel(scatterplot.radiusScale * instanceRadius, scatterplot.radiusUnits),
scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
);
float lineWidthPixels = clamp(
project_size_to_pixel(scatterplot.lineWidthScale * instanceLineWidths, scatterplot.lineWidthUnits),
scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
);
outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
float edgePadding = scatterplot.antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
unitPosition = edgePadding * positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / outerRadiusPixels;
if (scatterplot.billboard) {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = edgePadding * positions * outerRadiusPixels;
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,Qc=`#version 300 es
#define SHADER_NAME scatterplot-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in vec2 unitPosition;
in float innerUnitRadius;
in float outerRadiusPixels;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition) * outerRadiusPixels;
float inCircle = scatterplot.antialiasing ?
smoothedge(distToCenter, outerRadiusPixels) :
step(distToCenter, outerRadiusPixels);
if (inCircle == 0.0) {
discard;
}
if (scatterplot.stroked > 0.5) {
float isLine = scatterplot.antialiasing ?
smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
step(innerUnitRadius * outerRadiusPixels, distToCenter);
if (scatterplot.filled > 0.5) {
fragColor = mix(vFillColor, vLineColor, isLine);
} else {
if (isLine == 0.0) {
discard;
}
fragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
}
} else if (scatterplot.filled < 0.5) {
discard;
} else {
fragColor = vFillColor;
}
fragColor.a *= inCircle;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Oc=`// TODO(ibgreen): Hack for Layer uniforms (move to new "color" module?)

struct LayerUniforms {
  opacity: f32,
};

var<private> layer: LayerUniforms = LayerUniforms(1.0);
// @group(0) @binding(1) var<uniform> layer: LayerUniforms;

// Main shaders

struct ScatterplotUniforms {
  radiusScale: f32,
  radiusMinPixels: f32,
  radiusMaxPixels: f32,
  lineWidthScale: f32,
  lineWidthMinPixels: f32,
  lineWidthMaxPixels: f32,
  stroked: f32,
  filled: i32,
  antialiasing: i32,
  billboard: i32,
  radiusUnits: i32,
  lineWidthUnits: i32,
};

struct ConstantAttributeUniforms {
 instancePositions: vec3<f32>,
 instancePositions64Low: vec3<f32>,
 instanceRadius: f32,
 instanceLineWidths: f32,
 instanceFillColors: vec4<f32>,
 instanceLineColors: vec4<f32>,
 instancePickingColors: vec3<f32>,

 instancePositionsConstant: i32,
 instancePositions64LowConstant: i32,
 instanceRadiusConstant: i32,
 instanceLineWidthsConstant: i32,
 instanceFillColorsConstant: i32,
 instanceLineColorsConstant: i32,
 instancePickingColorsConstant: i32
};

@group(0) @binding(2) var<uniform> scatterplot: ScatterplotUniforms;

struct ConstantAttributes {
  instancePositions: vec3<f32>,
  instancePositions64Low: vec3<f32>,
  instanceRadius: f32,
  instanceLineWidths: f32,
  instanceFillColors: vec4<f32>,
  instanceLineColors: vec4<f32>,
  instancePickingColors: vec3<f32>
};

const constants = ConstantAttributes(
  vec3<f32>(0.0),
  vec3<f32>(0.0),
  0.0,
  0.0,
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec3<f32>(0.0)
);

struct Attributes {
  @builtin(instance_index) instanceIndex : u32,
  @builtin(vertex_index) vertexIndex : u32,
  @location(0) positions: vec3<f32>,
  @location(1) instancePositions: vec3<f32>,
  @location(2) instancePositions64Low: vec3<f32>,
  @location(3) instanceRadius: f32,
  @location(4) instanceLineWidths: f32,
  @location(5) instanceFillColors: vec4<f32>,
  @location(6) instanceLineColors: vec4<f32>,
  @location(7) instancePickingColors: vec3<f32>
};

struct Varyings {
  @builtin(position) position: vec4<f32>,
  @location(0) vFillColor: vec4<f32>,
  @location(1) vLineColor: vec4<f32>,
  @location(2) unitPosition: vec2<f32>,
  @location(3) innerUnitRadius: f32,
  @location(4) outerRadiusPixels: f32,
};

@vertex
fn vertexMain(attributes: Attributes) -> Varyings {
  var varyings: Varyings;

  // Draw an inline geometry constant array clip space triangle to verify that rendering works.
  // var positions = array<vec2<f32>, 3>(vec2(0.0, 0.5), vec2(-0.5, -0.5), vec2(0.5, -0.5));
  // if (attributes.instanceIndex == 0) {
  //   varyings.position = vec4<f32>(positions[attributes.vertexIndex], 0.0, 1.0);
  //   return varyings;
  // }

  // var geometry: Geometry;
  // geometry.worldPosition = instancePositions;

  // Multiply out radius and clamp to limits
  varyings.outerRadiusPixels = clamp(
    project_unit_size_to_pixel(scatterplot.radiusScale * attributes.instanceRadius, scatterplot.radiusUnits),
    scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
  );

  // Multiply out line width and clamp to limits
  let lineWidthPixels = clamp(
    project_unit_size_to_pixel(scatterplot.lineWidthScale * attributes.instanceLineWidths, scatterplot.lineWidthUnits),
    scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
  );

  // outer radius needs to offset by half stroke width
  varyings.outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
  // Expand geometry to accommodate edge smoothing
  let edgePadding = select(
    (varyings.outerRadiusPixels + SMOOTH_EDGE_RADIUS) / varyings.outerRadiusPixels,
    1.0,
    scatterplot.antialiasing != 0
  );

  // position on the containing square in [-1, 1] space
  varyings.unitPosition = edgePadding * attributes.positions.xy;
  geometry.uv = varyings.unitPosition;
  geometry.pickingColor = attributes.instancePickingColors;

  varyings.innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / varyings.outerRadiusPixels;

  if (scatterplot.billboard != 0) {
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, vec3<f32>(0.0)); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
    let offset = attributes.positions; // * edgePadding * varyings.outerRadiusPixels;
    // DECKGL_FILTER_SIZE(offset, geometry);
    let clipPixels = project_pixel_size_to_clipspace(offset.xy);
    varyings.position.x = clipPixels.x;
    varyings.position.y = clipPixels.y;
  } else {
    let offset = edgePadding * attributes.positions * project_pixel_size_float(varyings.outerRadiusPixels);
    // DECKGL_FILTER_SIZE(offset, geometry);
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, offset); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
  }

  // Apply opacity to instance color, or return instance picking color
  varyings.vFillColor = vec4<f32>(attributes.instanceFillColors.rgb, attributes.instanceFillColors.a * layer.opacity);
  // DECKGL_FILTER_COLOR(varyings.vFillColor, geometry);
  varyings.vLineColor = vec4<f32>(attributes.instanceLineColors.rgb, attributes.instanceLineColors.a * layer.opacity);
  // DECKGL_FILTER_COLOR(varyings.vLineColor, geometry);

  return varyings;
}

@fragment
fn fragmentMain(varyings: Varyings) -> @location(0) vec4<f32> {
  // var geometry: Geometry;
  // geometry.uv = unitPosition;

  let distToCenter = length(varyings.unitPosition) * varyings.outerRadiusPixels;
  let inCircle = select(
    smoothedge(distToCenter, varyings.outerRadiusPixels),
    step(distToCenter, varyings.outerRadiusPixels),
    scatterplot.antialiasing != 0
  );

  if (inCircle == 0.0) {
    // discard;
  }

  var fragColor: vec4<f32>;

  if (scatterplot.stroked != 0) {
    let isLine = select(
      smoothedge(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      step(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      scatterplot.antialiasing != 0
    );

    if (scatterplot.filled != 0) {
      fragColor = mix(varyings.vFillColor, varyings.vLineColor, isLine);
    } else {
      if (isLine == 0.0) {
        // discard;
      }
      fragColor = vec4<f32>(varyings.vLineColor.rgb, varyings.vLineColor.a * isLine);
    }
  } else if (scatterplot.filled == 0) {
    // discard;
  } else {
    fragColor = varyings.vFillColor;
  }

  fragColor.a *= inCircle;
  // DECKGL_FILTER_COLOR(fragColor, geometry);

  return fragColor;
  // return vec4<f32>(0, 0, 1, 1);
}
`,bn=[0,0,0,255],Rc={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:n=>n.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:bn},getLineColor:{type:"accessor",value:bn},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class Vi extends Ct{getShaders(){return super.getShaders({vs:Mc,fs:Qc,source:Oc,modules:[qt,Kt,Lc]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(t){super.updateState(t),t.changeFlags.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:t}){const{radiusUnits:e,radiusScale:i,radiusMinPixels:o,radiusMaxPixels:s,stroked:r,filled:a,billboard:c,antialiasing:l,lineWidthUnits:u,lineWidthScale:d,lineWidthMinPixels:g,lineWidthMaxPixels:h}=this.props,p={stroked:r,filled:a,billboard:c,antialiasing:l,radiusUnits:zt[e],radiusScale:i,radiusMinPixels:o,radiusMaxPixels:s,lineWidthUnits:zt[u],lineWidthScale:d,lineWidthMinPixels:g,lineWidthMaxPixels:h},A=this.state.model;A.shaderInputs.setProps({scatterplot:p}),A.draw(this.context.renderPass)}_getModel(){const t=[-1,-1,0,1,-1,0,-1,1,0,1,1,0];return new Pt(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new ue({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(t)}}}),isInstanced:!0})}}Vi.defaultProps=Rc;Vi.layerName="ScatterplotLayer";function ve(n,t){const e=t.length,i=n.length;if(i>0){let o=!0;for(let s=0;s<e;s++)if(n[i-e+s]!==t[s]){o=!1;break}if(o)return!1}for(let o=0;o<e;o++)n[i+o]=t[o];return!0}function In(n,t){const e=t.length;for(let i=0;i<e;i++)n[i]=t[i]}function xn(n,t,e,i,o=[]){const s=i+t*e;for(let r=0;r<e;r++)o[r]=n[s+r];return o}function wn(n,t,e,i,o=[]){let s,r;if(e&8)s=(i[3]-n[1])/(t[1]-n[1]),r=3;else if(e&4)s=(i[1]-n[1])/(t[1]-n[1]),r=1;else if(e&2)s=(i[2]-n[0])/(t[0]-n[0]),r=2;else if(e&1)s=(i[0]-n[0])/(t[0]-n[0]),r=0;else return null;for(let a=0;a<n.length;a++)o[a]=(r&1)===a?i[r]:s*(t[a]-n[a])+n[a];return o}function ri(n,t){let e=0;return n[0]<t[0]?e|=1:n[0]>t[2]&&(e|=2),n[1]<t[1]?e|=4:n[1]>t[3]&&(e|=8),e}function gs(n,t){const{size:e=2,broken:i=!1,gridResolution:o=10,gridOffset:s=[0,0],startIndex:r=0,endIndex:a=n.length}=t||{},c=(a-r)/e;let l=[];const u=[l],d=xn(n,0,e,r);let g,h;const p=Fc(d,o,s,[]),A=[];ve(l,d);for(let f=1;f<c;f++){for(g=xn(n,f,e,r,g),h=ri(g,p);h;){wn(d,g,h,p,A);const C=ri(A,p);C&&(wn(d,A,C,p,A),h=C),ve(l,A),In(d,A),Uc(p,o,h),i&&l.length>e&&(l=[],u.push(l),ve(l,d)),h=ri(g,p)}ve(l,g),In(d,g)}return i?u:u[0]}function Fc(n,t,e,i){const o=Math.floor((n[0]-e[0])/t)*t+e[0],s=Math.floor((n[1]-e[1])/t)*t+e[1];return i[0]=o,i[1]=s,i[2]=o+t,i[3]=s+t,i}function Uc(n,t,e){e&8?(n[1]+=t,n[3]+=t):e&4?(n[1]-=t,n[3]-=t):e&2?(n[0]+=t,n[2]+=t):e&1&&(n[0]-=t,n[2]-=t)}function Dc(n,t){const{size:e=2,startIndex:i=0,endIndex:o=n.length,normalize:s=!0}=t||{},r=n.slice(i,o);kc(r,e,0,o-i);const a=gs(r,{size:e,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(s)for(const c of a)Nc(c,e);return a}function kc(n,t,e,i){let o=n[0],s;for(let r=e;r<i;r+=t){s=n[r];const a=s-o;(a>180||a<-180)&&(s-=Math.round(a/360)*360),n[r]=o=s}}function Nc(n,t){let e;const i=n.length/t;for(let s=0;s<i&&(e=n[s*t],(e+180)%360===0);s++);const o=-Math.round(e/360)*360;if(o!==0)for(let s=0;s<i;s++)n[s*t]+=o}function zc(n,t,e,i){let o;if(Array.isArray(n[0])){const s=n.length*t;o=new Array(s);for(let r=0;r<n.length;r++)for(let a=0;a<t;a++)o[r*t+a]=n[r][a]||0}else o=n;return e?gs(o,{size:t,gridResolution:e}):i?Dc(o,{size:t}):o}const Vc=1,Wc=2,ai=4;class Gc extends $a{constructor(t){super({...t,attributes:{positions:{size:3,padding:18,initialize:!0,type:t.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(t){return this.attributes[t]}getGeometryFromBuffer(t){return this.normalize?super.getGeometryFromBuffer(t):null}normalizeGeometry(t){return this.normalize?zc(t,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):t}getGeometrySize(t){if(Pn(t)){let i=0;for(const o of t)i+=this.getGeometrySize(o);return i}const e=this.getPathLength(t);return e<2?0:this.isClosed(t)?e<3?0:e+2:e}updateGeometryAttributes(t,e){if(e.geometrySize!==0)if(t&&Pn(t))for(const i of t){const o=this.getGeometrySize(i);e.geometrySize=o,this.updateGeometryAttributes(i,e),e.vertexStart+=o}else this._updateSegmentTypes(t,e),this._updatePositions(t,e)}_updateSegmentTypes(t,e){const i=this.attributes.segmentTypes,o=t?this.isClosed(t):!1,{vertexStart:s,geometrySize:r}=e;i.fill(0,s,s+r),o?(i[s]=ai,i[s+r-2]=ai):(i[s]+=Vc,i[s+r-2]+=Wc),i[s+r-1]=ai}_updatePositions(t,e){const{positions:i}=this.attributes;if(!i||!t)return;const{vertexStart:o,geometrySize:s}=e,r=new Array(3);for(let a=o,c=0;c<s;a++,c++)this.getPointOnPath(t,c,r),i[a*3]=r[0],i[a*3+1]=r[1],i[a*3+2]=r[2]}getPathLength(t){return t.length/this.positionSize}getPointOnPath(t,e,i=[]){const{positionSize:o}=this;e*o>=t.length&&(e+=1-t.length/o);const s=e*o;return i[0]=t[s],i[1]=t[s+1],i[2]=o===3&&t[s+2]||0,i}isClosed(t){if(!this.normalize)return!!this.opts.loop;const{positionSize:e}=this,i=t.length-e;return t[0]===t[i]&&t[1]===t[i+1]&&(e===2||t[2]===t[i+2])}}function Pn(n){return Array.isArray(n[0])}const Tn=`uniform pathUniforms {
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  float jointType;
  float capType;
  float miterLimit;
  bool billboard;
  highp int widthUnits;
} path;
`,jc={name:"path",vs:Tn,fs:Tn,uniformTypes:{widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",jointType:"f32",capType:"f32",miterLimit:"f32",billboard:"f32",widthUnits:"i32"}},Zc=`#version 300 es
#define SHADER_NAME path-layer-vertex-shader
in vec2 positions;
in float instanceTypes;
in vec3 instanceStartPositions;
in vec3 instanceEndPositions;
in vec3 instanceLeftPositions;
in vec3 instanceRightPositions;
in vec3 instanceLeftPositions64Low;
in vec3 instanceStartPositions64Low;
in vec3 instanceEndPositions64Low;
in vec3 instanceRightPositions64Low;
in float instanceStrokeWidths;
in vec4 instanceColors;
in vec3 instancePickingColors;
uniform float opacity;
out vec4 vColor;
out vec2 vCornerOffset;
out float vMiterLength;
out vec2 vPathPosition;
out float vPathLength;
out float vJointType;
const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);
float flipIfTrue(bool flag) {
return -(float(flag) * 2. - 1.);
}
vec3 getLineJoinOffset(
vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
vec2 width
) {
bool isEnd = positions.x > 0.0;
float sideOfPath = positions.y;
float isJoint = float(sideOfPath == 0.0);
vec3 deltaA3 = (currPoint - prevPoint);
vec3 deltaB3 = (nextPoint - currPoint);
mat3 rotationMatrix;
bool needsRotation = !path.billboard && project_needs_rotation(currPoint, rotationMatrix);
if (needsRotation) {
deltaA3 = deltaA3 * rotationMatrix;
deltaB3 = deltaB3 * rotationMatrix;
}
vec2 deltaA = deltaA3.xy / width;
vec2 deltaB = deltaB3.xy / width;
float lenA = length(deltaA);
float lenB = length(deltaB);
vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);
vec2 perpA = vec2(-dirA.y, dirA.x);
vec2 perpB = vec2(-dirB.y, dirB.x);
vec2 tangent = dirA + dirB;
tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
vec2 miterVec = vec2(-tangent.y, tangent.x);
vec2 dir = isEnd ? dirA : dirB;
vec2 perp = isEnd ? perpA : perpB;
float L = isEnd ? lenA : lenB;
float sinHalfA = abs(dot(miterVec, perp));
float cosHalfA = abs(dot(dirA, miterVec));
float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);
float cornerPosition = sideOfPath * turnDirection;
float miterSize = 1.0 / max(sinHalfA, EPSILON);
miterSize = mix(
min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
miterSize,
step(0.0, cornerPosition)
);
vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
* (sideOfPath + isJoint * turnDirection);
bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
bool isCap = isStartCap || isEndCap;
if (isCap) {
offsetVec = mix(perp * sideOfPath, dir * path.capType * 4.0 * flipIfTrue(isStartCap), isJoint);
vJointType = path.capType;
} else {
vJointType = path.jointType;
}
vPathLength = L;
vCornerOffset = offsetVec;
vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
vMiterLength = isCap ? isJoint : vMiterLength;
vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
vPathPosition = vec2(
dot(offsetFromStartOfPath, perp),
dot(offsetFromStartOfPath, dir)
);
geometry.uv = vPathPosition;
float isValid = step(instanceTypes, 3.5);
vec3 offset = vec3(offsetVec * width * isValid, 0.0);
if (needsRotation) {
offset = rotationMatrix * offset;
}
return offset;
}
void clipLine(inout vec4 position, vec4 refPosition) {
if (position.w < EPSILON) {
float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
position = refPosition + (position - refPosition) * r;
}
}
void main() {
geometry.pickingColor = instancePickingColors;
vColor = vec4(instanceColors.rgb, instanceColors.a * layer.opacity);
float isEnd = positions.x;
vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);
vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);
vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);
geometry.worldPosition = currPosition;
vec2 widthPixels = vec2(clamp(
project_size_to_pixel(instanceStrokeWidths * path.widthScale, path.widthUnits),
path.widthMinPixels, path.widthMaxPixels) / 2.0);
vec3 width;
if (path.billboard) {
vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);
clipLine(prevPositionScreen, currPositionScreen);
clipLine(nextPositionScreen, currPositionScreen);
clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));
width = vec3(widthPixels, 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(
prevPositionScreen.xyz / prevPositionScreen.w,
currPositionScreen.xyz / currPositionScreen.w,
nextPositionScreen.xyz / nextPositionScreen.w,
project_pixel_size_to_clipspace(width.xy)
);
DECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);
gl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);
} else {
prevPosition = project_position(prevPosition, prevPosition64Low);
currPosition = project_position(currPosition, currPosition64Low);
nextPosition = project_position(nextPosition, nextPosition64Low);
width = vec3(project_pixel_size(widthPixels), 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);
geometry.position = vec4(currPosition + offset, 1.0);
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Jc=`#version 300 es
#define SHADER_NAME path-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 vCornerOffset;
in float vMiterLength;
in vec2 vPathPosition;
in float vPathLength;
in float vJointType;
out vec4 fragColor;
void main(void) {
geometry.uv = vPathPosition;
if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
discard;
}
if (vJointType < 0.5 && vMiterLength > path.miterLimit + 1.0) {
discard;
}
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,hs=[0,0,0,255],qc={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:n=>n.path},getColor:{type:"accessor",value:hs},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},ci={enter:(n,t)=>t.length?t.subarray(t.length-n.length):n};class De extends Ct{getShaders(){return super.getShaders({vs:Zc,fs:Jc,modules:[qt,Kt,jc]})}get wrapLongitude(){return!1}getBounds(){return this.getAttributeManager()?.getBounds(["vertexPositions"])}initializeState(){this.getAttributeManager().addInstanced({vertexPositions:{size:3,vertexOffset:1,type:"float64",fp64:this.use64bitPositions(),transition:ci,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:"uint8",update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:ci,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",accessor:"getColor",transition:ci,defaultValue:hs},instancePickingColors:{size:4,type:"uint8",accessor:(i,{index:o,target:s})=>this.encodePickingColor(i&&i.__source?i.__source.index:o,s)}}),this.setState({pathTesselator:new Gc({fp64:this.use64bitPositions()})})}updateState(t){super.updateState(t);const{props:e,changeFlags:i}=t,o=this.getAttributeManager();if(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPath)){const{pathTesselator:r}=this.state,a=e.data.attributes||{};r.updateGeometry({data:e.data,geometryBuffer:a.getPath,buffers:a,normalize:!e._pathType,loop:e._pathType==="loop",getGeometry:e.getPath,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:i.dataChanged}),this.setState({numInstances:r.instanceCount,startIndices:r.vertexStarts}),i.dataChanged||o.invalidateAll()}i.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),o.invalidateAll())}getPickingInfo(t){const e=super.getPickingInfo(t),{index:i}=e,o=this.props.data;return o[0]&&o[0].__source&&(e.object=o.find(s=>s.__source.index===i)),e}disablePickingIndex(t){const e=this.props.data;if(e[0]&&e[0].__source)for(let i=0;i<e.length;i++)e[i].__source.index===t&&this._disablePickingIndex(i);else super.disablePickingIndex(t)}draw({uniforms:t}){const{jointRounded:e,capRounded:i,billboard:o,miterLimit:s,widthUnits:r,widthScale:a,widthMinPixels:c,widthMaxPixels:l}=this.props,u=this.state.model,d={jointType:Number(e),capType:Number(i),billboard:o,widthUnits:zt[r],widthScale:a,miterLimit:s,widthMinPixels:c,widthMaxPixels:l};u.shaderInputs.setProps({path:d}),u.draw(this.context.renderPass)}_getModel(){const t=[0,1,2,1,4,2,1,3,4,3,5,4],e=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new Pt(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new ue({topology:"triangle-list",attributes:{indices:new Uint16Array(t),positions:{value:new Float32Array(e),size:2}}}),isInstanced:!0})}calculatePositions(t){const{pathTesselator:e}=this.state;t.startIndices=e.vertexStarts,t.value=e.get("positions")}calculateSegmentTypes(t){const{pathTesselator:e}=this.state;t.startIndices=e.vertexStarts,t.value=e.get("segmentTypes")}}De.defaultProps=qc;De.layerName="PathLayer";const Bn=`uniform sdfUniforms {
  float gamma;
  bool enabled;
  float buffer;
  float outlineBuffer;
  vec4 outlineColor;
} sdf;
`,Kc={name:"sdf",vs:Bn,fs:Bn,uniformTypes:{gamma:"f32",enabled:"f32",buffer:"f32",outlineBuffer:"f32",outlineColor:"vec4<f32>"}},Xc=`#version 300 es
#define SHADER_NAME multi-icon-layer-fragment-shader
precision highp float;
uniform sampler2D iconsTexture;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
if (!bool(picking.isActive)) {
float alpha = texture(iconsTexture, vTextureCoords).a;
vec4 color = vColor;
if (sdf.enabled) {
float distance = alpha;
alpha = smoothstep(sdf.buffer - sdf.gamma, sdf.buffer + sdf.gamma, distance);
if (sdf.outlineBuffer > 0.0) {
float inFill = alpha;
float inBorder = smoothstep(sdf.outlineBuffer - sdf.gamma, sdf.outlineBuffer + sdf.gamma, distance);
color = mix(sdf.outlineColor, vColor, inFill);
alpha = inBorder;
}
}
float a = alpha * color.a;
if (a < icon.alphaCutoff) {
discard;
}
fragColor = vec4(color.rgb, a * layer.opacity);
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,li=192/256,_n=[],Yc={getIconOffsets:{type:"accessor",value:n=>n.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}};class Wi extends de{getShaders(){const t=super.getShaders();return{...t,modules:[...t.modules,Kc],fs:Xc}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:"uint8",size:3,accessor:(e,{index:i,target:o})=>this.encodePickingColor(i,o)}})}updateState(t){super.updateState(t);const{props:e,oldProps:i}=t;let{outlineColor:o}=e;o!==i.outlineColor&&(o=o.map(s=>s/255),o[3]=Number.isFinite(o[3])?o[3]:1,this.setState({outlineColor:o})),!e.sdf&&e.outlineWidth&&it.warn(`${this.id}: fontSettings.sdf is required to render outline`)()}draw(t){const{sdf:e,smoothing:i,outlineWidth:o}=this.props,{outlineColor:s}=this.state,r=o?Math.max(i,li*(1-o)):-1,a=this.state.model,c={buffer:li,outlineBuffer:r,gamma:i,enabled:!!e,outlineColor:s};if(a.shaderInputs.setProps({sdf:c}),super.draw(t),e&&o){const{iconManager:l}=this.state;l.getTexture()&&(a.shaderInputs.setProps({sdf:{...c,outlineBuffer:li}}),a.draw(this.context.renderPass))}}getInstanceOffset(t){return t?Array.from(t).flatMap(e=>super.getInstanceOffset(e)):_n}getInstanceColorMode(t){return 1}getInstanceIconFrame(t){return t?Array.from(t).flatMap(e=>super.getInstanceIconFrame(e)):_n}}Wi.defaultProps=Yc;Wi.layerName="MultiIconLayer";const ae=1e20;class Hc{constructor({fontSize:t=24,buffer:e=3,radius:i=8,cutoff:o=.25,fontFamily:s="sans-serif",fontWeight:r="normal",fontStyle:a="normal",lang:c=null}={}){this.buffer=e,this.cutoff=o,this.radius=i,this.lang=c;const l=this.size=t+e*4,u=this._createCanvas(l),d=this.ctx=u.getContext("2d",{willReadFrequently:!0});d.font=`${a} ${r} ${t}px ${s}`,d.textBaseline="alphabetic",d.textAlign="left",d.fillStyle="black",this.gridOuter=new Float64Array(l*l),this.gridInner=new Float64Array(l*l),this.f=new Float64Array(l),this.z=new Float64Array(l+1),this.v=new Uint16Array(l)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:o,actualBoundingBoxLeft:s,actualBoundingBoxRight:r}=this.ctx.measureText(t),a=Math.ceil(i),c=0,l=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(r-s))),u=Math.min(this.size-this.buffer,a+Math.ceil(o)),d=l+2*this.buffer,g=u+2*this.buffer,h=Math.max(d*g,0),p=new Uint8ClampedArray(h),A={data:p,width:d,height:g,glyphWidth:l,glyphHeight:u,glyphTop:a,glyphLeft:c,glyphAdvance:e};if(l===0||u===0)return A;const{ctx:f,buffer:C,gridInner:y,gridOuter:v}=this;this.lang&&(f.lang=this.lang),f.clearRect(C,C,l,u),f.fillText(t,C,C+a);const b=f.getImageData(C,C,l,u);v.fill(ae,0,h),y.fill(0,0,h);for(let x=0;x<u;x++)for(let I=0;I<l;I++){const Q=b.data[4*(x*l+I)+3]/255;if(Q===0)continue;const R=(x+C)*d+I+C;if(Q===1)v[R]=0,y[R]=ae;else{const M=.5-Q;v[R]=M>0?M*M:0,y[R]=M<0?M*M:0}}Sn(v,0,0,d,g,d,this.f,this.v,this.z),Sn(y,C,C,l,u,d,this.f,this.v,this.z);for(let x=0;x<h;x++){const I=Math.sqrt(v[x])-Math.sqrt(y[x]);p[x]=Math.round(255-255*(I/this.radius+this.cutoff))}return A}}function Sn(n,t,e,i,o,s,r,a,c){for(let l=t;l<t+i;l++)Ln(n,e*s+l,s,o,r,a,c);for(let l=e;l<e+o;l++)Ln(n,l*s+t,1,i,r,a,c)}function Ln(n,t,e,i,o,s,r){s[0]=0,r[0]=-ae,r[1]=ae,o[0]=n[t];for(let a=1,c=0,l=0;a<i;a++){o[a]=n[t+a*e];const u=a*a;do{const d=s[c];l=(o[a]-o[d]+u-d*d)/(a-d)/2}while(l<=r[c]&&--c>-1);c++,s[c]=a,r[c]=l,r[c+1]=ae}for(let a=0,c=0;a<i;a++){for(;r[c+1]<a;)c++;const l=s[c],u=a-l;n[t+a*e]=o[l]+u*u}}const $c=32,tl=[];function el(n){return Math.pow(2,Math.ceil(Math.log2(n)))}function il({characterSet:n,getFontWidth:t,fontHeight:e,buffer:i,maxCanvasWidth:o,mapping:s={},xOffset:r=0,yOffset:a=0}){let c=0,l=r;const u=e+i*2;for(const d of n)if(!s[d]){const g=t(d);l+g+i*2>o&&(l=0,c++),s[d]={x:l+i,y:a+c*u+i,width:g,height:u,layoutWidth:g,layoutHeight:e},l+=g+i*2}return{mapping:s,xOffset:l,yOffset:a+c*u,canvasHeight:el(a+(c+1)*u)}}function fs(n,t,e,i){let o=0;for(let s=t;s<e;s++){const r=n[s];o+=i[r]?.layoutWidth||0}return o}function ps(n,t,e,i,o,s){let r=t,a=0;for(let c=t;c<e;c++){const l=fs(n,c,c+1,o);a+l>i&&(r<c&&s.push(c),r=c,a=0),a+=l}return a}function nl(n,t,e,i,o,s){let r=t,a=t,c=t,l=0;for(let u=t;u<e;u++)if((n[u]===" "||n[u+1]===" "||u+1===e)&&(c=u+1),c>a){let d=fs(n,a,c,o);l+d>i&&(r<a&&(s.push(a),r=a,l=0),d>i&&(d=ps(n,a,c,i,o,s),r=s[s.length-1])),a=c,l+=d}return l}function ol(n,t,e,i,o=0,s){s===void 0&&(s=n.length);const r=[];return t==="break-all"?ps(n,o,s,e,i,r):nl(n,o,s,e,i,r),r}function sl(n,t,e,i,o,s){let r=0,a=0;for(let c=t;c<e;c++){const l=n[c],u=i[l];u?(a||(a=u.layoutHeight),o[c]=r+u.layoutWidth/2,r+=u.layoutWidth):(it.warn(`Missing character: ${l} (${l.codePointAt(0)})`)(),o[c]=r,r+=$c)}s[0]=r,s[1]=a}function rl(n,t,e,i,o){const s=Array.from(n),r=s.length,a=new Array(r),c=new Array(r),l=new Array(r),u=(e==="break-word"||e==="break-all")&&isFinite(i)&&i>0,d=[0,0],g=[0,0];let h=0,p=0,A=0;for(let f=0;f<=r;f++){const C=s[f];if((C===`
`||f===r)&&(A=f),A>p){const y=u?ol(s,e,i,o,p,A):tl;for(let v=0;v<=y.length;v++){const b=v===0?p:y[v-1],x=v<y.length?y[v]:A;sl(s,b,x,o,a,g);for(let I=b;I<x;I++){a[I]-g[0]/2;const Q=s[I],R=o[Q]?.layoutOffsetY||0;c[I]=h+g[1]/2+R,l[I]=g[0]}h=h+g[1]*t,d[0]=Math.max(d[0],g[0])}p=A}C===`
`&&(a[p]=0,c[p]=0,l[p]=0,p++)}return d[1]=h,{x:a,y:c,rowWidth:l,size:d}}function al({value:n,length:t,stride:e,offset:i,startIndices:o,characterSet:s}){const r=n.BYTES_PER_ELEMENT,a=e?e/r:1,c=i?i/r:0,l=o[t]||Math.ceil((n.length-c)/a),u=s&&new Set,d=new Array(t);let g=n;if(a>1||c>0){const h=n.constructor;g=new h(l);for(let p=0;p<l;p++)g[p]=n[p*a+c]}for(let h=0;h<t;h++){const p=o[h],A=o[h+1]||l,f=g.subarray(p,A);d[h]=String.fromCodePoint.apply(null,f),u&&f.forEach(u.add,u)}if(u)for(const h of u)s.add(String.fromCodePoint(h));return{texts:d,characterCount:l}}class As{constructor(t=5){this._cache={},this._order=[],this.limit=t}get(t){const e=this._cache[t];return e&&(this._deleteOrder(t),this._appendOrder(t)),e}set(t,e){this._cache[t]?(this.delete(t),this._cache[t]=e,this._appendOrder(t)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[t]=e,this._appendOrder(t))}delete(t){this._cache[t]&&(delete this._cache[t],this._deleteOrder(t))}_deleteOrder(t){const e=this._order.indexOf(t);e>=0&&this._order.splice(e,1)}_appendOrder(t){this._order.push(t)}}function cl(){const n=[];for(let t=32;t<128;t++)n.push(String.fromCharCode(t));return n}const Nt={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:cl(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},Mn=1024,Qn=.9,On=1.2,ms=3;let ke=new As(ms);function ll(n,t){let e;typeof t=="string"?e=new Set(Array.from(t)):e=new Set(t);const i=ke.get(n);if(!i)return e;for(const o in i.mapping)e.has(o)&&e.delete(o);return e}function ul(n,t){for(let e=0;e<n.length;e++)t.data[4*e+3]=n[e]}function Rn(n,t,e,i){n.font=`${i} ${e}px ${t}`,n.fillStyle="#000",n.textBaseline="alphabetic",n.textAlign="left"}function dl(n){it.assert(Number.isFinite(n)&&n>=ms,"Invalid cache limit"),ke=new As(n)}class gl{constructor(){this.props={...Nt}}get atlas(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){const{fontSize:t,buffer:e}=this.props;return(t*On+e*2)/t}setProps(t={}){Object.assign(this.props,t),this._key=this._getKey();const e=ll(this._key,this.props.characterSet),i=ke.get(this._key);if(i&&e.size===0){this._atlas!==i&&(this._atlas=i);return}const o=this._generateFontAtlas(e,i);this._atlas=o,ke.set(this._key,o)}_generateFontAtlas(t,e){const{fontFamily:i,fontWeight:o,fontSize:s,buffer:r,sdf:a,radius:c,cutoff:l}=this.props;let u=e&&e.data;u||(u=document.createElement("canvas"),u.width=Mn);const d=u.getContext("2d",{willReadFrequently:!0});Rn(d,i,s,o);const{mapping:g,canvasHeight:h,xOffset:p,yOffset:A}=il({getFontWidth:f=>d.measureText(f).width,fontHeight:s*On,buffer:r,characterSet:t,maxCanvasWidth:Mn,...e&&{mapping:e.mapping,xOffset:e.xOffset,yOffset:e.yOffset}});if(u.height!==h){const f=d.getImageData(0,0,u.width,u.height);u.height=h,d.putImageData(f,0,0)}if(Rn(d,i,s,o),a){const f=new Hc({fontSize:s,buffer:r,radius:c,cutoff:l,fontFamily:i,fontWeight:`${o}`});for(const C of t){const{data:y,width:v,height:b,glyphTop:x}=f.draw(C);g[C].width=v,g[C].layoutOffsetY=s*Qn-x;const I=d.createImageData(v,b);ul(y,I),d.putImageData(I,g[C].x,g[C].y)}}else for(const f of t)d.fillText(f,g[f].x,g[f].y+r+s*Qn);return{xOffset:p,yOffset:A,mapping:g,data:u,width:u.width,height:u.height}}_getKey(){const{fontFamily:t,fontWeight:e,fontSize:i,buffer:o,sdf:s,radius:r,cutoff:a}=this.props;return s?`${t} ${e} ${i} ${o} ${r} ${a}`:`${t} ${e} ${i} ${o}`}}const Fn=`uniform textBackgroundUniforms {
  bool billboard;
  float sizeScale;
  float sizeMinPixels;
  float sizeMaxPixels;
  vec4 borderRadius;
  vec4 padding;
  highp int sizeUnits;
  bool stroked;
} textBackground;
`,hl={name:"textBackground",vs:Fn,fs:Fn,uniformTypes:{billboard:"f32",sizeScale:"f32",sizeMinPixels:"f32",sizeMaxPixels:"f32",borderRadius:"vec4<f32>",padding:"vec4<f32>",sizeUnits:"i32",stroked:"f32"}},fl=`#version 300 es
#define SHADER_NAME text-background-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceRects;
in float instanceSizes;
in float instanceAngles;
in vec2 instancePixelOffsets;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out float vLineWidth;
out vec2 uv;
out vec2 dimensions;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = radians(angle);
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vLineWidth = instanceLineWidths;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * textBackground.sizeScale, textBackground.sizeUnits),
textBackground.sizeMinPixels, textBackground.sizeMaxPixels
);
dimensions = instanceRects.zw * sizePixels + textBackground.padding.xy + textBackground.padding.zw;
vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-textBackground.padding.xy, textBackground.padding.zw, positions);
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
pixelOffset += instancePixelOffsets;
pixelOffset.y *= -1.0;
if (textBackground.billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,pl=`#version 300 es
#define SHADER_NAME text-background-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in float vLineWidth;
in vec2 uv;
in vec2 dimensions;
out vec4 fragColor;
float round_rect(vec2 p, vec2 size, vec4 radii) {
vec2 pixelPositionCB = (p - 0.5) * size;
vec2 sizeCB = size * 0.5;
float maxBorderRadius = min(size.x, size.y) * 0.5;
vec4 borderRadius = vec4(min(radii, maxBorderRadius));
borderRadius.xy =
(pixelPositionCB.x > 0.0) ? borderRadius.xy : borderRadius.zw;
borderRadius.x = (pixelPositionCB.y > 0.0) ? borderRadius.x : borderRadius.y;
vec2 q = abs(pixelPositionCB) - sizeCB + borderRadius.x;
return -(min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - borderRadius.x);
}
float rect(vec2 p, vec2 size) {
vec2 pixelPosition = p * size;
return min(min(pixelPosition.x, size.x - pixelPosition.x),
min(pixelPosition.y, size.y - pixelPosition.y));
}
vec4 get_stroked_fragColor(float dist) {
float isBorder = smoothedge(dist, vLineWidth);
return mix(vFillColor, vLineColor, isBorder);
}
void main(void) {
geometry.uv = uv;
if (textBackground.borderRadius != vec4(0.0)) {
float distToEdge = round_rect(uv, dimensions, textBackground.borderRadius);
if (textBackground.stroked) {
fragColor = get_stroked_fragColor(distToEdge);
} else {
fragColor = vFillColor;
}
float shapeAlpha = smoothedge(-distToEdge, 0.0);
fragColor.a *= shapeAlpha;
} else {
if (textBackground.stroked) {
float distToEdge = rect(uv, dimensions);
fragColor = get_stroked_fragColor(distToEdge);
} else {
fragColor = vFillColor;
}
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Al={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,borderRadius:{type:"object",value:0},padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:n=>n.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}};class Gi extends Ct{getShaders(){return super.getShaders({vs:fl,fs:pl,modules:[qt,Kt,hl]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(t){super.updateState(t);const{changeFlags:e}=t;e.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:t}){const{billboard:e,sizeScale:i,sizeUnits:o,sizeMinPixels:s,sizeMaxPixels:r,getLineWidth:a}=this.props;let{padding:c,borderRadius:l}=this.props;c.length<4&&(c=[c[0],c[1],c[0],c[1]]),Array.isArray(l)||(l=[l,l,l,l]);const u=this.state.model,d={billboard:e,stroked:!!a,borderRadius:l,padding:c,sizeUnits:zt[o],sizeScale:i,sizeMinPixels:s,sizeMaxPixels:r};u.shaderInputs.setProps({textBackground:d}),u.draw(this.context.renderPass)}_getModel(){const t=[0,0,1,0,0,1,1,1];return new Pt(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new ue({topology:"triangle-strip",vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(t)}}}),isInstanced:!0})}}Gi.defaultProps=Al;Gi.layerName="TextBackgroundLayer";const Un={start:1,middle:0,end:-1},Dn={top:1,center:0,bottom:-1},ui=[0,0,0,255],ml=1,vl={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:ui},getBorderWidth:{type:"accessor",value:0},backgroundBorderRadius:{type:"object",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:Nt.characterSet},fontFamily:Nt.fontFamily,fontWeight:Nt.fontWeight,lineHeight:ml,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:ui},fontSettings:{type:"object",value:{},compare:1},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:n=>n.text},getPosition:{type:"accessor",value:n=>n.position},getColor:{type:"accessor",value:ui},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}};class Vt extends dt{constructor(){super(...arguments),this.getBoundingRect=(t,e)=>{let{size:[i,o]}=this.transformParagraph(t,e);const{fontSize:s}=this.state.fontAtlasManager.props;i/=s,o/=s;const{getTextAnchor:r,getAlignmentBaseline:a}=this.props,c=Un[typeof r=="function"?r(t,e):r],l=Dn[typeof a=="function"?a(t,e):a];return[(c-1)*i/2,(l-1)*o/2,i,o]},this.getIconOffsets=(t,e)=>{const{getTextAnchor:i,getAlignmentBaseline:o}=this.props,{x:s,y:r,rowWidth:a,size:[c,l]}=this.transformParagraph(t,e),u=Un[typeof i=="function"?i(t,e):i],d=Dn[typeof o=="function"?o(t,e):o],g=s.length,h=new Array(g*2);let p=0;for(let A=0;A<g;A++){const f=(1-u)*(c-a[A])/2;h[p++]=(u-1)*c/2+f+s[A],h[p++]=(d-1)*l/2+r[A]}return h}}initializeState(){this.state={styleVersion:0,fontAtlasManager:new gl},this.props.maxWidth>0&&it.once(1,"v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}updateState(t){const{props:e,oldProps:i,changeFlags:o}=t;(o.dataChanged||o.updateTriggersChanged&&(o.updateTriggersChanged.all||o.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||e.lineHeight!==i.lineHeight||e.wordBreak!==i.wordBreak||e.maxWidth!==i.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:t}){return t.object=t.index>=0?this.props.data[t.index]:null,t}_updateFontAtlas(){const{fontSettings:t,fontFamily:e,fontWeight:i}=this.props,{fontAtlasManager:o,characterSet:s}=this.state,r={...t,characterSet:s,fontFamily:e,fontWeight:i};if(!o.mapping)return o.setProps(r),!0;for(const a in r)if(r[a]!==o.props[a])return o.setProps(r),!0;return!1}_updateText(){const{data:t,characterSet:e}=this.props,i=t.attributes?.getText;let{getText:o}=this.props,s=t.startIndices,r;const a=e==="auto"&&new Set;if(i&&s){const{texts:c,characterCount:l}=al({...ArrayBuffer.isView(i)?{value:i}:i,length:t.length,startIndices:s,characterSet:a});r=l,o=(u,{index:d})=>c[d]}else{const{iterable:c,objectInfo:l}=Xe(t);s=[0],r=0;for(const u of c){l.index++;const d=Array.from(o(u,l)||"");a&&d.forEach(a.add,a),r+=d.length,s.push(r)}}this.setState({getText:o,startIndices:s,numInstances:r,characterSet:a||e})}transformParagraph(t,e){const{fontAtlasManager:i}=this.state,o=i.mapping,s=this.state.getText,{wordBreak:r,lineHeight:a,maxWidth:c}=this.props,l=s(t,e)||"";return rl(l,a,r,c*i.props.fontSize,o)}renderLayers(){const{startIndices:t,numInstances:e,getText:i,fontAtlasManager:{scale:o,atlas:s,mapping:r},styleVersion:a}=this.state,{data:c,_dataDiff:l,getPosition:u,getColor:d,getSize:g,getAngle:h,getPixelOffset:p,getBackgroundColor:A,getBorderColor:f,getBorderWidth:C,backgroundBorderRadius:y,backgroundPadding:v,background:b,billboard:x,fontSettings:I,outlineWidth:Q,outlineColor:R,sizeScale:M,sizeUnits:z,sizeMinPixels:j,sizeMaxPixels:X,transitions:Z,updateTriggers:W}=this.props,gt=this.getSubLayerClass("characters",Wi),yt=this.getSubLayerClass("background",Gi);return[b&&new yt({getFillColor:A,getLineColor:f,getLineWidth:C,borderRadius:y,padding:v,getPosition:u,getSize:g,getAngle:h,getPixelOffset:p,billboard:x,sizeScale:M,sizeUnits:z,sizeMinPixels:j,sizeMaxPixels:X,transitions:Z&&{getPosition:Z.getPosition,getAngle:Z.getAngle,getSize:Z.getSize,getFillColor:Z.getBackgroundColor,getLineColor:Z.getBorderColor,getLineWidth:Z.getBorderWidth,getPixelOffset:Z.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:W.getPosition,getAngle:W.getAngle,getSize:W.getSize,getFillColor:W.getBackgroundColor,getLineColor:W.getBorderColor,getLineWidth:W.getBorderWidth,getPixelOffset:W.getPixelOffset,getBoundingRect:{getText:W.getText,getTextAnchor:W.getTextAnchor,getAlignmentBaseline:W.getAlignmentBaseline,styleVersion:a}}}),{data:c.attributes&&c.attributes.background?{length:c.length,attributes:c.attributes.background}:c,_dataDiff:l,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new gt({sdf:I.sdf,smoothing:Number.isFinite(I.smoothing)?I.smoothing:Nt.smoothing,outlineWidth:Q/(I.radius||Nt.radius),outlineColor:R,iconAtlas:s,iconMapping:r,getPosition:u,getColor:d,getSize:g,getAngle:h,getPixelOffset:p,billboard:x,sizeScale:M*o,sizeUnits:z,sizeMinPixels:j*o,sizeMaxPixels:X*o,transitions:Z&&{getPosition:Z.getPosition,getAngle:Z.getAngle,getColor:Z.getColor,getSize:Z.getSize,getPixelOffset:Z.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{all:W.getText,getPosition:W.getPosition,getAngle:W.getAngle,getColor:W.getColor,getSize:W.getSize,getPixelOffset:W.getPixelOffset,getIconOffsets:{getTextAnchor:W.getTextAnchor,getAlignmentBaseline:W.getAlignmentBaseline,styleVersion:a}}}),{data:c,_dataDiff:l,startIndices:t,numInstances:e,getIconOffsets:this.getIconOffsets,getIcon:i})]}static set fontAtlasCacheLimit(t){dl(t)}}Vt.defaultProps=vl;Vt.layerName="TextLayer";const vs=6371e3;function Cl(n,t){return!(Math.abs(n[0]-t[0])>Number.EPSILON||Math.abs(n[1]-t[1])>Number.EPSILON)}function ft(n){return n/180*Math.PI}function _i(n){return n/Math.PI*180}function yl(n){return(n+360)%360}function El(n,t,e=vs){const i=e,o=ft(n[1]),s=ft(n[0]),r=ft(t[1]),a=ft(t[0]),c=r-o,l=a-s,u=Math.sin(c/2)*Math.sin(c/2)+Math.cos(o)*Math.cos(r)*Math.sin(l/2)*Math.sin(l/2),d=2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u));return i*d}function bl(n,t){if(Cl(n,t))return NaN;const e=ft(n[1]),i=ft(t[1]),o=ft(t[0]-n[0]),s=Math.cos(e)*Math.sin(i)-Math.sin(e)*Math.cos(i)*Math.cos(o),r=Math.sin(o)*Math.cos(i),a=Math.atan2(r,s),c=_i(a);return yl(c)}function Il(n,t,e,i=vs){const o=t/i,s=ft(e),r=ft(n[1]),a=ft(n[0]),c=Math.sin(r)*Math.cos(o)+Math.cos(r)*Math.sin(o)*Math.cos(s),l=Math.asin(c),u=Math.sin(s)*Math.sin(o)*Math.cos(r),d=Math.cos(o)-Math.sin(r)*c,g=a+Math.atan2(u,d),h=_i(l);return[_i(g),h]}/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Cs=Symbol("Comlink.proxy"),xl=Symbol("Comlink.endpoint"),wl=Symbol("Comlink.releaseProxy"),di=Symbol("Comlink.finalizer"),Le=Symbol("Comlink.thrown"),ys=n=>typeof n=="object"&&n!==null||typeof n=="function",Pl={canHandle:n=>ys(n)&&n[Cs],serialize(n){const{port1:t,port2:e}=new MessageChannel;return bs(n,t),[e,[e]]},deserialize(n){return n.start(),xs(n)}},Tl={canHandle:n=>ys(n)&&Le in n,serialize({value:n}){let t;return n instanceof Error?t={isError:!0,value:{message:n.message,name:n.name,stack:n.stack}}:t={isError:!1,value:n},[t,[]]},deserialize(n){throw n.isError?Object.assign(new Error(n.value.message),n.value):n.value}},Es=new Map([["proxy",Pl],["throw",Tl]]);function Bl(n,t){for(const e of n)if(t===e||e==="*"||e instanceof RegExp&&e.test(t))return!0;return!1}function bs(n,t=globalThis,e=["*"]){t.addEventListener("message",function i(o){if(!o||!o.data)return;if(!Bl(e,o.origin)){console.warn(`Invalid origin '${o.origin}' for comlink proxy`);return}const{id:s,type:r,path:a}=Object.assign({path:[]},o.data),c=(o.data.argumentList||[]).map(St);let l;try{const u=a.slice(0,-1).reduce((g,h)=>g[h],n),d=a.reduce((g,h)=>g[h],n);switch(r){case"GET":l=d;break;case"SET":u[a.slice(-1)[0]]=St(o.data.value),l=!0;break;case"APPLY":l=d.apply(u,c);break;case"CONSTRUCT":{const g=new d(...c);l=Ql(g)}break;case"ENDPOINT":{const{port1:g,port2:h}=new MessageChannel;bs(n,h),l=Li(g,[g])}break;case"RELEASE":l=void 0;break;default:return}}catch(u){l={value:u,[Le]:0}}Promise.resolve(l).catch(u=>({value:u,[Le]:0})).then(u=>{const[d,g]=Ve(u);t.postMessage(Object.assign(Object.assign({},d),{id:s}),g),r==="RELEASE"&&(t.removeEventListener("message",i),Is(t),di in n&&typeof n[di]=="function"&&n[di]())}).catch(u=>{const[d,g]=Ve({value:new TypeError("Unserializable return value"),[Le]:0});t.postMessage(Object.assign(Object.assign({},d),{id:s}),g)})}),t.start&&t.start()}function _l(n){return n.constructor.name==="MessagePort"}function Is(n){_l(n)&&n.close()}function xs(n,t){const e=new Map;return n.addEventListener("message",function(o){const{data:s}=o;if(!s||!s.id)return;const r=e.get(s.id);if(r)try{r(s)}finally{e.delete(s.id)}}),Si(n,e,[],t)}function Ce(n){if(n)throw new Error("Proxy has been released and is not useable")}function ws(n){return Ut(n,new Map,{type:"RELEASE"}).then(()=>{Is(n)})}const Ne=new WeakMap,ze="FinalizationRegistry"in globalThis&&new FinalizationRegistry(n=>{const t=(Ne.get(n)||0)-1;Ne.set(n,t),t===0&&ws(n)});function Sl(n,t){const e=(Ne.get(t)||0)+1;Ne.set(t,e),ze&&ze.register(n,t,n)}function Ll(n){ze&&ze.unregister(n)}function Si(n,t,e=[],i=function(){}){let o=!1;const s=new Proxy(i,{get(r,a){if(Ce(o),a===wl)return()=>{Ll(s),ws(n),t.clear(),o=!0};if(a==="then"){if(e.length===0)return{then:()=>s};const c=Ut(n,t,{type:"GET",path:e.map(l=>l.toString())}).then(St);return c.then.bind(c)}return Si(n,t,[...e,a])},set(r,a,c){Ce(o);const[l,u]=Ve(c);return Ut(n,t,{type:"SET",path:[...e,a].map(d=>d.toString()),value:l},u).then(St)},apply(r,a,c){Ce(o);const l=e[e.length-1];if(l===xl)return Ut(n,t,{type:"ENDPOINT"}).then(St);if(l==="bind")return Si(n,t,e.slice(0,-1));const[u,d]=kn(c);return Ut(n,t,{type:"APPLY",path:e.map(g=>g.toString()),argumentList:u},d).then(St)},construct(r,a){Ce(o);const[c,l]=kn(a);return Ut(n,t,{type:"CONSTRUCT",path:e.map(u=>u.toString()),argumentList:c},l).then(St)}});return Sl(s,n),s}function Ml(n){return Array.prototype.concat.apply([],n)}function kn(n){const t=n.map(Ve);return[t.map(e=>e[0]),Ml(t.map(e=>e[1]))]}const Ps=new WeakMap;function Li(n,t){return Ps.set(n,t),n}function Ql(n){return Object.assign(n,{[Cs]:!0})}function Ve(n){for(const[t,e]of Es)if(e.canHandle(n)){const[i,o]=e.serialize(n);return[{type:"HANDLER",name:t,value:i},o]}return[{type:"RAW",value:n},Ps.get(n)||[]]}function St(n){switch(n.type){case"HANDLER":return Es.get(n.name).deserialize(n.value);case"RAW":return n.value}}function Ut(n,t,e,i){return new Promise(o=>{const s=Ol();t.set(s,o),n.start&&n.start(),n.postMessage(Object.assign({id:s},e),i)})}function Ol(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}const Ts=function(n){return n.on=n.addEventListener,n.off=n.removeEventListener,n},Rl=function(n){try{return URL.createObjectURL(new Blob([n],{type:"application/javascript"}))}catch{const e=new BlobBuilder;return e.append(n),URL.createObjectURL(e.getBlob())}},Fl=function(n){return function(){const t=Rl(n),e=Ts(new Worker(t));e.objURL=t;const i=e.terminate;return e.on=e.addEventListener,e.off=e.removeEventListener,e.terminate=function(){return URL.revokeObjectURL(t),i.call(this)},e}},Ul=function(n){return`var browserWorkerPolyFill = ${Ts.toString()};
browserWorkerPolyFill(self);
`+n},ye=Math.PI/180,Ee=180/Math.PI,be=6378137,Et=20037508342789244e-9,Ie="900913",Dl="WGS84",Ft={};function Nn(n){return Number(n)===n&&n%1!==0}class kl{#t;#e;#o;#s;#n;#i;constructor(t={}){if(this.#t=t.size||256,this.#e=t.antimeridian?2:1,!Ft[this.#t]){let e=this.#t;const i=Ft[this.#t]={};i.Bc=[],i.Cc=[],i.zc=[],i.Ac=[];for(let o=0;o<30;o++)i.Bc.push(e/360),i.Cc.push(e/(2*Math.PI)),i.zc.push(e/2),i.Ac.push(e),e*=2}this.#o=Ft[this.#t].Bc,this.#s=Ft[this.#t].Cc,this.#n=Ft[this.#t].zc,this.#i=Ft[this.#t].Ac}px(t,e){if(Nn(e)){const i=this.#t*Math.pow(2,e),o=i/2,s=i/360,r=i/(2*Math.PI),a=i,c=Math.min(Math.max(Math.sin(ye*t[1]),-.9999),.9999);let l=o+t[0]*s,u=o+.5*Math.log((1+c)/(1-c))*-r;return l>a*this.#e&&(l=a*this.#e),u>a&&(u=a),[l,u]}else{const i=this.#n[e],o=Math.min(Math.max(Math.sin(ye*t[1]),-.9999),.9999);let s=Math.round(i+t[0]*this.#o[e]),r=Math.round(i+.5*Math.log((1+o)/(1-o))*-this.#s[e]);return s>this.#i[e]*this.#e&&(s=this.#i[e]*this.#e),r>this.#i[e]&&(r=this.#i[e]),[s,r]}}ll(t,e){if(Nn(e)){const i=this.#t*Math.pow(2,e),o=i/360,s=i/(2*Math.PI),r=i/2,a=(t[1]-r)/-s,c=(t[0]-r)/o,l=Ee*(2*Math.atan(Math.exp(a))-.5*Math.PI);return[c,l]}else{const i=(t[1]-this.#n[e])/-this.#s[e],o=(t[0]-this.#n[e])/this.#o[e],s=Ee*(2*Math.atan(Math.exp(i))-.5*Math.PI);return[o,s]}}convert(t,e){return e===Ie?[...this.forward(t.slice(0,2)),...this.forward(t.slice(2,4))]:[...this.inverse(t.slice(0,2)),...this.inverse(t.slice(2,4))]}inverse(t){return[t[0]*Ee/be,(Math.PI*.5-2*Math.atan(Math.exp(-t[1]/be)))*Ee]}forward(t){const e=[be*t[0]*ye,be*Math.log(Math.tan(Math.PI*.25+.5*t[1]*ye))];return e[0]>Et&&(e[0]=Et),e[0]<-Et&&(e[0]=-Et),e[1]>Et&&(e[1]=Et),e[1]<-Et&&(e[1]=-Et),e}bbox(t,e,i,o,s){o&&(e=Math.pow(2,i)-1-e);const r=[t*this.#t,(+e+1)*this.#t],a=[(+t+1)*this.#t,e*this.#t],c=[...this.ll(r,i),...this.ll(a,i)];return s===Ie?this.convert(c,Ie):c}xyz(t,e,i,o){const s=o===Ie?this.convert(t,Dl):t,r=[s[0],s[1]],a=[s[2],s[3]],c=this.px(r,e),l=this.px(a,e),u=[Math.floor(c[0]/this.#t),Math.floor((l[0]-1)/this.#t)],d=[Math.floor(l[1]/this.#t),Math.floor((c[1]-1)/this.#t)],g={minX:Math.min.apply(Math,u)<0?0:Math.min.apply(Math,u),minY:Math.min.apply(Math,d)<0?0:Math.min.apply(Math,d),maxX:Math.max.apply(Math,u),maxY:Math.max.apply(Math,d)};if(i){const h={minY:Math.pow(2,e)-1-g.maxY,maxY:Math.pow(2,e)-1-g.minY};g.minY=h.minY,g.maxY=h.maxY}return g}}function Nl(n=4,t=!1){if(n>10)throw new Error(`Max order is 10, but given ${n}.`);const e=(1+Math.sqrt(5))/2,o=10*Math.pow(4,n)+2,s=t?n===0?3:Math.pow(2,n)*3+9:0,r=new Float32Array((o+s)*3);r.set(Float32Array.of(-1,e,0,1,e,0,-1,-e,0,1,-e,0,0,-1,e,0,1,e,0,-1,-e,0,1,-e,e,0,-1,e,0,1,-e,0,-1,-e,0,1));let a=Uint16Array.of(0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,11,10,2,5,11,4,1,5,9,7,1,8,10,7,6,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,9,8,1,4,9,5,2,4,11,6,2,10,8,6,7),c=12;const l=n?new Map:null;function u(f,C){const y=Math.floor((f+C)*(f+C+1)/2+Math.min(f,C)),v=l.get(y);return v!==void 0?(l.delete(y),v):(l.set(y,c),r[3*c+0]=(r[3*f+0]+r[3*C+0])*.5,r[3*c+1]=(r[3*f+1]+r[3*C+1])*.5,r[3*c+2]=(r[3*f+2]+r[3*C+2])*.5,c++)}let d=a;const g=n>5?Uint32Array:Uint16Array;for(let f=0;f<n;f++){const C=d.length;a=new g(C*4);for(let y=0;y<C;y+=3){const v=d[y+0],b=d[y+1],x=d[y+2],I=u(v,b),Q=u(b,x),R=u(x,v);let M=y*4;a[M++]=v,a[M++]=I,a[M++]=R,a[M++]=b,a[M++]=Q,a[M++]=I,a[M++]=x,a[M++]=R,a[M++]=Q,a[M++]=I,a[M++]=Q,a[M++]=R}d=a}for(let f=0;f<o*3;f+=3){const C=r[f+0],y=r[f+1],v=r[f+2],b=1/Math.sqrt(C*C+y*y+v*v);r[f+0]*=b,r[f+1]*=b,r[f+2]*=b}if(!t)return{vertices:r,triangles:a};const h=new Float32Array((o+s)*2);for(let f=0;f<o;f++)h[2*f+0]=Math.atan2(r[3*f+2],r[3*f])/(2*Math.PI)+.5,h[2*f+1]=Math.asin(r[3*f+1])/Math.PI+.5;const p=new Map;function A(f,C,y,v){if(v){const b=p.get(f);if(b!==void 0)return b}return r[3*c+0]=r[3*f+0],r[3*c+1]=r[3*f+1],r[3*c+2]=r[3*f+2],h[2*c+0]=C,h[2*c+1]=y,v&&p.set(f,c),c++}for(let f=0;f<a.length;f+=3){const C=a[f+0],y=a[f+1],v=a[f+2];let b=h[2*C],x=h[2*y],I=h[2*v];const Q=h[2*C+1],R=h[2*y+1],M=h[2*v+1];x-b>=.5&&Q!==1&&(x-=1),I-x>.5&&(I-=1),(b>.5&&b-I>.5||b===1&&M===0)&&(b-=1),x>.5&&x-b>.5&&(x-=1),Q===0||Q===1?(b=(x+I)/2,Q===x?h[2*C]=b:a[f+0]=A(C,b,Q,!1)):R===0||R===1?(x=(b+I)/2,R===b?h[2*y]=x:a[f+1]=A(y,x,R,!1)):(M===0||M===1)&&(I=(b+x)/2,M===b?h[2*v]=I:a[f+2]=A(v,I,M,!1)),b!==h[2*C]&&Q!==0&&Q!==1&&(a[f+0]=A(C,b,Q,!0)),x!==h[2*y]&&R!==0&&R!==1&&(a[f+1]=A(y,x,R,!0)),I!==h[2*v]&&M!==0&&M!==1&&(a[f+2]=A(v,I,M,!0))}return{vertices:r,triangles:a,uv:h}}const zn=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],gi=1,te=8;class ji{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[e,i]=new Uint8Array(t,0,2);if(e!==219)throw new Error("Data does not appear to be in a KDBush format.");const o=i>>4;if(o!==gi)throw new Error(`Got v${o} data when expected v${gi}.`);const s=zn[i&15];if(!s)throw new Error("Unrecognized array type.");const[r]=new Uint16Array(t,2,1),[a]=new Uint32Array(t,4,1);return new ji(a,r,s,t)}constructor(t,e=64,i=Float64Array,o){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+e,2),65535),this.ArrayType=i,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const s=zn.indexOf(this.ArrayType),r=t*2*this.ArrayType.BYTES_PER_ELEMENT,a=t*this.IndexArrayType.BYTES_PER_ELEMENT,c=(8-a%8)%8;if(s<0)throw new Error(`Unexpected typed array class: ${i}.`);o&&o instanceof ArrayBuffer?(this.data=o,this.ids=new this.IndexArrayType(this.data,te,t),this.coords=new this.ArrayType(this.data,te+a+c,t*2),this._pos=t*2,this._finished=!0):(this.data=new ArrayBuffer(te+r+a+c),this.ids=new this.IndexArrayType(this.data,te,t),this.coords=new this.ArrayType(this.data,te+a+c,t*2),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,(gi<<4)+s]),new Uint16Array(this.data,2,1)[0]=e,new Uint32Array(this.data,4,1)[0]=t)}add(t,e){const i=this._pos>>1;return this.ids[i]=i,this.coords[this._pos++]=t,this.coords[this._pos++]=e,i}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return Mi(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,e,i,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:s,coords:r,nodeSize:a}=this,c=[0,s.length-1,0],l=[];for(;c.length;){const u=c.pop()||0,d=c.pop()||0,g=c.pop()||0;if(d-g<=a){for(let f=g;f<=d;f++){const C=r[2*f],y=r[2*f+1];C>=t&&C<=i&&y>=e&&y<=o&&l.push(s[f])}continue}const h=g+d>>1,p=r[2*h],A=r[2*h+1];p>=t&&p<=i&&A>=e&&A<=o&&l.push(s[h]),(u===0?t<=p:e<=A)&&(c.push(g),c.push(h-1),c.push(1-u)),(u===0?i>=p:o>=A)&&(c.push(h+1),c.push(d),c.push(1-u))}return l}within(t,e,i){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:o,coords:s,nodeSize:r}=this,a=[0,o.length-1,0],c=[],l=i*i;for(;a.length;){const u=a.pop()||0,d=a.pop()||0,g=a.pop()||0;if(d-g<=r){for(let f=g;f<=d;f++)Vn(s[2*f],s[2*f+1],t,e)<=l&&c.push(o[f]);continue}const h=g+d>>1,p=s[2*h],A=s[2*h+1];Vn(p,A,t,e)<=l&&c.push(o[h]),(u===0?t-i<=p:e-i<=A)&&(a.push(g),a.push(h-1),a.push(1-u)),(u===0?t+i>=p:e+i>=A)&&(a.push(h+1),a.push(d),a.push(1-u))}return c}}function Mi(n,t,e,i,o,s){if(o-i<=e)return;const r=i+o>>1;Bs(n,t,r,i,o,s),Mi(n,t,e,i,r-1,1-s),Mi(n,t,e,r+1,o,1-s)}function Bs(n,t,e,i,o,s){for(;o>i;){if(o-i>600){const l=o-i+1,u=e-i+1,d=Math.log(l),g=.5*Math.exp(2*d/3),h=.5*Math.sqrt(d*g*(l-g)/l)*(u-l/2<0?-1:1),p=Math.max(i,Math.floor(e-u*g/l+h)),A=Math.min(o,Math.floor(e+(l-u)*g/l+h));Bs(n,t,e,p,A,s)}const r=t[2*e+s];let a=i,c=o;for(ee(n,t,i,e),t[2*o+s]>r&&ee(n,t,i,o);a<c;){for(ee(n,t,a,c),a++,c--;t[2*a+s]<r;)a++;for(;t[2*c+s]>r;)c--}t[2*i+s]===r?ee(n,t,i,c):(c++,ee(n,t,c,o)),c<=e&&(i=c+1),e<=c&&(o=c-1)}}function ee(n,t,e,i){hi(n,e,i),hi(t,2*e,2*i),hi(t,2*e+1,2*i+1)}function hi(n,t,e){const i=n[t];n[t]=n[e],n[e]=i}function Vn(n,t,e,i){const o=n-e,s=t-i;return o*o+s*s}class zl{constructor(t=[],e=Vl){if(this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(let i=(this.length>>1)-1;i>=0;i--)this._down(i)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const t=this.data[0],e=this.data.pop();return this.length--,this.length>0&&(this.data[0]=e,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:e,compare:i}=this,o=e[t];for(;t>0;){const s=t-1>>1,r=e[s];if(i(o,r)>=0)break;e[t]=r,t=s}e[t]=o}_down(t){const{data:e,compare:i}=this,o=this.length>>1,s=e[t];for(;t<o;){let r=(t<<1)+1,a=e[r];const c=r+1;if(c<this.length&&i(e[c],a)<0&&(r=c,a=e[c]),i(a,s)>=0)break;e[t]=a,t=r}e[t]=s}}function Vl(n,t){return n<t?-1:n>t?1:0}const Wl=6371,pt=Math.PI/180;function Gl(n,t,e,i=1/0,o=1/0,s){let r=1;const a=[];i===void 0&&(i=1/0),o!==void 0&&(r=Qt(o/Wl));const c=new zl([],jl);let l={left:0,right:n.ids.length-1,axis:0,minLng:-180,minLat:-90,maxLng:180,maxLat:90};const u=Math.cos(e*pt);for(;l;){const d=l.right,g=l.left;if(d-g<=n.nodeSize)for(let h=g;h<=d;h++){const p=n.ids[h];{const A=Gn(t,e,n.coords[2*h],n.coords[2*h+1],u);c.push({id:p,dist:A})}}else{const h=g+d>>1,p=n.coords[2*h],A=n.coords[2*h+1],f=n.ids[h];{const b=Gn(t,e,p,A,u);c.push({id:f,dist:b})}const C=(l.axis+1)%2,y={left:g,right:h-1,axis:C,minLng:l.minLng,minLat:l.minLat,maxLng:l.axis===0?p:l.maxLng,maxLat:l.axis===1?A:l.maxLat,dist:0},v={left:h+1,right:d,axis:C,minLng:l.axis===0?p:l.minLng,minLat:l.axis===1?A:l.minLat,maxLng:l.maxLng,maxLat:l.maxLat,dist:0};y.dist=Wn(t,e,u,y),v.dist=Wn(t,e,u,v),c.push(y),c.push(v)}for(;c.length&&c.peek().id!=null;){const h=c.pop();if(h.dist>r||(a.push(h.id),a.length===i))return a}l=c.pop()}return a}function Wn(n,t,e,i){const o=i.minLng,s=i.maxLng,r=i.minLat,a=i.maxLat;if(n>=o&&n<=s)return t<r?Qt((t-r)*pt):t>a?Qt((t-a)*pt):0;const c=Math.min(Qt((n-o)*pt),Qt((n-s)*pt)),l=Zl(t,c);return l>r&&l<a?Me(c,e,t,l):Math.min(Me(c,e,t,r),Me(c,e,t,a))}function jl(n,t){return n.dist-t.dist}function Qt(n){const t=Math.sin(n/2);return t*t}function Me(n,t,e,i){return t*Math.cos(i*pt)*n+Qt((e-i)*pt)}function Gn(n,t,e,i,o){const s=Qt((n-e)*pt);return Me(s,o,t,i)}function Zl(n,t){const e=1-2*t;return e<=0?n>0?90:-90:Math.atan(Math.tan(n*pt)/e)/pt}const Zu="2025.8.0",Ju="2025-08-08T06:36:22.687Z",Qi=new Map;function qu(n,t){Qi.set(n,t)}const _s={INWARD:"INWARD",OUTWARD:"OUTWARD"},It={VALUE:"VALUE",CARDINAL:"CARDINAL",CARDINAL2:"CARDINAL2",CARDINAL3:"CARDINAL3"},Jl={[It.CARDINAL]:["N","E","S","W"],[It.CARDINAL2]:["N","NE","E","SE","S","SW","W","NW"],[It.CARDINAL3]:["N","NNE","NE","ENE","E","ESE","SE","SSE","S","SSW","SW","WSW","W","WNW","NW","NNW"]};function Zi(n,t){if(!t)return`${Math.round(n)}`;const{scale:e=1,offset:i=0,decimals:o=0}=t,s=e*n+i;return`${o?Math.round(s*10**o)/10**o:Math.round(s)}`}function Ss(n){return n.unit.replace("^2","").replace("^3","")}function ql(n,t){return`${Zi(n,t)}${Ss(t)}`}function Kl(n,t,e){if(t===_s.OUTWARD&&(n+=180),e===It.VALUE)return`${Math.round(n%360)}`;if(e===It.CARDINAL||e===It.CARDINAL2||e===It.CARDINAL3){const i=Jl[e],o=360/i.length;return i[Math.floor((n%360+o/2)/o)%i.length]}throw new Error("Invalid state")}const Ku=1,Ls=[255,255,255],Ji='"Helvetica Neue", Arial, Helvetica, sans-serif',Xu=12,qi=[255,255,255],Yu=1,Ki=[13,13,13],Ms=Zi,Hu=40,Xl=[255,255,255];function G(n,t){const e={};for(const i in n)if(n[i]===void 0&&i in t){const o=t[i];o&&("value"in o?o.value&&(e[i]=o.value):e[i]=o)}return Object.freeze({...n,...e})}class Yl{constructor(t){this._running=!1,this._raf=void 0,this._lastFrameTime=0,this._config=t}getConfig(){return{...this._config}}setConfig(t){this._config=t}updateConfig(t){this.setConfig({...this._config,...t})}get running(){return this._running}toggle(t=!this._running){t?this.start():this.stop()}start(){this._running||(this._running=!0,this._raf=window.requestAnimationFrame((()=>this.step())))}stop(){this._running&&(this._running=!1,this._raf&&(window.cancelAnimationFrame(this._raf),this._raf=void 0))}step(){const t=1e3/(this._config.fps??30),e=Date.now(),i=e-this._lastFrameTime;i>t&&(this._lastFrameTime=e-i%t,this._config.onUpdate()),this._running&&(this._raf=window.requestAnimationFrame((()=>this.step())))}}const Hl=new Map,$l=new class{constructor(){this.queue=Promise.resolve()}async run(n){const t=this.queue;let e;this.queue=new Promise((i=>{e=i}));try{return await t,await n()}finally{e()}}};async function tu(n,t){const e=await(async function(a){if(Qi.has(a))return Qi.get(a);try{if(a==="geotiff")return await ir(()=>import("./geotiff-8Ew76D87.js").then(c=>c.g),__vite__mapDeps([0,1,2]))}catch(c){throw new Error(`Optional dependency '${a}' is missing, install it with a package manager or provide with \`setLibrary('${a}', library)\``,{cause:c})}})("geotiff");let i;try{i=await e.fromUrl(n,{allowFullFile:!0,blockSize:Number.MAX_SAFE_INTEGER,fetch:(a,c)=>fetch(a,{...c,headers:{...c?.headers,...t?.headers}})})}catch(a){throw new Error(`Image ${n} can't be decoded.`,{cause:a})}const o=await i.getImage(0),s=await o.readRasters({interleave:!0});if(!(s instanceof Uint8Array||s instanceof Uint8ClampedArray||s instanceof Float32Array))throw new Error("Unsupported data format");return{data:(function(a,c){if(c==null)return a;const l=a.slice(0);for(let u=0;u<l.length;u++)Math.abs(l[u]-c)<2*Number.EPSILON&&(l[u]=NaN);return l})(s,o.getGDALNoData()),width:o.getWidth(),height:o.getHeight()}}function Qs(n){return async(t,e)=>{if(e?.cache===!1)return n(t);const i=e?.cache??Hl,o=t+(e?.headers?":"+JSON.stringify(e?.headers):""),s=i.get(o);if(s)return s;const r={...e,cache:void 0},a=n(t,r);return i.set(o,a),a.then((c=>{i.set(o,c)})),a}}const Os=Qs((async(n,t)=>{if(n.includes(".png")||n.includes(".webp")||n.includes("image/png")||n.includes("image/webp"))return(async function(e,i){let o;if(i?.headers){const g=await fetch(e,{headers:i.headers});if(!g.ok)throw new Error(`URL ${e} can't be loaded. Status: ${g.status}`);const h=await g.blob();o=URL.createObjectURL(h)}const s=new Image;try{await new Promise(((g,h)=>{s.addEventListener("load",g),s.addEventListener("error",h),s.crossOrigin="anonymous",s.src=o??e}))}catch(g){throw new Error(`URL ${e} can't be loaded.`,{cause:g})}finally{o&&URL.revokeObjectURL(o)}try{await $l.run((()=>s.decode()))}catch(g){throw new Error(`Image ${e} can't be decoded.`,{cause:g})}const r=document.createElement("canvas");r.width=s.width,r.height=s.height;const a=r.getContext("2d");a.drawImage(s,0,0);const c=a.getImageData(0,0,r.width,r.height),{data:l,width:u,height:d}=c;return{data:l,width:u,height:d}})(n,t);if(n.includes(".tif")||n.includes("image/tif"))return tu(n,t);throw new Error("Unsupported data format")})),$u=Qs((async(n,t)=>{const e=await fetch(n,{headers:t?.headers});if(!e.ok)throw new Error(`URL ${n} can't be loaded. Status: ${e.status}`);return e.json()}));function eu(n,t,e){if(!t){if(e===0)return n;throw new Error("Invalid state")}if(e<=0)return n;if(e>=1)return t;{const i=new Date(n),o=new Date(t);return new Date(i.getTime()+(o.getTime()-i.getTime())*e).toISOString()}}function iu(n,t,e){if(!t){if(n===e)return 0;throw new Error("Invalid state")}if(e<=n)return 0;if(e>=t)return 1;{const i=new Date(n),o=new Date(t);return(new Date(e).getTime()-i.getTime())/(o.getTime()-i.getTime())}}function td(n,t){return[...n].reverse().find((e=>e<=t))}function ed(n,t){return n.find((e=>e>=t))}function jn(n,t){const e=new Date(n);return new Date(e.getTime()+1e3*t*60*60).toISOString()}function id(n,t,e){return[jn(n,t),jn(n,e)]}function Zn(n){if(!n)return n;const t=new Date(n);return t.getDate()?`${t.getUTCFullYear()}/${`${t.getUTCMonth()+1}`.padStart(2,"0")}/${`${t.getUTCDate()}`.padStart(2,"0")} ${`${t.getUTCHours()}`.padStart(2,"0")}:${`${t.getUTCMinutes()}`.padStart(2,"0")}UTC`:n}const ut={NEAREST:"NEAREST",LINEAR:"LINEAR",CUBIC:"CUBIC"},tt={SCALAR:"SCALAR",VECTOR:"VECTOR"},nd={METRIC:"METRIC",METRIC_KILOMETERS:"METRIC_KILOMETERS",IMPERIAL:"IMPERIAL",NAUTICAL:"NAUTICAL"},rt={BOTTOM:"BOTTOM",TOP:"TOP",RIGHT:"RIGHT",LEFT:"LEFT"};function xe(n){return n%1}function fi(n,t){return n.map(((e,i)=>n[i]+t[i]))}function we(n,t){return n.map(((e,i)=>n[i]*t))}function Pe(n,t){return n.map(((e,i)=>n[i]*t[i])).reduce(((e,i)=>e+i))}function Wt(n,t,e){return n===t?n:n*(1-e)+t*e}function Qe(n,t,e){return n.map(((i,o)=>Wt(n[o],t[o],e)))}function Rs(n,t){return t?n[3]>=255:!isNaN(n[0])}function Fs(n,t,e){return t===tt.VECTOR?e?[Wt(e[0],e[1],n[0]/255),Wt(e[0],e[1],n[1]/255)]:[n[0],n[1]]:[NaN,NaN]}function Us(n,t,e){if(t===tt.VECTOR){const i=Fs(n,t,e);return Math.hypot(i[0],i[1])}return(function(i,o,s){return o===tt.VECTOR?0:s?Wt(s[0],s[1],i[0]/255):i[0]})(n,t,e)}function Y(n,t,e,i,o,s){const{data:r,width:a,height:c}=n,l=r.length/(a*c),u=(e+o+.5)/t[0],d=(i+s+.5)/t[1],g=Math.max(0,Math.min(a-1,Math.floor(u*a))),h=Math.max(0,Math.min(c-1,Math.floor(d*c)));return new Array(l).fill(void 0).map(((p,A)=>r[(g+h*a)*l+A]))}const Jn=[3,-6,0,4].map((n=>n/6)),qn=[-1,6,-12,8].map((n=>n/6));function Te(n){return[n*n*n,n*n,n,1]}function ie(n,t,e,i,o){const s=fi(fi(fi(we(n,Pe(qn,Te(o+1))),we(t,Pe(Jn,Te(o)))),we(e,Pe(Jn,Te(1-o)))),we(i,Pe(qn,Te(2-o))));return s[3]=n[3]>0&&t[3]>0&&e[3]>0&&i[3]>0?Math.max(Math.max(Math.max(n[3],t[3]),e[3]),i[3]):0,s}function pi(n,t,e,i,o){return e===ut.CUBIC?(function(s,r,a,c){const l=a*r[0]-.5,u=c*r[1]-.5,d=Math.floor(l),g=Math.floor(u),h=xe(l),p=xe(u);return ie(ie(Y(s,r,d,g,-1,-1),Y(s,r,d,g,0,-1),Y(s,r,d,g,1,-1),Y(s,r,d,g,2,-1),h),ie(Y(s,r,d,g,-1,0),Y(s,r,d,g,0,0),Y(s,r,d,g,1,0),Y(s,r,d,g,2,0),h),ie(Y(s,r,d,g,-1,1),Y(s,r,d,g,0,1),Y(s,r,d,g,1,1),Y(s,r,d,g,2,1),h),ie(Y(s,r,d,g,-1,2),Y(s,r,d,g,0,2),Y(s,r,d,g,1,2),Y(s,r,d,g,2,2),h),p)})(n,t,i,o):e===ut.LINEAR?(function(s,r,a,c){const l=a*r[0]-.5,u=c*r[1]-.5,d=Math.floor(l),g=Math.floor(u),h=xe(l),p=xe(u);return Qe(Qe(Y(s,r,d,g,0,0),Y(s,r,d,g,1,0),h),Qe(Y(s,r,d,g,0,1),Y(s,r,d,g,1,1),h),p)})(n,t,i,o):(function(s,r,a,c){const l=a*r[0]-.5,u=c*r[1]-.5;return Y(s,r,Math.round(l),Math.round(u),0,0)})(n,t,i,o)}function Ds(n,t,e,i,o,s,r,a){const c=s?r+.5/e[0]:Wt(0+.5/e[0],1-.5/e[0],r),l=Wt(0+.5/e[1],1-.5/e[1],a);return t&&o>0?Qe(pi(n,e,i,c,l),pi(t,e,i,c,l),o):pi(n,e,i,c,l)}function ks(n,t,e){const i=1+Math.max(0,e);return[n/i,t/i]}const Ns=-180,zs=180,Vs=-85.051129,Ws=85.051129,nu=[Ns,Vs,zs,Ws];function Oi(n,t){let e=((n+180)%(i=360)+i)%i-180;var i;return typeof t=="number"&&e<t&&(e+=360),e}function At(n){return n[2]-n[0]==360}function Gs(n,t){return n[0]>=t[0]&&n[0]<=t[2]&&n[1]>=t[1]&&n[1]<=t[3]}function ne(n,t){return{type:"Feature",geometry:{type:"Point",coordinates:n},properties:t}}function ou(n,t,e){const{image:i,image2:o,imageSmoothing:s,imageInterpolation:r,imageWeight:a,imageType:c,imageUnscale:l,imageMinValue:u,imageMaxValue:d}=n,{width:g,height:h}=i,p=(function(y,v,b){const x=[b[0],b[3]],I=(b[2]-b[0])/y,Q=(b[3]-b[1])/v;return R=>{const[M,z]=R;return[(M-x[0])/I,(x[1]-z)/Q]}})(g,h,t),A=ks(g,h,s),f=At(t);return{type:"FeatureCollection",features:e.map((y=>{if(!Gs(y,t))return ne(y,{value:NaN});const v=p(y),b=v[0]/g,x=v[1]/h,I=Ds(i,o,A,r,a,f,b,x);if(!Rs(I,l))return ne(y,{value:NaN});const Q=Us(I,c,l);if(typeof u=="number"&&!isNaN(u)&&Q<u||typeof d=="number"&&!isNaN(d)&&Q>d)return ne(y,{value:NaN});if(c===tt.VECTOR){const R=(function(M,z,j){if(z===tt.VECTOR){const X=Fs(M,z,j);return(360-(Math.atan2(X[1],X[0])/Math.PI*180+180)-270)%360}return NaN})(I,c,l);return ne(y,{value:Q,direction:R})}return ne(y,{value:Q})}))}}function od(n,t){const{image:e,image2:i,imageSmoothing:o,imageInterpolation:s,imageWeight:r,imageType:a,imageUnscale:c,imageMinValue:l,imageMaxValue:u}=n,{width:d,height:g}=e,h=s!==ut.NEAREST?ut.NEAREST:s,p=ks(d,g,o),A=At(t),f=new Float32Array(d*g);for(let C=0;C<g;C++)for(let y=0;y<d;y++){const v=y+C*d,b=Ds(e,i,p,h,r,A,y/d,C/g);if(!Rs(b,c)){f[v]=NaN;continue}const x=Us(b,a,c);typeof l=="number"&&!isNaN(l)&&x<l||typeof u=="number"&&!isNaN(u)&&x>u?f[v]=NaN:f[v]=x}return{data:f,width:d,height:g}}const js=6370972;function ct(n,t){return El(n,t,js)}function su(n,t,e){return Il(n,t,e,js)}function lt(n){return!!n.resolution}function Zs(n){return!lt(n)}function Xt(n,t,e){return!(t!=null&&n.zoom<t)&&!(e!=null&&n.zoom>e)}function Xi(n){return[n.longitude,n.latitude]}function Js(n){const t=Xi(n);return Math.max(ct(t,n.unproject([n.width/2,0])),ct(t,n.unproject([0,n.height/2])),...n.width>n.height?[ct(t,n.unproject([n.width/2-n.height/4*1,n.height/2])),ct(t,n.unproject([n.width/2-n.height/2*1,n.height/2])),ct(t,n.unproject([n.width/2-n.height/4*3,n.height/2])),ct(t,n.unproject([n.width/2-n.height,n.height/2]))]:[ct(t,n.unproject([n.width/2,n.height/2-n.width/4*1])),ct(t,n.unproject([n.width/2,n.height/2-n.width/2*1])),ct(t,n.unproject([n.width/2,n.height/2-n.width/4*3])),ct(t,n.unproject([n.width/2,n.height/2-n.width]))])}function qs(n){return(function(t){const e=t[2]-t[0]<360?Oi(t[0]):Ns,i=t[2]-t[0]<360?Oi(t[2],e):zs;return[e,Math.max(t[1],Vs),i,Math.min(t[3],Ws)]})(n.getBounds())}function ce(n){return lt(n)?Math.log2(n.scale):n.zoom}function Kn(n,t){return t*(lt(n)?-1:1)}function xt(n,t){return t+(lt(n)?180:0)}const ru=new WeakMap,au=new WeakMap;function Tt(n,t,e=!1){const i=e?ru:au,o=i.get(n)??(()=>{const r=new WeakMap;return i.set(n,r),r})();return o.get(t)??(()=>{const r=(function(c,l,u){const{data:d,width:g,height:h}=l,p=d.length/(g*h);let A;if(d instanceof Uint8Array||d instanceof Uint8ClampedArray)if(p===4)A="rgba8unorm";else if(p===2)A="rg8unorm";else{if(p!==1)throw new Error("Unsupported data format");A="r8unorm"}else{if(!(d instanceof Float32Array))throw new Error("Unsupported data format");if(!c.features.has("float32-renderable-webgl"))throw new Error("Float textures are required");if(p===2)A="rg32float";else{if(p!==1)throw new Error("Unsupported data format");A="r32float"}}return{data:d,width:g,height:h,format:A,mipmaps:!1,sampler:{magFilter:"nearest",minFilter:"nearest",addressModeU:u?"repeat":"clamp-to-edge",addressModeV:"clamp-to-edge",lodMaxClamp:0}}})(n,t,e),a=n.createTexture(r);return o.set(t,a),a})()}let Ai=null;function $(n){return Ai||(Ai=n.createTexture({data:new Uint8Array(4),width:1,height:1,mipmaps:!1})),Ai}function Yi(n,t){const e=t.domain(),i=[e[0],e[e.length-1]],o=qo(t);return{paletteBounds:i,paletteTexture:n.createTexture({data:o,sampler:{magFilter:"linear",minFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}})}}function Ks(n){return[n[0]/255,n[1]/255,n[2]/255,(n[3]??255)/255]}function We(n){return[n[0],n[1],n[2],255*n[3]]}const Xn="uniform bitmap2Uniforms{vec4 A;bool B;float C;vec4 D;}bitmap2;const float E=512.;const float F=3.1415926536;const float G=E/F/2.;vec2 H(vec2 I){float J=I.x;float K=clamp(I.y,-89.9,89.9);return vec2(radians(J)+F,F+log(tan(F*0.25+radians(K)*0.5)))*G;}vec2 L(vec2 M){M/=G;return degrees(vec2(M.x-F,atan(exp(M.y-F))*2.-F*0.5));}vec4 N(vec3 O,float P){return mix(bitmap2.D,vec4(O,1.),P);}vec2 Q(vec2 R){return vec2((R.x-bitmap2.A[0])/(bitmap2.A[2]-bitmap2.A[0]),(R.y-bitmap2.A[3])/(bitmap2.A[1]-bitmap2.A[3]));}vec2 S(vec2 T,vec2 U){vec2 uv=T;if(bitmap2.C<-0.5){vec2 I=L(U);uv=Q(I);}else if(bitmap2.C>0.5){vec2 V=H(U);uv=Q(V);}return uv;}",Yn="A",Hn="B",$n="C",to="D",Dt=Math.PI,cu=Dt/4,eo=Dt/180,io=512;function no(n){const[t,e]=n,i=e*eo;return[io*(t*eo+Dt)/(2*Dt),io*(Dt+Math.log(Math.tan(cu+.5*i)))/(2*Dt)]}function lu(n={}){const{LNGLAT:t,CARTESIAN:e,DEFAULT:i}=H;let{viewportGlobe:o,bounds:s,_imageCoordinateSystem:r}=n;if(!(function(a){return Number.isFinite(a[0])})(s))throw new Error("_imageCoordinateSystem only supports rectangular bounds");if(r!==i){const a=o?t:e;if(r=r===t?t:e,r===t&&a===e)return{coordinateConversion:-1,bounds:s};if(r===e&&a===t){const c=no([s[0],s[1]]),l=no([s[2],s[3]]);return{coordinateConversion:1,bounds:[c[0],c[1],l[0],l[1]]}}}return{coordinateConversion:0,bounds:s}}const Gt={name:"bitmap2",vs:Xn,fs:Xn,uniformTypes:{[Yn]:"vec4<f32>",[Hn]:"f32",[$n]:"f32",[to]:"vec4<f32>"},getUniforms:function(n={}){const{bounds:t,coordinateConversion:e}=lu(n);return{[Yn]:t,[Hn]:At(t)?1:0,[$n]:e,[to]:n.transparentColor?Ks(n.transparentColor):[0,0,0,0]}}},oo="uniform sampler2D W;uniform sampler2D X;uniform rasterUniforms{vec2 Y;float Z;float a;float b;float c;vec2 d;float e;float f;}raster;",uu="W",du="X",so="Y",ro="Z",ao="a",co="b",lo="c",uo="d",go="e",ho="f",jt={name:"raster",vs:oo,fs:oo,uniformTypes:{[so]:"vec2<f32>",[ro]:"f32",[ao]:"f32",[co]:"f32",[lo]:"f32",[uo]:"vec2<f32>",[go]:"f32",[ho]:"f32"},getUniforms:function(n={}){return{[uu]:n.imageTexture,[du]:n.imageTexture2,[so]:n.imageTexture?[n.imageTexture.width,n.imageTexture.height]:[0,0],[ro]:n.imageSmoothing??0,[ao]:Object.values(ut).indexOf(n.imageInterpolation??ut.NEAREST),[co]:n.imageTexture2!==n.imageTexture&&n.imageWeight?n.imageWeight:0,[lo]:Object.values(tt).indexOf(n.imageType??tt.SCALAR),[uo]:n.imageUnscale??[0,0],[go]:n.imageMinValue??Number.MIN_SAFE_INTEGER,[ho]:n.imageMaxValue??Number.MAX_SAFE_INTEGER}}},fo="uniform sampler2D g;uniform paletteUniforms{vec2 h;vec4 i;}palette;float j(float min,float max,float k){return(k-min)/(max-min);}vec4 l(sampler2D g,vec2 h,vec4 i,float k){if(h[0]<h[1]){float m=j(h[0],h[1],k);return texture(g,vec2(m,0.));}else{return i;}}",gu="g",po="h",Ao="i",Zt={name:"palette",vs:fo,fs:fo,uniformTypes:{[po]:"vec2<f32>",[Ao]:"vec4<f32>"},getUniforms:function(n={}){return{[gu]:n.paletteTexture,[po]:n.paletteBounds??[0,0],[Ao]:n.paletteColor?Ks(n.paletteColor):[0,0,0,0]}}},oe={imageTexture:{type:"object",value:null},imageTexture2:{type:"object",value:null},imageSmoothing:{type:"number",value:0},imageInterpolation:{type:"object",value:ut.CUBIC},imageWeight:{type:"number",value:0},imageType:{type:"object",value:tt.SCALAR},imageUnscale:{type:"array",value:null},imageMinValue:{type:"object",value:null},imageMaxValue:{type:"object",value:null},bounds:{type:"array",value:[-180,-90,180,90],compare:!0},minZoom:{type:"object",value:null},maxZoom:{type:"object",value:null},palette:{type:"object",value:null}};class Ge extends He{getShaders(){const t=super.getShaders();return{...t,fs:`#version 300 es
#define SHADER_NAME  raster-bitmap-layer-fragment-shader
#ifdef GL_ES
precision highp float;
#endif
vec4 AA(sampler2D AB,vec2 AC,vec2 AD,vec2 AE){vec2 uv=(AD+AE+0.5)/AC;return texture(AB,uv);}const vec4 AF=vec4(3.,-6.,0.,4.)/6.;const vec4 AG=vec4(-1.,6.,-12.,8.)/6.;vec4 AH(float J){return vec4(J*J*J,J*J,J,1.);}vec4 AI(vec4 AJ,vec4 AK,vec4 AL,vec4 AM,float AN){vec4 O=AJ*dot(AG,AH(AN+1.))+AK*dot(AF,AH(AN))+AL*dot(AF,AH(1.-AN))+AM*dot(AG,AH(2.-AN));O.a=(AJ.a>0.&&AK.a>0.&&AL.a>0.&&AM.a>0.)?max(max(max(AJ.a,AK.a),AL.a),AM.a):0.;return O;}vec4 AO(sampler2D AB,vec2 AC,vec2 uv){vec2 AP=uv*AC-0.5;vec2 AD=floor(AP);vec2 AQ=fract(AP);return AI(AI(AA(AB,AC,AD,vec2(-1,-1)),AA(AB,AC,AD,vec2(0,-1)),AA(AB,AC,AD,vec2(1,-1)),AA(AB,AC,AD,vec2(2,-1)),AQ.x),AI(AA(AB,AC,AD,vec2(-1,0)),AA(AB,AC,AD,vec2(0,0)),AA(AB,AC,AD,vec2(1,0)),AA(AB,AC,AD,vec2(2,0)),AQ.x),AI(AA(AB,AC,AD,vec2(-1,1)),AA(AB,AC,AD,vec2(0,1)),AA(AB,AC,AD,vec2(1,1)),AA(AB,AC,AD,vec2(2,1)),AQ.x),AI(AA(AB,AC,AD,vec2(-1,2)),AA(AB,AC,AD,vec2(0,2)),AA(AB,AC,AD,vec2(1,2)),AA(AB,AC,AD,vec2(2,2)),AQ.x),AQ.y);}vec4 AR(sampler2D AB,vec2 AC,vec2 uv){vec2 AP=uv*AC-0.5;vec2 AD=floor(AP);vec2 AQ=fract(AP);return mix(mix(AA(AB,AC,AD,vec2(0,0)),AA(AB,AC,AD,vec2(1,0)),AQ.x),mix(AA(AB,AC,AD,vec2(0,1)),AA(AB,AC,AD,vec2(1,1)),AQ.x),AQ.y);}vec4 AS(sampler2D AB,vec2 AC,vec2 uv){vec2 AP=uv*AC-0.5;vec2 AD=floor(AP+0.5);return AA(AB,AC,AD,vec2(0,0));}vec4 AT(sampler2D AB,vec2 AC,float a,vec2 uv){if(a==2.){return AO(AB,AC,uv);}if(a==1.){return AR(AB,AC,uv);}else{return AS(AB,AC,uv);}}vec4 AU(sampler2D AB,sampler2D AV,vec2 AC,float a,float b,bool B,vec2 uv){vec2 AW;AW.x=B?uv.x+0.5/AC.x:mix(0.+0.5/AC.x,1.-0.5/AC.x,uv.x);AW.y=mix(0.+0.5/AC.y,1.-0.5/AC.y,uv.y);if(b>0.){vec4 AX=AT(AB,AC,a,AW);vec4 AY=AT(AV,AC,a,AW);return mix(AX,AY,b);}else{return AT(AB,AC,a,AW);}}vec4 AZ(sampler2D AB,sampler2D AV,vec2 Y,float Z,float a,float b,bool B,vec2 uv){float Aa=1.+max(0.,Z);vec2 AC=Y/Aa;return AU(AB,AV,AC,a,b,B,uv);}float Ab(float K,float J){return J==0.?sign(K)*F/2.:atan(K,J);}bool Ac(float k){uint Ad=floatBitsToUint(k);return(Ad&0x7fffffffu)>0x7f800000u;}bool Ae(vec4 AX,vec2 d){if(d[0]<d[1]){return AX.a>=1.;}else{return!Ac(AX.x);}}float Af(vec4 AX,float c,vec2 d){if(c==1.){return 0.;}else{if(d[0]<d[1]){return mix(d[0],d[1],AX.x);}else{return AX.x;}}}vec2 Ag(vec4 AX,float c,vec2 d){if(c==1.){if(d[0]<d[1]){return mix(vec2(d[0]),vec2(d[1]),AX.xy);}else{return AX.xy;}}else{return vec2(0.);}}float Ah(vec4 AX,float c,vec2 d){if(c==1.){vec2 k=Ag(AX,c,d);return length(k);}else{return Af(AX,c,d);}}float Ai(vec4 AX,float c,vec2 d){if(c==1.){vec2 k=Ag(AX,c,d);return mod((360.-(Ab(k.y,k.x)/F*180.+180.))-270.,360.)/360.;}else{return 0.;}}in vec2 vTexCoord;in vec2 vTexPos;out vec4 fragColor;void main(void){vec2 uv=S(vTexCoord,vTexPos);vec4 AX=AZ(W,X,raster.Y,raster.Z,raster.a,raster.b,bitmap2.B,uv);if(!Ae(AX,raster.d)){discard;}float k=Ah(AX,raster.c,raster.d);if((!Ac(raster.e)&&k<raster.e)||(!Ac(raster.f)&&k>raster.f)){discard;}vec4 Aj=l(g,palette.h,palette.i,k);fragColor=N(Aj.rgb,Aj.a*layer.opacity);geometry.uv=uv;DECKGL_FILTER_COLOR(fragColor,geometry);if(bool(picking.isActive)&&!bool(picking.isAttribute)){float m=j(palette.h[0],palette.h[1],k);float Ak=Ai(AX,raster.c,raster.d);fragColor=vec4(m,Ak,0,1);}}`,modules:[...t.modules,Gt,jt,Zt]}}updateState(t){const{palette:e}=t.props;super.updateState(t),e!==t.oldProps.palette&&this._updatePalette()}draw(t){const{device:e,viewport:i}=this.context,{model:o}=this.state,{imageTexture:s,imageTexture2:r,imageSmoothing:a,imageInterpolation:c,imageWeight:l,imageType:u,imageUnscale:d,imageMinValue:g,imageMaxValue:h,bounds:p,_imageCoordinateSystem:A,transparentColor:f,minZoom:C,maxZoom:y}=G(this.props,oe),{paletteTexture:v,paletteBounds:b}=this.state;if(!s)return;const x=lt(i);o&&Xt(i,C,y)&&(o.shaderInputs.setProps({[Gt.name]:{viewportGlobe:x,bounds:p,_imageCoordinateSystem:A,transparentColor:f},[jt.name]:{imageTexture:s??$(e),imageTexture2:r??$(e),imageSmoothing:a,imageInterpolation:c,imageWeight:l,imageType:u,imageUnscale:d,imageMinValue:g,imageMaxValue:h},[Zt.name]:{paletteTexture:v??$(e),paletteBounds:b}}),o.setParameters({...o.parameters,cullMode:"back",depthCompare:"always",...this.props.parameters}),this.props.image=s,super.draw(t),this.props.image=null)}_updatePalette(){const{device:t}=this.context,{palette:e}=G(this.props,oe);if(!e)return void this.setState({paletteTexture:void 0,paletteBounds:void 0});const i=Jt(e),{paletteBounds:o,paletteTexture:s}=Yi(t,i);this.setState({paletteTexture:s,paletteBounds:o})}_getRasterMagnitudeValue(t,e){return e[0]+t[0]/255*(e[1]-e[0])}_getRasterDirectionValue(t){const{imageType:e}=G(this.props,oe);return e===tt.VECTOR?t[1]/255*360:NaN}getPickingInfo(t){const e=super.getPickingInfo(t),{imageType:i}=G(this.props,oe),{paletteBounds:o}=this.state;if(!e.color)return e;let s;const r=this._getRasterMagnitudeValue(e.color,o??[0,0]);return i===tt.VECTOR?s={value:r,direction:this._getRasterDirectionValue(e.color)}:s={value:r},e.raster=s,e}}Ge.layerName="RasterBitmapLayer",Ge.defaultProps=oe;const Ri={...Ge.defaultProps,imageTexture:void 0,imageTexture2:void 0,image:{type:"object",value:null},image2:{type:"object",value:null},bounds:{type:"array",value:[-180,-90,180,90],compare:!0},gridEnabled:{type:"boolean",value:!1}};class mo extends dt{renderLayers(){const{device:t}=this.context,{props:e,imageTexture:i,imageTexture2:o}=this.state;if(!e||!i)return[];const{gridEnabled:s}=G(e,Ri);let r;if(s){const{positions:a}=this.state;r=new Vi({data:a,getPosition:c=>c,getRadius:1,getFillColor:[255,255,255],radiusUnits:"pixels",opacity:.2,parameters:{depthCompare:"always",...this.props.parameters}})}return[new Ge(this.props,this.getSubLayerProps({id:"bitmap",imageTexture:i,imageTexture2:o,_imageCoordinateSystem:H.LNGLAT,image:$(t),image2:$(t)})),...r?[r]:[]]}updateState(t){const{image:e,image2:i,imageUnscale:o,bounds:s,gridEnabled:r}=t.props;if(super.updateState(t),e&&o&&!(e.data instanceof Uint8Array||e.data instanceof Uint8ClampedArray))throw new Error("imageUnscale can be applied to Uint8 data only");if(e!==t.oldProps.image||i!==t.oldProps.image2){const{device:a}=this.context,{image:c,image2:l}=this.props,u=c?Tt(a,c,At(s)):null,d=l?Tt(a,l,At(s)):null;this.setState({imageTexture:u,imageTexture2:d})}e===t.oldProps.image&&r===t.oldProps.gridEnabled||this._updateFeatures(),this.setState({props:t.props})}_updateFeatures(){const{image:t,bounds:e,gridEnabled:i}=G(this.props,Ri);if(t&&i){const o=[e[0],e[1]],s=[e[2],e[3]],r=s[0]-o[0],a=s[1]-o[1],c=t.width,l=t.height,u=r/(c-(At(e)?0:1)),d=a/(l-1),g=new Array(c*l).fill(void 0).map(((p,A)=>[o[0]+A%c*u,o[1]+Math.floor(A/c)*d])),h=(function(p,A){return lt(p)?A:A.filter((f=>Gs(f,nu)))})(this.context.viewport,g);this.setState({positions:h})}}}mo.layerName="RasterLayer",mo.defaultProps=Ri;const vo="uniform contourUniforms{float n;float o;float p;}contour;",Co="n",yo="o",Eo="p",bo={name:"contour",vs:vo,fs:vo,uniformTypes:{[Co]:"f32",[yo]:"f32",[Eo]:"f32"},getUniforms:function(n={}){return{[Co]:n.interval,[yo]:n.majorInterval,[Eo]:n.width}}},Fi={imageTexture:{type:"object",value:null},imageTexture2:{type:"object",value:null},imageSmoothing:{type:"number",value:0},imageInterpolation:{type:"object",value:ut.CUBIC},imageWeight:{type:"number",value:0},imageType:{type:"object",value:tt.SCALAR},imageUnscale:{type:"object",value:null},imageMinValue:{type:"object",value:null},imageMaxValue:{type:"object",value:null},bounds:{type:"array",value:[-180,-90,180,90],compare:!0},minZoom:{type:"object",value:null},maxZoom:{type:"object",value:10},palette:{type:"object",value:null},color:{type:"color",value:Ls},interval:{type:"number",value:0},majorInterval:{type:"number",value:0},width:{type:"number",value:1}};class je extends He{getShaders(){const t=super.getShaders();return{...t,fs:`#version 300 es
#define SHADER_NAME  contour-bitmap-layer-fragment-shader
#ifdef GL_ES
precision highp float;
#endif
vec4 AA(sampler2D AB,vec2 AC,vec2 AD,vec2 AE){vec2 uv=(AD+AE+0.5)/AC;return texture(AB,uv);}const vec4 AF=vec4(3.,-6.,0.,4.)/6.;const vec4 AG=vec4(-1.,6.,-12.,8.)/6.;vec4 AH(float J){return vec4(J*J*J,J*J,J,1.);}vec4 AI(vec4 AJ,vec4 AK,vec4 AL,vec4 AM,float AN){vec4 O=AJ*dot(AG,AH(AN+1.))+AK*dot(AF,AH(AN))+AL*dot(AF,AH(1.-AN))+AM*dot(AG,AH(2.-AN));O.a=(AJ.a>0.&&AK.a>0.&&AL.a>0.&&AM.a>0.)?max(max(max(AJ.a,AK.a),AL.a),AM.a):0.;return O;}vec4 AO(sampler2D AB,vec2 AC,vec2 uv){vec2 AP=uv*AC-0.5;vec2 AD=floor(AP);vec2 AQ=fract(AP);return AI(AI(AA(AB,AC,AD,vec2(-1,-1)),AA(AB,AC,AD,vec2(0,-1)),AA(AB,AC,AD,vec2(1,-1)),AA(AB,AC,AD,vec2(2,-1)),AQ.x),AI(AA(AB,AC,AD,vec2(-1,0)),AA(AB,AC,AD,vec2(0,0)),AA(AB,AC,AD,vec2(1,0)),AA(AB,AC,AD,vec2(2,0)),AQ.x),AI(AA(AB,AC,AD,vec2(-1,1)),AA(AB,AC,AD,vec2(0,1)),AA(AB,AC,AD,vec2(1,1)),AA(AB,AC,AD,vec2(2,1)),AQ.x),AI(AA(AB,AC,AD,vec2(-1,2)),AA(AB,AC,AD,vec2(0,2)),AA(AB,AC,AD,vec2(1,2)),AA(AB,AC,AD,vec2(2,2)),AQ.x),AQ.y);}vec4 AR(sampler2D AB,vec2 AC,vec2 uv){vec2 AP=uv*AC-0.5;vec2 AD=floor(AP);vec2 AQ=fract(AP);return mix(mix(AA(AB,AC,AD,vec2(0,0)),AA(AB,AC,AD,vec2(1,0)),AQ.x),mix(AA(AB,AC,AD,vec2(0,1)),AA(AB,AC,AD,vec2(1,1)),AQ.x),AQ.y);}vec4 AS(sampler2D AB,vec2 AC,vec2 uv){vec2 AP=uv*AC-0.5;vec2 AD=floor(AP+0.5);return AA(AB,AC,AD,vec2(0,0));}vec4 AT(sampler2D AB,vec2 AC,float a,vec2 uv){if(a==2.){return AO(AB,AC,uv);}if(a==1.){return AR(AB,AC,uv);}else{return AS(AB,AC,uv);}}vec4 AU(sampler2D AB,sampler2D AV,vec2 AC,float a,float b,bool B,vec2 uv){vec2 AW;AW.x=B?uv.x+0.5/AC.x:mix(0.+0.5/AC.x,1.-0.5/AC.x,uv.x);AW.y=mix(0.+0.5/AC.y,1.-0.5/AC.y,uv.y);if(b>0.){vec4 AX=AT(AB,AC,a,AW);vec4 AY=AT(AV,AC,a,AW);return mix(AX,AY,b);}else{return AT(AB,AC,a,AW);}}vec4 AZ(sampler2D AB,sampler2D AV,vec2 Y,float Z,float a,float b,bool B,vec2 uv){float Aa=1.+max(0.,Z);vec2 AC=Y/Aa;return AU(AB,AV,AC,a,b,B,uv);}float Ab(float K,float J){return J==0.?sign(K)*F/2.:atan(K,J);}bool Ac(float k){uint Ad=floatBitsToUint(k);return(Ad&0x7fffffffu)>0x7f800000u;}bool Ae(vec4 AX,vec2 d){if(d[0]<d[1]){return AX.a>=1.;}else{return!Ac(AX.x);}}float Af(vec4 AX,float c,vec2 d){if(c==1.){return 0.;}else{if(d[0]<d[1]){return mix(d[0],d[1],AX.x);}else{return AX.x;}}}vec2 Ag(vec4 AX,float c,vec2 d){if(c==1.){if(d[0]<d[1]){return mix(vec2(d[0]),vec2(d[1]),AX.xy);}else{return AX.xy;}}else{return vec2(0.);}}float Ah(vec4 AX,float c,vec2 d){if(c==1.){vec2 k=Ag(AX,c,d);return length(k);}else{return Af(AX,c,d);}}float Ai(vec4 AX,float c,vec2 d){if(c==1.){vec2 k=Ag(AX,c,d);return mod((360.-(Ab(k.y,k.x)/F*180.+180.))-270.,360.)/360.;}else{return 0.;}}in vec2 vTexCoord;in vec2 vTexPos;out vec4 fragColor;void main(void){vec2 uv=S(vTexCoord,vTexPos);vec4 AX=AZ(W,X,raster.Y,raster.Z,raster.a,raster.b,bitmap2.B,uv);if(!Ae(AX,raster.d)){discard;}float k=Ah(AX,raster.c,raster.d);if((!Ac(raster.e)&&k<raster.e)||(!Ac(raster.f)&&k>raster.f)){discard;}float Aj=contour.o>contour.n?floor(contour.o/contour.n):1.;float Ak=k/contour.n;float Al=(step(fract(Ak/Aj),0.1)+1.)/2.;float Am=contour.p*Al;float An=abs(fract(Ak+0.5)-0.5);float Ao=length(vec2(dFdx(Ak),dFdy(Ak)));float Ap=1.-clamp((An/Ao)+0.5-Am,0.,1.);if(Ao==0.){Ap=0.;}float Aq=Ap*Al;vec4 Ar=l(g,palette.h,palette.i,k);fragColor=vec4(Ar.rgb,Ar.a*Aq*layer.opacity);geometry.uv=uv;DECKGL_FILTER_COLOR(fragColor,geometry);}`,modules:[...t.modules,Gt,jt,Zt,bo]}}updateState(t){const{palette:e}=t.props;super.updateState(t),e!==t.oldProps.palette&&this._updatePalette()}draw(t){const{device:e,viewport:i}=this.context,{model:o}=this.state,{imageTexture:s,imageTexture2:r,imageSmoothing:a,imageInterpolation:c,imageWeight:l,imageType:u,imageUnscale:d,imageMinValue:g,imageMaxValue:h,bounds:p,_imageCoordinateSystem:A,transparentColor:f,minZoom:C,maxZoom:y,color:v,interval:b,majorInterval:x,width:I}=G(this.props,Fi),{paletteTexture:Q,paletteBounds:R}=this.state;if(!s)return;const M=lt(i);o&&Xt(i,C,y)&&(o.shaderInputs.setProps({[Gt.name]:{viewportGlobe:M,bounds:p,_imageCoordinateSystem:A,transparentColor:f},[jt.name]:{imageTexture:s??$(e),imageTexture2:r??$(e),imageSmoothing:a,imageInterpolation:c,imageWeight:l,imageType:u,imageUnscale:d,imageMinValue:g,imageMaxValue:h},[Zt.name]:{paletteTexture:Q??$(e),paletteBounds:R,paletteColor:v},[bo.name]:{interval:b,majorInterval:x,width:I}}),o.setParameters({...o.parameters,cullMode:"back",depthCompare:"always",...this.props.parameters}),this.props.image=s,super.draw(t),this.props.image=null)}_updatePalette(){const{device:t}=this.context,{palette:e}=G(this.props,Fi);if(!e)return void this.setState({paletteTexture:void 0,paletteBounds:void 0});const i=Jt(e),{paletteBounds:o,paletteTexture:s}=Yi(t,i);this.setState({paletteTexture:s,paletteBounds:o})}}je.layerName="ContourBitmapLayer",je.defaultProps=Fi;const hu={...je.defaultProps,imageTexture:void 0,imageTexture2:void 0,image:{type:"object",value:null},image2:{type:"object",value:null}};class Io extends dt{renderLayers(){const{device:t}=this.context,{props:e,imageTexture:i,imageTexture2:o}=this.state;return e&&i?[new je(this.props,this.getSubLayerProps({id:"bitmap",imageTexture:i,imageTexture2:o,_imageCoordinateSystem:H.LNGLAT,image:$(t),image2:$(t)}))]:[]}updateState(t){const{image:e,image2:i,imageUnscale:o,bounds:s}=t.props;if(super.updateState(t),e&&o&&!(e.data instanceof Uint8Array||e.data instanceof Uint8ClampedArray))throw new Error("imageUnscale can be applied to Uint8 data only");if(e!==t.oldProps.image||i!==t.oldProps.image2){const{device:r}=this.context,{image:a,image2:c}=this.props,l=a?Tt(r,a,At(s)):null,u=c?Tt(r,c,At(s)):null;this.setState({imageTexture:l,imageTexture2:u})}this.setState({props:t.props})}}Io.layerName="ContourLayer",Io.defaultProps=hu;const fu="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";function Xs(n=20){return new Array(n).fill(void 0).map((()=>fu.charAt(Math.floor(62*Math.random())))).join("")}const pu=Ul((xo=function(){const n=Symbol("Comlink.proxy"),t=Symbol("Comlink.endpoint"),e=Symbol("Comlink.releaseProxy"),i=Symbol("Comlink.finalizer"),o=Symbol("Comlink.thrown"),s=m=>typeof m=="object"&&m!==null||typeof m=="function",r={canHandle:m=>s(m)&&m[n],serialize(m){const{port1:w,port2:_}=new MessageChannel;return c(m,w),[_,[_]]},deserialize:m=>(m.start(),(function(w,_){const P=new Map;return w.addEventListener("message",(function(T){const{data:S}=T;if(!S||!S.id)return;const L=P.get(S.id);if(L)try{L(S)}finally{P.delete(S.id)}})),p(w,P,[],_)})(m))},a=new Map([["proxy",r],["throw",{canHandle:m=>s(m)&&o in m,serialize({value:m}){let w;return w=m instanceof Error?{isError:!0,value:{message:m.message,name:m.name,stack:m.stack}}:{isError:!1,value:m},[w,[]]},deserialize(m){throw m.isError?Object.assign(new Error(m.value.message),m.value):m.value}}]]);function c(m,w=globalThis,_=["*"]){w.addEventListener("message",(function P(T){if(!T||!T.data)return;if(!(function(k,O){for(const E of k)if(O===E||E==="*"||E instanceof RegExp&&E.test(O))return!0;return!1})(_,T.origin))return void console.warn(`Invalid origin '${T.origin}' for comlink proxy`);const{id:S,type:L,path:N}=Object.assign({path:[]},T.data),D=(T.data.argumentList||[]).map(v);let F;try{const k=N.slice(0,-1).reduce(((E,B)=>E[B]),m),O=N.reduce(((E,B)=>E[B]),m);switch(L){case"GET":F=O;break;case"SET":k[N.slice(-1)[0]]=v(T.data.value),F=!0;break;case"APPLY":F=O.apply(k,D);break;case"CONSTRUCT":F=(function(E){return Object.assign(E,{[n]:!0})})(new O(...D));break;case"ENDPOINT":{const{port1:E,port2:B}=new MessageChannel;c(m,B),F=C(E,[E])}break;case"RELEASE":F=void 0;break;default:return}}catch(k){F={value:k,[o]:0}}Promise.resolve(F).catch((k=>({value:k,[o]:0}))).then((k=>{const[O,E]=y(k);w.postMessage(Object.assign(Object.assign({},O),{id:S}),E),L==="RELEASE"&&(w.removeEventListener("message",P),l(w),i in m&&typeof m[i]=="function"&&m[i]())})).catch((k=>{const[O,E]=y({value:new TypeError("Unserializable return value"),[o]:0});w.postMessage(Object.assign(Object.assign({},O),{id:S}),E)}))})),w.start&&w.start()}function l(m){(function(w){return w.constructor.name==="MessagePort"})(m)&&m.close()}function u(m){if(m)throw new Error("Proxy has been released and is not useable")}function d(m){return b(m,new Map,{type:"RELEASE"}).then((()=>{l(m)}))}const g=new WeakMap,h="FinalizationRegistry"in globalThis&&new FinalizationRegistry((m=>{const w=(g.get(m)||0)-1;g.set(m,w),w===0&&d(m)}));function p(m,w,_=[],P=function(){}){let T=!1;const S=new Proxy(P,{get(L,N){if(u(T),N===e)return()=>{(function(D){h&&h.unregister(D)})(S),d(m),w.clear(),T=!0};if(N==="then"){if(_.length===0)return{then:()=>S};const D=b(m,w,{type:"GET",path:_.map((F=>F.toString()))}).then(v);return D.then.bind(D)}return p(m,w,[..._,N])},set(L,N,D){u(T);const[F,k]=y(D);return b(m,w,{type:"SET",path:[..._,N].map((O=>O.toString())),value:F},k).then(v)},apply(L,N,D){u(T);const F=_[_.length-1];if(F===t)return b(m,w,{type:"ENDPOINT"}).then(v);if(F==="bind")return p(m,w,_.slice(0,-1));const[k,O]=A(D);return b(m,w,{type:"APPLY",path:_.map((E=>E.toString())),argumentList:k},O).then(v)},construct(L,N){u(T);const[D,F]=A(N);return b(m,w,{type:"CONSTRUCT",path:_.map((k=>k.toString())),argumentList:D},F).then(v)}});return(function(L,N){const D=(g.get(N)||0)+1;g.set(N,D),h&&h.register(L,N,L)})(S,m),S}function A(m){const w=m.map(y);return[w.map((P=>P[0])),(_=w.map((P=>P[1])),Array.prototype.concat.apply([],_))];var _}const f=new WeakMap;function C(m,w){return f.set(m,w),m}function y(m){for(const[w,_]of a)if(_.canHandle(m)){const[P,T]=_.serialize(m);return[{type:"HANDLER",name:w,value:P},T]}return[{type:"RAW",value:m},f.get(m)||[]]}function v(m){switch(m.type){case"HANDLER":return a.get(m.name).deserialize(m.value);case"RAW":return m.value}}function b(m,w,_,P){return new Promise((T=>{const S=new Array(4).fill(0).map((()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16))).join("-");w.set(S,T),m.start&&m.start(),m.postMessage(Object.assign({id:S},_),P)}))}const x=6371e3;function I(m){return m/180*Math.PI}const Q=6370972;function R(m,w){return(function(_,P,T=x){const S=T,L=I(_[1]),N=I(_[0]),D=I(P[1]),F=D-L,k=I(P[0])-N,O=Math.sin(F/2)*Math.sin(F/2)+Math.cos(L)*Math.cos(D)*Math.sin(k/2)*Math.sin(k/2);return S*(2*Math.atan2(Math.sqrt(O),Math.sqrt(1-O)))})(m,w,Q)}const M={NEAREST:"NEAREST",LINEAR:"LINEAR",CUBIC:"CUBIC"},z={VECTOR:"VECTOR"};function j(m){return m%1}function X(m,w){return m.map(((_,P)=>m[P]+w[P]))}function Z(m,w){return m.map(((_,P)=>m[P]*w))}function W(m,w){return m.map(((_,P)=>m[P]*w[P])).reduce(((_,P)=>_+P))}function gt(m,w,_){return m===w?m:m*(1-_)+w*_}function yt(m,w,_){return m.map(((P,T)=>gt(m[T],w[T],_)))}function $e(m,w){return w?m[3]>=255:!isNaN(m[0])}function ti(m,w,_){if(w===z.VECTOR){const P=(function(T,S,L){return S===z.VECTOR?L?[gt(L[0],L[1],T[0]/255),gt(L[0],L[1],T[1]/255)]:[T[0],T[1]]:[NaN,NaN]})(m,w,_);return Math.hypot(P[0],P[1])}return(function(P,T,S){return T===z.VECTOR?0:S?gt(S[0],S[1],P[0]/255):P[0]})(m,w,_)}function J(m,w,_,P,T,S){const{data:L,width:N,height:D}=m,F=L.length/(N*D),k=(_+T+.5)/w[0],O=(P+S+.5)/w[1],E=Math.max(0,Math.min(N-1,Math.floor(k*N))),B=Math.max(0,Math.min(D-1,Math.floor(O*D)));return new Array(F).fill(void 0).map(((U,q)=>L[(E+B*N)*F+q]))}const Bt=[3,-6,0,4].map((m=>m/6)),Hi=[-1,6,-12,8].map((m=>m/6));function pe(m){return[m*m*m,m*m,m,1]}function Yt(m,w,_,P,T){const S=X(X(X(Z(m,W(Hi,pe(T+1))),Z(w,W(Bt,pe(T)))),Z(_,W(Bt,pe(1-T)))),Z(P,W(Hi,pe(2-T))));return S[3]=m[3]>0&&w[3]>0&&_[3]>0&&P[3]>0?Math.max(Math.max(Math.max(m[3],w[3]),_[3]),P[3]):0,S}function ei(m,w,_,P,T){return _===M.CUBIC?(function(S,L,N,D){const F=N*L[0]-.5,k=D*L[1]-.5,O=Math.floor(F),E=Math.floor(k),B=j(F),U=j(k);return Yt(Yt(J(S,L,O,E,-1,-1),J(S,L,O,E,0,-1),J(S,L,O,E,1,-1),J(S,L,O,E,2,-1),B),Yt(J(S,L,O,E,-1,0),J(S,L,O,E,0,0),J(S,L,O,E,1,0),J(S,L,O,E,2,0),B),Yt(J(S,L,O,E,-1,1),J(S,L,O,E,0,1),J(S,L,O,E,1,1),J(S,L,O,E,2,1),B),Yt(J(S,L,O,E,-1,2),J(S,L,O,E,0,2),J(S,L,O,E,1,2),J(S,L,O,E,2,2),B),U)})(m,w,P,T):_===M.LINEAR?(function(S,L,N,D){const F=N*L[0]-.5,k=D*L[1]-.5,O=Math.floor(F),E=Math.floor(k),B=j(F),U=j(k);return yt(yt(J(S,L,O,E,0,0),J(S,L,O,E,1,0),B),yt(J(S,L,O,E,0,1),J(S,L,O,E,1,1),B),U)})(m,w,P,T):(function(S,L,N,D){const F=N*L[0]-.5,k=D*L[1]-.5;return J(S,L,Math.round(F),Math.round(k),0,0)})(m,w,P,T)}function $s(m,w,_,P,T,S,L,N){const D=S?L+.5/_[0]:gt(0+.5/_[0],1-.5/_[0],L),F=gt(0+.5/_[1],1-.5/_[1],N);return w&&T>0?yt(ei(m,_,P,D,F),ei(w,_,P,D,F),T):ei(m,_,P,D,F)}function tr(m,w){const{image:_,image2:P,imageSmoothing:T,imageInterpolation:S,imageWeight:L,imageType:N,imageUnscale:D,imageMinValue:F,imageMaxValue:k}=m,{width:O,height:E}=_,B=S!==M.NEAREST?M.NEAREST:S,U=(function(V,et,ht){const mt=1+Math.max(0,ht);return[V/mt,et/mt]})(O,E,T),q=(function(V){return V[2]-V[0]==360})(w),K=new Float32Array(O*E);for(let V=0;V<E;V++)for(let et=0;et<O;et++){const ht=et+V*O,mt=$s(_,P,U,B,L,q,et/O,V/E);if(!$e(mt,D)){K[ht]=NaN;continue}const Ht=ti(mt,N,D);typeof F=="number"&&!isNaN(F)&&Ht<F||typeof k=="number"&&!isNaN(k)&&Ht>k?K[ht]=NaN:K[ht]=Ht}return{data:K,width:O,height:E}}function er(m,w,_){let{data:P,width:T,height:S}=m;const L=1e3*_,N=(function(E,B,U){const q=[U[0],U[3]],K=(U[2]-U[0])/E,V=(U[3]-U[1])/B;return et=>{const[ht,mt]=et;return[q[0]+ht*K,q[1]-mt*V]}})(T,S,w);P=(function(E,B,U){const q=new Float32Array(E.length);for(let K=0;K<U;K++)for(let V=0;V<B;V++){const et=V+K*B;if(V>=1&&V<=B-2&&K>=1&&K<=U-2){const ht=[E[V-1+(K-1)*B],E[V+(K-1)*B],E[V+1+(K-1)*B],E[V-1+K*B],E[V+K*B],E[V+1+K*B],E[V-1+(K+1)*B],E[V+(K+1)*B],E[V+1+(K-1)*B]];q[et]=ht.reduce(((mt,Ht)=>mt+Ht),0)/ht.length}else q[et]=E[et]}return q})(P,T,S);let D=[],F=[];for(let E=1;E<S-1;E++)for(let B=1;B<T-1;B++){const U=P[B+E*T];if(!isNaN(U)&&U>=P[B+1+E*T]&&U>=P[B+1+(E+1)*T]&&U>=P[B+(E+1)*T]&&U>=P[B-1+(E+1)*T]&&U>P[B-1+E*T]&&U>P[B-1+(E-1)*T]&&U>P[B+(E-1)*T]&&U>P[B+1+(E-1)*T]){const q=N([B,E]);D.push({position:q,value:U})}if(!isNaN(U)&&U<=P[B+1+E*T]&&U<=P[B+1+(E+1)*T]&&U<=P[B+(E+1)*T]&&U<=P[B-1+(E+1)*T]&&U<P[B-1+E*T]&&U<P[B-1+(E-1)*T]&&U<P[B+(E-1)*T]&&U<P[B+1+(E-1)*T]){const q=N([B,E]);F.push({position:q,value:U})}}D=D.sort(((E,B)=>B.value-E.value)),F=F.sort(((E,B)=>E.value-B.value));const k=[...D];for(let E=0;E<k.length;E++){const B=k[E];if(B)for(let U=E+1;U<k.length;U++){const q=k[U];q&&R(B.position,q.position)<L&&(k[U]=void 0)}}D=k.filter((E=>!!E));const O=[...F];for(let E=0;E<O.length;E++){const B=O[E];if(B)for(let U=E+1;U<O.length;U++){const q=O[U];q&&R(B.position,q.position)<L&&(O[U]=void 0)}}return F=O.filter((E=>!!E)),new Float32Array([D.length,...D.map((E=>[...E.position,E.value])).flat(),F.length,...F.map((E=>[...E.position,E.value])).flat()])}c({getHighLowPointData(m,w,_,P,T,S,L,N,D,F,k,O,E,B,U){const q=(function(K,V,et){return er(tr(K,V),V,et)})({image:{data:m,width:w,height:_},image2:P?{data:P,width:T,height:S}:null,imageSmoothing:L,imageInterpolation:N,imageWeight:D,imageType:F,imageUnscale:k,imageMinValue:O,imageMaxValue:E},B,U);return C(q,[q.buffer])}})},xo.toString().replace(/^function.+?{/,"").slice(0,-1)));var xo,Au=Fl(pu);const Ui={LOW:"L",HIGH:"H"},mu=xs(Au());function wo(n,t){return{type:"Feature",geometry:{type:"Point",coordinates:n},properties:t}}async function vu(n,t,e){const{image:i,image2:o,imageSmoothing:s,imageInterpolation:r,imageWeight:a,imageType:c,imageUnscale:l,imageMinValue:u,imageMaxValue:d}=n,{data:g,width:h,height:p}=i,{data:A=null,width:f=null,height:C=null}=o||{},y=g.slice(0),v=A?A.slice(0):null;return{type:"FeatureCollection",features:(function(x){let I=0;const Q=[],R=x[I++];for(let z=0;z<R;z++){const j=[x[I++],x[I++]],X=x[I++];Q.push(wo(j,{type:Ui.HIGH,value:X}))}const M=x[I++];for(let z=0;z<M;z++){const j=[x[I++],x[I++]],X=x[I++];Q.push(wo(j,{type:Ui.LOW,value:X}))}return Q})(await mu.getHighLowPointData(Li(y,[y.buffer]),h,p,v?Li(v,[v.buffer]):null,f,C,s,r,a,c,l,u,d,t,e))}}const Po="high-low-label";function To(n,t,e){return n.properties.type===Ui.HIGH?Math.round((n.properties.value-e)/e*100):Math.round((t-n.properties.value)/t*100)}const se={image:{type:"object",value:null},image2:{type:"object",value:null},imageSmoothing:{type:"number",value:0},imageInterpolation:{type:"object",value:ut.CUBIC},imageWeight:{type:"number",value:0},imageType:{type:"object",value:tt.SCALAR},imageUnscale:{type:"array",value:null},imageMinValue:{type:"object",value:null},imageMaxValue:{type:"object",value:null},bounds:{type:"array",value:[-180,-90,180,90],compare:!0},minZoom:{type:"object",value:null},maxZoom:{type:"object",value:null},radius:{type:"number",value:0},unitFormat:{type:"object",value:null},textFormatFunction:{type:"function",value:Ms},textFontFamily:{type:"object",value:Ji},textSize:{type:"number",value:12},textColor:{type:"color",value:qi},textOutlineWidth:{type:"number",value:1},textOutlineColor:{type:"color",value:Ki},palette:{type:"object",value:null}};class Ze extends dt{renderLayers(){const{viewport:t}=this.context,{props:e,visiblePoints:i,minValue:o,maxValue:s}=this.state;if(!e||!i||typeof o!="number"||typeof s!="number")return[];const{unitFormat:r,textFormatFunction:a,textFontFamily:c,textSize:l,textColor:u,textOutlineWidth:d,textOutlineColor:g}=G(e,se),{paletteScale:h}=this.state;return[new Vt(this.getSubLayerProps({id:"type",data:i,getPixelOffset:[0,-Kn(t,1.2*l/2)],getPosition:p=>p.geometry.coordinates,getText:p=>p.properties.type,getSize:1.2*l,getColor:p=>h?We(h(p.properties.value).rgba()):u,getAngle:xt(t,0),outlineWidth:d,outlineColor:g,fontFamily:c,fontSettings:{sdf:!0},billboard:!1,extensions:[new bi],collisionEnabled:!0,collisionGroup:Po,collisionTestProps:{sizeScale:5},getCollisionPriority:p=>To(p,o,s),parameters:{cullMode:"front",depthCompare:"always",...this.props.parameters}})),new Vt(this.getSubLayerProps({id:"value",data:i,getPixelOffset:[0,Kn(t,1.2*l/2)],getPosition:p=>p.geometry.coordinates,getText:p=>a(p.properties.value,r),getSize:l,getColor:p=>h?We(h(p.properties.value).rgba()):u,getAngle:xt(t,0),outlineWidth:d,outlineColor:g,fontFamily:c,fontSettings:{sdf:!0},billboard:!1,extensions:[new bi],collisionEnabled:!0,collisionGroup:Po,collisionTestProps:{sizeScale:5},getCollisionPriority:p=>To(p,o,s),parameters:{cullMode:"front",depthCompare:"always",...this.props.parameters}}))]}shouldUpdateState(t){return super.shouldUpdateState(t)||t.changeFlags.viewportChanged}updateState(t){const{image:e,image2:i,imageSmoothing:o,imageInterpolation:s,imageWeight:r,imageType:a,imageUnscale:c,imageMinValue:l,imageMaxValue:u,minZoom:d,maxZoom:g,radius:h,unitFormat:p,textFormatFunction:A,textFontFamily:f,textSize:C,textColor:y,textOutlineWidth:v,textOutlineColor:b,palette:x,visible:I}=t.props;super.updateState(t),h&&I?(e===t.oldProps.image&&i===t.oldProps.image2&&o===t.oldProps.imageSmoothing&&s===t.oldProps.imageInterpolation&&r===t.oldProps.imageWeight&&a===t.oldProps.imageType&&c===t.oldProps.imageUnscale&&l===t.oldProps.imageMinValue&&u===t.oldProps.imageMaxValue&&h===t.oldProps.radius&&I===t.oldProps.visible||this._updateFeatures(),(d!==t.oldProps.minZoom||g!==t.oldProps.maxZoom||t.changeFlags.viewportChanged)&&this._updateVisibleFeatures(),x!==t.oldProps.palette&&this._updatePalette(),p===t.oldProps.unitFormat&&A===t.oldProps.textFormatFunction&&f===t.oldProps.textFontFamily&&C===t.oldProps.textSize&&y===t.oldProps.textColor&&v===t.oldProps.textOutlineWidth&&b===t.oldProps.textOutlineColor||this._redrawVisibleFeatures(),this.setState({props:t.props})):this.setState({points:void 0,visiblePoints:void 0,minValue:void 0,maxValue:void 0})}async _updateFeatures(){const{image:t,image2:e,imageSmoothing:i,imageInterpolation:o,imageType:s,imageUnscale:r,imageMinValue:a,imageMaxValue:c,imageWeight:l,bounds:u,radius:d}=G(this.props,se);if(!t)return;const g=Xs();this.state.requestId=g;const h={image:t,image2:e,imageSmoothing:i,imageInterpolation:o,imageWeight:l,imageType:s,imageUnscale:r,imageMinValue:a,imageMaxValue:c},p=(await vu(h,u,d)).features;if(this.state.requestId!==g)return;const A=p.map((y=>y.properties.value)),f=Math.min(...A),C=Math.max(...A);this.setState({points:p,minValue:f,maxValue:C}),this._updateVisibleFeatures()}_updateVisibleFeatures(){const{viewport:t}=this.context,{minZoom:e,maxZoom:i}=G(this.props,se),{points:o}=this.state;if(!o)return;let s;s=Xt(t,e,i)?o:[],this.setState({visiblePoints:s})}_updatePalette(){const{palette:t}=G(this.props,se);if(!t)return this.setState({paletteScale:void 0}),void this._redrawVisibleFeatures();const e=Jt(t);this.setState({paletteScale:e}),this._redrawVisibleFeatures()}_redrawVisibleFeatures(){this.setState({visiblePoints:Array.isArray(this.state.visiblePoints)?Array.from(this.state.visiblePoints):this.state.visiblePoints})}}Ze.layerName="HighLowCompositeLayer",Ze.defaultProps=se;const Cu={...Ze.defaultProps};class Bo extends dt{renderLayers(){const{props:t}=this.state;return t?[new Ze(this.props,this.getSubLayerProps({id:"composite"}))]:[]}updateState(t){const{image:e,imageUnscale:i}=t.props;if(super.updateState(t),e&&i&&!(e.data instanceof Uint8Array||e.data instanceof Uint8ClampedArray))throw new Error("imageUnscale can be applied to Uint8 data only");this.setState({props:t.props})}}Bo.layerName="HighLowLayer",Bo.defaultProps=Cu;const ot={COLD:"COLD",WARM:"WARM",OCCLUDED:"OCCLUDED",STATIONARY:"STATIONARY"},_o={iconAtlas:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGoAAAAqCAYAAABbec77AAAFsmlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS41LjAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIgogICAgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIgogICAgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIgogICAgeG1sbnM6ZXhpZj0iaHR0cDovL25zLmFkb2JlLmNvbS9leGlmLzEuMC8iCiAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyIKICAgIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIgogICAgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIKICAgeG1wOkNyZWF0ZURhdGU9IjIwMjMtMDMtMTBUMTQ6NDI6NTYrMDEwMCIKICAgeG1wOk1vZGlmeURhdGU9IjIwMjMtMDMtMjVUMDk6MDY6NTgrMDE6MDAiCiAgIHhtcDpNZXRhZGF0YURhdGU9IjIwMjMtMDMtMjVUMDk6MDY6NTgrMDE6MDAiCiAgIHBob3Rvc2hvcDpEYXRlQ3JlYXRlZD0iMjAyMy0wMy0xMFQxNDo0Mjo1NiswMTAwIgogICBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIgogICBwaG90b3Nob3A6SUNDUHJvZmlsZT0ic1JHQiBJRUM2MTk2Ni0yLjEi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",iconMapping:{COLD:{x:2,y:2,width:50,height:38,anchorY:35,mask:!0},WARM:{x:54,y:2,width:50,height:38,anchorY:35,mask:!0}}};function Ys(n,t){for(let e=n.length-1;e>=0;e--)if(t.call(n,n[e],e,n))return e;return-1}const Oe={data:{type:"array",value:[]},minZoom:{type:"object",value:null},maxZoom:{type:"object",value:null},getType:{type:"function",value:null},getPath:{type:"function",value:null},width:{type:"number",value:2},coldColor:{type:"color",value:[0,0,255]},warmColor:{type:"color",value:[255,0,0]},occludedColor:{type:"color",value:[148,0,211]},iconSize:{type:"number",value:15},_debug:{type:"boolean",value:!1}};class Je extends dt{renderLayers(){const{viewport:t}=this.context,{props:e,visibleFrontLines:i,visibleDebugFrontPoints:o}=this.state;if(!e||!i||!o)return[];const{getType:s,getPath:r,width:a,coldColor:c,warmColor:l,occludedColor:u,iconSize:d,_debug:g}=G(e,Oe);if(!s||!r)return[];const{iconStyle:h,iconAtlasTexture:p}=this.state;if(!h||!p)return[];const A={[ot.COLD]:c,[ot.WARM]:l,[ot.OCCLUDED]:u,[ot.STATIONARY]:c};return[new De(this.getSubLayerProps({id:"path",data:i,getPath:f=>[f.startPosition,...f.icons.map((C=>C.position)),f.endPosition],getColor:f=>A[s(f.d)],getWidth:a,widthUnits:"pixels"})),new De(this.getSubLayerProps({id:"path-stationary-warm",data:i.filter((f=>s(f.d)===ot.STATIONARY)),getPath:f=>[f.startPosition,...f.icons.map((C=>C.position)),f.endPosition],getColor:l,getWidth:a,widthUnits:"pixels",extensions:[new pr({dash:!0,highPrecisionDash:!0})],getDashArray:[45,45]})),new de(this.getSubLayerProps({id:"icon",data:i.flatMap((f=>f.icons)),getPosition:f=>f.position,getIcon:f=>s(f.d)===ot.OCCLUDED||s(f.d)===ot.STATIONARY?f.alternate?ot.COLD:ot.WARM:s(f.d),getSize:d,getColor:f=>s(f.d)===ot.STATIONARY?f.alternate?A[ot.COLD]:A[ot.WARM]:A[s(f.d)],getAngle:f=>s(f.d)===ot.STATIONARY?f.alternate?xt(t,f.direction):xt(t,f.direction+180):xt(t,f.direction),iconAtlas:p,iconMapping:h.iconMapping,billboard:!1,extensions:[new bi],collisionEnabled:!0,collisionGroup:"front-icon",collisionTestProps:{sizeScale:5},getCollisionPriority:f=>f.priority})),...g?[new Vt(this.getSubLayerProps({id:"text",data:o,getPosition:f=>f.position,getText:f=>`${f.index}`,getSize:12,getColor:qi,getAngle:xt(t,0),outlineWidth:1,outlineColor:Ki,fontFamily:Ji,fontSettings:{sdf:!0},billboard:!1}))]:[]]}shouldUpdateState(t){return super.shouldUpdateState(t)||t.changeFlags.viewportChanged}updateState(t){const{data:e,getType:i,getPath:o,minZoom:s,maxZoom:r}=t.props;super.updateState(t),e&&i&&o?(this.state.iconStyle||this._updateIconStyle(),e===t.oldProps.data&&o===t.oldProps.getPath||this._updateFeatures(),(s!==t.oldProps.minZoom||r!==t.oldProps.maxZoom||t.changeFlags.viewportChanged)&&this._updateVisibleFeatures(),this.setState({props:t.props})):this.setState({features:void 0,debugFeatures:void 0,visibleFeatures:void 0,visibleDebugFeatures:void 0})}async _updateIconStyle(){const{device:t}=this.context;this.setState({iconStyle:_o});const e=Tt(t,await Os(_o.iconAtlas));this.setState({iconAtlasTexture:e})}_updateFeatures(){const{data:t,getPath:e}=G(this.props,Oe);if(!e)return;const i=t.map((s=>(function(r,a){const c=a,l=c.slice(0,-1).map(((g,h)=>ct(c[h],c[h+1]))).reduce(((g,h)=>[...g,g[g.length-1]+h]),[0]);let u=[];for(let g=1,h=l[l.length-1]/3;h>5e3;g++,h/=3){const p=3**g;for(let A=1;A<p;A++){if(g>1&&A%3==0)continue;const f=A*h,C=Ys(l,(z=>z<=f));if(C===-1||C===c.length-1)throw new Error("Invalid state");const y=C+1,v=c[C],b=c[y],x=l[C],I=bl(v,b),Q=su(v,f-x,I),R=90-I,M=100-g;u.push({distance:f,position:Q,direction:R,priority:M})}}u=u.sort(((g,h)=>g.distance-h.distance));const d=u.map(((g,h)=>({d:r,...g,alternate:h%2==0})));return{d:r,startPosition:a[0],endPosition:a[a.length-1],icons:d}})(s,e(s)))),o=t.flatMap((s=>e(s).map(((r,a)=>({d:s,position:r,index:a})))));this.setState({frontLines:i,debugFrontPoints:o}),this._updateVisibleFeatures()}_updateVisibleFeatures(){const{viewport:t}=this.context,{minZoom:e,maxZoom:i}=G(this.props,Oe),{frontLines:o,debugFrontPoints:s}=this.state;if(!o||!s)return;let r,a;Xt(t,e,i)?(r=o,a=s):(r=[],a=[]),this.setState({visibleFrontLines:r,visibleDebugFrontPoints:a})}}Je.layerName="FrontCompositeLayer",Je.defaultProps=Oe;const yu={...Je.defaultProps};class So extends dt{renderLayers(){return[new Je(this.props,this.getSubLayerProps({id:"composite"}))]}}So.layerName="FrontLayer",So.defaultProps=yu;const Eu=new Map,bu=new Map;function Iu(n,t=0){let e;if(lt(n))e=(function(i,o,s){s=Math.min(Math.max(s-2,0),7);const a=Eu.get(s)??(()=>{const{uv:u}=Nl(s,!0),d=[];for(let g=0;g<u.length;g+=2){const h=u[g],p=u[g+1];if(h===0||p<=0||p>=1)continue;const A=360*h-180,f=180*p-90;d.push([A,f])}return d.push([0,-90]),d.push([0,90]),d})(),c=bu.get(s)??(()=>{const u=new ji(a.length,void 0,Float32Array);for(let d=0;d<a.length;d++){const g=a[d];u.add(g[0],g[1])}return u.finish(),u})();return Gl(c,i[0],i[1],void 0,o/1e3).map((u=>a[u]))})(Xi(n),Js(n),Math.floor(ce(n)+t+1));else{if(!Zs(n))throw new Error("Invalid state");e=(function(i,o){const s=new kl({size:1,antimeridian:!0}),r=[...s.px([i[0],i[1]],o),...s.px([i[2],i[3]],o)];[r[1],r[3]]=[r[3],r[1]];const a=2**o,c=r[2]-r[0]+1,l=r[3]-r[1]+1,u=[];for(let d=0;d<l;d++)for(let g=0;g<c;g++){const h=r[0]+g,p=[h,r[1]+d+(h%2==1?.5:0)];if(p[0]===0||p[1]<=0||p[1]>=a)continue;const A=s.ll([p[0],p[1]],o);A[0]=Oi(A[0]),u.push(A)}return u})(qs(n),Math.floor(ce(n)+t))}return e}const Di={VALUE:"VALUE",ARROW:"ARROW",WIND_BARB:"WIND_BARB"},Lo=new Map([[Di.ARROW,{iconAtlas:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAFtGlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS41LjAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIgogICAgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIgogICAgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIgogICAgeG1sbnM6ZXhpZj0iaHR0cDovL25zLmFkb2JlLmNvbS9leGlmLzEuMC8iCiAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyIKICAgIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIgogICAgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIKICAgeG1wOkNyZWF0ZURhdGU9IjIwMjMtMDMtMTBUMTQ6NDE6MjYrMDEwMCIKICAgeG1wOk1vZGlmeURhdGU9IjIwMjQtMDItMTFUMjM6Mzc6NTErMDE6MDAiCiAgIHhtcDpNZXRhZGF0YURhdGU9IjIwMjQtMDItMTFUMjM6Mzc6NTErMDE6MDAiCiAgIHBob3Rvc2hvcDpEYXRlQ3JlYXRlZD0iMjAyMy0wMy0xMFQxNDo0MToyNiswMTAwIgogICBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIgogICBwaG90b3Nob3A6SUNDUHJvZmlsZT0ic1JHQiBJRUM2MTk2Ni0yLjEi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",iconMapping:{0:{x:0,y:0,width:100,height:100,mask:!0}}}],[Di.WIND_BARB,{iconAtlas:"data:image/png;base64,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YOCvs1WZAAECBAgQIECAAAECBAhsJmDg34zehQkQIECAAAECBAgQIECAQJ2Agb/OVmUCBAgQIECAAAECBAgQILCZgIF/M3oXJkCAAAECBAgQIECAAAECdQIG/jpblQkQIECAAAECBAgQIECAwGYCBv7N6F2YAAECBAgQIECAAAECBAjUCRj462xVJkCAAAECBAgQIECAAAECmwkY+Dejd2ECBAgQIECAAAECBAgQIFAnYOCvs1WZAAECBAgQIECAAAECBAhsJmDg34zehQkQIECAAAECBAgQIECAQJ2Agb/OVmUCBAgQIECAAAECBAgQILCZgIF/M3oXJkCAAAECBAgQIECAAAECdQIG/jpblQkQIECAAAECBAgQIECAwGYCBv7N6F2YAAECBAgQIECAAAECBAjUCRj462xVJkCAAAECBAgQIECAAAECmwkY+Dejd2ECBAgQIECAAAECBAgQIFAnYOCvs1WZAAECBAgQIECAAAECBAhsJmDg34zehQkQIECAAAECBAgQIECAQJ2Agb/OVmUCBAgQIECAAAECBAgQILCZgIF/M3oXJkCAAAECBAgQIECAAAECdQIG/jpblQkQIECAAAECBAgQIECAwGYCBv7N6F2YAAECBAgQIECAAAECBAjUCRj462xVJkCAAAECBAgQIECAAAECmwkY+Dejd2ECBAgQIECAAAECBAgQIFAnYOCvs1WZAAECBAgQIECAAAECBAhsJmDg34zehQkQIECAAAECBAgQIECAQJ2Agb/OVmUCBAgQIECAAAECBAgQILCZgIF/M3oXJkCAAAECBAgQIECAAAECdQIG/jpblQkQIECAAAECBAgQIECAwGYCBv7N6F2YAAECBAgQIECAAAECBAjUCRj462xVJkCAAAECBAgQIECAAAECmwkY+Dejd2ECBAgQIECAAAECBAgQIFAnYOCvs1WZAAECBAgQIECAAAECBAhsJmDg34zehQkQIECAAAECBAgQIECAQJ2Agb/OVmUCBAgQIECAAAECBAgQILCZgIF/M3oXJkCAAAECBAgQIECAAAECdQIG/jpblQkQIECAAAECBAgQIECAwGYCBv7N6F2YAAECBAgQIECAAAECBAjUCRj462xVJkCAAAECBAgQIECAAAECmwkY+Dejd2ECBAgQIECAAAECBAgQIFAnYOCvs1WZAAECBAgQIECAAAECBAhsJmDg34zehQkQIECAAAECBAgQIECAQJ2Agb/OVmUCBAgQIECAAAECBAgQILCZgIF/M3oXJkCAAAECBAgQIECAAAECdQIG/jpblQkQIECAAAECBAgQIECAwGYCBv7N6F2YAAECBAgQIECAAAECBAjUCRj462xVJkCAAAECBAgQIECAAAECmwkY+Dejd2ECBAgQIECAAAECBAgQIFAnYOCvs1WZAAECBAgQIECAAAECBAhsJmDg34zehQkQIECAAAECBAgQIECAQJ2Agb/OVmUCBAgQIECAAAECBAgQILCZgIF/M3oXJkCAAAECBAgQIECAAAECdQIG/jpblQkQIECAAAECBAgQIECAwGYCBv7N6F2YAAECBAgQIECAAAECBAjUCRj462xVJkCAAAECBAgQIECAAAECmwkY+Dejd2ECBAgQIECAAAECBAgQIFAnYOCvs1WZAAECBAgQIECAAAECBAhsJmDg34zehQkQIECAAAECBAgQIECAQJ2Agb/OVmUCBAgQIECAAAECBAgQILCZgIF/M3oXJkCAAAECBAgQIECAAAECdQIG/jpblQkQIECAAAECBAgQIECAwGYCBv7N6F2YAAECBAgQIECAAAECBAjUCRj462xVJkCAAAECBAgQIECAAAECmwkY+Dejd2ECBAgQIECAAAECBAgQIFAnYOCvs1WZAAECBAgQIECAAAECBAhsJmDg34zehQkQIECAAAECBAgQIECAQJ2Agb/OVmUCBAgQIECAAAECBAgQILCZgIF/M3oXJkCAAAECBAgQIECAAAECdQIG/jpblQkQIECAAAECBAgQIECAwGYCBv7N6F2YAAECBAgQIECAAAECBAjUCRj462xVJkCAAAECBAgQIECAAAECmwkY+Dejd2ECBAgQIECAAAECBAgQIFAnYODPs/2hiHgur9ziSk9GxMuLX+UFownI6Wgdb3O/ctpm30ZbtZyO1vE29yunbfZttFXLaWHHDfx5uFsFdRryn46It/O2olLHAnLacXM72pqcdtTMjrcipx03t6OtyWlHzex4K3Ja2FwDfx7u2kGdBvxp0Heqn9fDESrJ6Qhdbn+Pctp+D0fYgZyO0OX29yin7fdwhB3IaWGXDfx5uGsG1al+Xt9GqySno3W8zf3KaZt9G23Vcjpax9vcr5y22bfRVi2nhR038OfhrhFUp/p5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AQIECBBIEDDwJyAa+PMQVSoXODRInbqoU/3ylrjAAQEDv1gQIECAAAECBBIEDPwJiAb+PESVygXmDvxO9ctb4QInBAz84kGAAAECBAgQSBAw8CcgGvjzEFUqF5gz8DvVL2+DC5wRMPCLCAECBAgQIEAgQcDAn4Bo4M9DVKlc4NTA71S/nN8FZgoY+GdCeRoBAgQIECBA4JSAgT8vH96g5lmqVCdwbOB3ql9nrvJyAffT5WZeQYAAAQIECBD4gICBPy8U3qDmWapUJ3Aop69GxGN1l1SZwGIB99PFZF5AgAABAgQIEPiggIE/LxXeoOZZqlQnIKd1tirnCchpnqVKBAgQIECAwMACBv685nuDmmepUp2AnNbZqpwnIKd5lioRIECAAAECAwsY+POa7w1qnqVKdQJyWmercp6AnOZZqkSAAAECBAgMLGDgz2u+N6h5lirVCchpna3KeQJymmepEgECBAgQIDCwgIE/r/neoOZZqlQnIKd1tirnCchpnqVKBAgQIECAwMACBv685nuDmmepUp2AnNbZqpwnIKd5lioRIECAAAECAwsY+POa7w1qnqVKdQJyWmercp6AnOZZqkSAAAECBAgMLGDgz2u+N6h5lirVCchpna3KeQJymmepEgECBAgQIDCwgIE/r/neoOZZqlQnIKd1tirnCchpnqVKBAgQIECAwMACBv685nuDmmepUp2AnNbZqpwnIKd5lioRIECAAAECAwsY+POa7w1qnqVKdQJyWmercp6AnOZZqkSAAAECBAgMLGDgz2u+N6h5lirVCchpna3KeQJymmepEgECBAgQIDCwgIE/r/neoOZZqlQnIKd1tirnCchpnqVKBAgQIECAwMACBv685nuDmmepUp2AnNbZqpwnIKd5lioRIECAAAECAwsY+Aduvq0TIECAAAECBAgQIECAQL8CBv5+e2tnBAgQIECAAAECBAgQIDCwgIF/4ObbOgECBAgQIECAAAECBAj0K2Dg77e3dkaAAAECBAgQIECAAAECAwsY+Aduvq0TIECAAAECBAgQIECAQL8CBv5+e2tnBAgQIECAAAECBAgQIDCwgIF/4ObbOgECBAgQIECAAAECBAj0K2Dg77e3dkaAAAECBAgQIECAAAECAwsY+Aduvq0TIECAAAECBAgQIECAQL8CBv5+e2tnBAgQIECAAAECBAgQIDCwgIF/4ObbOgECBAgQIECAAAECBAj0K2Dg77e3dkaAAAECBAgQIECAAAECAwsY+Aduvq0TIECAAAECBAgQIECAQL8CBv5+e2tnBAgQIECAAAECBAgQIDCwgIF/4ObbOgECBAgQIECAAAECBAj0K2Dg77e3dkaAAAECBAgQIECAAAECAwsY+Aduvq0TIECAAAECBAgQIECAQL8CBv5+e2tnBAgQIECAAAECBAgQIDCwgIF/4ObbOgECBAgQIECAAAECBAj0K2Dg77e3dkaAAAECBAgQIECAAAECAwsY+Aduvq0TIECAAAECBAgQIECAQL8CBv5+e2tnBAgQIECAAAECBAgQIDCwgIF/4ObbOgECBAgQIECAAAECBAj0K2Dg77e3dkaAAAECBAgQIECAAAECAwsY+Aduvq0TIECAAAECBAgQIECAQL8CBv5+e2tnBAgQIECAAAECBAgQIPD/t1/HBAAAAAjC+re2hyyC8yIsIPjD55tOgAABAgQIECBAgAABAr8Cgv/3W8sIECBAgAABAgQIECBAICwg+MPnm06AAAECBAgQIECAAAECvwKC//dbywgQIECAAAECBAgQIEAgLCD4w+ebToAAAQIECBAgQIAAAQK/AoL/91vLCBAgQIAAAQIECBAgQCAsIPjD55tOgAABAgQIECBAgAABAr8Cgv/3W8sIECBAgAABAgQIECBAICwg+MPnm06AAAECBAgQIECAAAECvwKC//dbywgQIECAAAECBAgQIEAgLCD4w+ebToAAAQIECBAgQIAAAQK/AgOYR34g/YMI8gAAAABJRU5ErkJggg==",iconMapping:{0:{x:0,y:0,width:170,height:170,anchorX:85,anchorY:133,mask:!0},1:{x:170,y:0,width:170,height:170,anchorX:85,anchorY:133,mask:!0},2:{x:340,y:0,width:170,height:170,anchorX:85,anchorY:133,mask:!0},3:{x:510,y:0,width:170,height:170,anchorX:85,anchorY:133,mask:!0},4:{x:680,y:0,width:170,height:170,anchorX:85,anchorY:133,mask:!0},5:{x:850,y:0,width:170,height:170,anchorX:85,anchorY:133,mask:!0},6:{x:0,y:170,width:170,height:170,anchorX:85,anchorY:133,mask:!0},7:{x:170,y:170,width:170,height:170,anchorX:85,anchorY:133,mask:!0},8:{x:340,y:170,width:170,height:170,anchorX:85,anchorY:133,mask:!0},9:{x:510,y:170,width:170,height:170,anchorX:85,anchorY:133,mask:!0},10:{x:680,y:170,width:170,height:170,anchorX:85,anchorY:133,mask:!0},11:{x:850,y:170,width:170,height:170,anchorX:85,anchorY:133,mask:!0},12:{x:0,y:340,width:170,height:170,anchorX:85,anchorY:133,mask:!0},13:{x:170,y:340,width:170,height:170,anchorX:85,anchorY:133,mask:!0},14:{x:340,y:340,width:170,height:170,anchorX:85,anchorY:133,mask:!0},15:{x:510,y:340,width:170,height:170,anchorX:85,anchorY:133,mask:!0},16:{x:680,y:340,width:170,height:170,anchorX:85,anchorY:133,mask:!0},17:{x:850,y:340,width:170,height:170,anchorX:85,anchorY:133,mask:!0},18:{x:0,y:510,width:170,height:170,anchorX:85,anchorY:133,mask:!0},19:{x:170,y:510,width:170,height:170,anchorX:85,anchorY:133,mask:!0},20:{x:340,y:510,width:170,height:170,anchorX:85,anchorY:133,mask:!0}},iconBounds:[0,51.444]}]]),_t={image:{type:"object",value:null},image2:{type:"object",value:null},imageSmoothing:{type:"number",value:0},imageInterpolation:{type:"object",value:ut.CUBIC},imageWeight:{type:"number",value:0},imageType:{type:"object",value:tt.SCALAR},imageUnscale:{type:"array",value:null},imageMinValue:{type:"object",value:null},imageMaxValue:{type:"object",value:null},bounds:{type:"array",value:[-180,-90,180,90],compare:!0},minZoom:{type:"object",value:null},maxZoom:{type:"object",value:null},style:{type:"object",value:Di.VALUE},density:{type:"number",value:0},unitFormat:{type:"object",value:null},textFormatFunction:{type:"function",value:Ms},textFontFamily:{type:"object",value:Ji},textSize:{type:"number",value:12},textColor:{type:"color",value:qi},textOutlineWidth:{type:"number",value:1},textOutlineColor:{type:"color",value:Ki},iconBounds:{type:"array",value:null},iconSize:{type:"object",value:40},iconColor:{type:"color",value:Xl},palette:{type:"object",value:null}};class qe extends dt{renderLayers(){const{viewport:t}=this.context,{props:e,visiblePoints:i}=this.state;if(!e||!i)return[];const{style:o,unitFormat:s,textFormatFunction:r,textFontFamily:a,textSize:c,textColor:l,textOutlineWidth:u,textOutlineColor:d,iconSize:g,iconColor:h}=G(e,_t),{paletteScale:p}=this.state;if(Lo.has(o)){const{iconStyle:A,iconAtlasTexture:f}=this.state;if(!A||!f)return[];const C=Object.keys(A.iconMapping).length,y=e.iconBounds??A.iconBounds??[0,0],v=y[1]-y[0],b=I=>(I-y[0])/v,x=Array.isArray(g)?g[1]-g[0]:0;return[new de(this.getSubLayerProps({id:"icon",data:i,getPosition:I=>I.geometry.coordinates,getIcon:I=>`${Math.min(Math.max(Math.floor(b(I.properties.value)*C),0),C-1)}`,getSize:I=>Array.isArray(g)?g[0]+b(I.properties.value)*x:g,getColor:I=>p?We(p(I.properties.value).rgba()):h,getAngle:I=>xt(t,I.properties.direction?360-I.properties.direction:0),iconAtlas:f,iconMapping:A.iconMapping,billboard:!1,parameters:{cullMode:"front",depthCompare:"always",...this.props.parameters}}))]}return[new Vt(this.getSubLayerProps({id:"text",data:i,getPosition:A=>A.geometry.coordinates,getText:A=>r(A.properties.value,s),getSize:c,getColor:A=>p?We(p(A.properties.value).rgba()):l,getAngle:xt(t,0),outlineWidth:u,outlineColor:d,fontFamily:a,fontSettings:{sdf:!0},billboard:!1,parameters:{cullMode:"front",depthCompare:"always",...this.props.parameters}}))]}shouldUpdateState(t){return super.shouldUpdateState(t)||t.changeFlags.viewportChanged}initializeState(){this._updatePositions()}updateState(t){const{image:e,image2:i,imageSmoothing:o,imageInterpolation:s,imageWeight:r,imageType:a,imageUnscale:c,imageMinValue:l,imageMaxValue:u,minZoom:d,maxZoom:g,style:h,density:p,unitFormat:A,textFormatFunction:f,textFontFamily:C,textSize:y,textColor:v,textOutlineWidth:b,textOutlineColor:x,iconSize:I,iconColor:Q,palette:R,visible:M}=t.props;super.updateState(t),M?(this.state.iconStyle&&h===t.oldProps.style||this._updateIconStyle(),(p!==t.oldProps.density||t.changeFlags.viewportChanged)&&this._updatePositions(),e===t.oldProps.image&&i===t.oldProps.image2&&o===t.oldProps.imageSmoothing&&s===t.oldProps.imageInterpolation&&r===t.oldProps.imageWeight&&a===t.oldProps.imageType&&c===t.oldProps.imageUnscale&&l===t.oldProps.imageMinValue&&u===t.oldProps.imageMaxValue&&M===t.oldProps.visible||this._updateFeatures(),(d!==t.oldProps.minZoom||g!==t.oldProps.maxZoom||t.changeFlags.viewportChanged)&&this._updateVisibleFeatures(),R!==t.oldProps.palette&&this._updatePalette(),A===t.oldProps.unitFormat&&f===t.oldProps.textFormatFunction&&C===t.oldProps.textFontFamily&&y===t.oldProps.textSize&&v===t.oldProps.textColor&&b===t.oldProps.textOutlineWidth&&x===t.oldProps.textOutlineColor&&I===t.oldProps.iconSize&&Q===t.oldProps.iconColor||this._redrawVisibleFeatures(),this.setState({props:t.props})):this.setState({points:void 0,visiblePoints:void 0})}async _updateIconStyle(){const{device:t}=this.context,{style:e}=G(this.props,_t),i=Lo.get(e);if(!i)return void this.setState({iconStyle:void 0,iconAtlasTexture:void 0});this.setState({iconStyle:i});const o=Tt(t,await Os(i.iconAtlas));this.setState({iconAtlasTexture:o})}_updatePositions(){const{viewport:t}=this.context,{density:e}=G(this.props,_t),i=Iu(t,e+3);this.setState({positions:i}),this._updateFeatures()}_updateFeatures(){const{image:t,image2:e,imageSmoothing:i,imageInterpolation:o,imageWeight:s,imageType:r,imageUnscale:a,imageMinValue:c,imageMaxValue:l,bounds:u}=G(this.props,_t),{positions:d}=this.state;if(!t||!d)return;const g=ou({image:t,image2:e,imageSmoothing:i,imageInterpolation:o,imageWeight:s,imageType:r,imageUnscale:a,imageMinValue:c,imageMaxValue:l},u,d).features.filter((h=>!isNaN(h.properties.value)));this.setState({points:g}),this._updateVisibleFeatures()}_updateVisibleFeatures(){const{viewport:t}=this.context,{minZoom:e,maxZoom:i}=G(this.props,_t),{points:o}=this.state;if(!o)return;let s;s=Xt(t,e,i)?o:[],this.setState({visiblePoints:s})}_updatePalette(){const{palette:t}=G(this.props,_t);if(!t)return this.setState({paletteScale:void 0}),void this._redrawVisibleFeatures();const e=Jt(t);this.setState({paletteScale:e}),this._redrawVisibleFeatures()}_redrawVisibleFeatures(){this.setState({visiblePoints:Array.isArray(this.state.visiblePoints)?Array.from(this.state.visiblePoints):this.state.visiblePoints})}}qe.layerName="GridCompositeLayer",qe.defaultProps=_t;const xu={...qe.defaultProps};class Mo extends dt{renderLayers(){const{props:t}=this.state;return t?[new qe(this.props,this.getSubLayerProps({id:"composite"}))]:[]}updateState(t){const{image:e,imageUnscale:i}=t.props;if(super.updateState(t),e&&i&&!(e.data instanceof Uint8Array||e.data instanceof Uint8ClampedArray))throw new Error("imageUnscale can be applied to Uint8 data only");this.setState({props:t.props})}}Mo.layerName="GridLayer",Mo.defaultProps=xu;const Qo="uniform particleUniforms{float q;vec2 r;float s;vec4 t;float u;float v;float w;float x;float y;float z;}particle;",Oo="q",Ro="r",Fo="s",Uo="t",Do="u",ko="v",No="w",zo="x",Vo="y",Wo="z",Go={name:"particle",vs:Qo,fs:Qo,uniformTypes:{[Oo]:"f32",[Ro]:"vec2<f32>",[Fo]:"f32",[Uo]:"vec4<f32>",[Do]:"f32",[ko]:"f32",[No]:"f32",[zo]:"f32",[Vo]:"f32",[Wo]:"f32"},getUniforms:function(n={}){return{[Oo]:n.viewportGlobe?1:0,[Ro]:n.viewportGlobeCenter??[0,0],[Fo]:n.viewportGlobeRadius??0,[Uo]:n.viewportBounds??[0,0,0,0],[Do]:n.viewportZoomChangeFactor??0,[ko]:n.numParticles,[No]:n.maxAge,[zo]:n.speedFactor,[Vo]:n.time,[Wo]:n.seed}}},mi="sourcePosition",vi="targetPosition",Ci="sourceColor",yi="targetColor",re={imageTexture:{type:"object",value:null},imageTexture2:{type:"object",value:null},imageSmoothing:{type:"number",value:0},imageInterpolation:{type:"object",value:ut.CUBIC},imageWeight:{type:"number",value:0},imageType:{type:"object",value:tt.VECTOR},imageUnscale:{type:"array",value:null},imageMinValue:{type:"object",value:null},imageMaxValue:{type:"object",value:null},bounds:{type:"array",value:[-180,-90,180,90],compare:!0},minZoom:{type:"object",value:null},maxZoom:{type:"object",value:15},palette:{type:"object",value:null},color:{type:"color",value:Ls},numParticles:{type:"number",min:1,max:1e6,value:5e3},maxAge:{type:"number",min:1,max:255,value:10},speedFactor:{type:"number",min:0,max:50,value:1},width:{type:"number",value:1},animate:!0,wrapLongitude:!0};class Ke extends zi{getShaders(){const t=super.getShaders();return{...t,inject:{...t.inject,"vs:#decl":(t.inject?.["vs:#decl"]||"")+`
          in float instanceOpacities;
          out float drop;
          const float DROP_POSITION_Z = -1.;
        `,"vs:#main-start":(t.inject?.["vs:#main-start"]||"")+`
          drop = float(instanceSourcePositions.z == DROP_POSITION_Z || instanceTargetPositions.z == DROP_POSITION_Z);
        `,"vs:DECKGL_FILTER_COLOR":(t.inject?.["vs:DECKGL_FILTER_COLOR"]||"")+`
          color.a = color.a * instanceOpacities;
        `,"fs:#decl":(t.inject?.["fs:#decl"]||"")+`
          in float drop;
        `,"fs:#main-start":(t.inject?.["fs:#main-start"]||"")+`
          if (drop > 0.5) discard;
        `}}}initializeState(){super.initializeState(),this._setupTransformFeedback();const t=this.getAttributeManager();t.remove(["instanceSourcePositions","instanceTargetPositions","instanceColors","instanceWidths"]),t.addInstanced({instanceSourcePositions:{size:3,type:"float32",noAlloc:!0},instanceTargetPositions:{size:3,type:"float32",noAlloc:!0},instanceColors:{size:4,type:"float32",noAlloc:!0},instanceOpacities:{size:1,type:"float32",noAlloc:!0}})}updateState(t){const{imageType:e,numParticles:i,maxAge:o,width:s,palette:r}=t.props;super.updateState(t),e===tt.VECTOR&&i&&o&&s?(e===t.oldProps.imageType&&i===t.oldProps.numParticles&&o===t.oldProps.maxAge&&s===t.oldProps.width||this._setupTransformFeedback(),r!==t.oldProps.palette&&this._updatePalette()):this._deleteTransformFeedback()}finalizeState(t){this._deleteTransformFeedback(),super.finalizeState(t)}draw(t){const{initialized:e}=this.state;if(!e)return;const{viewport:i}=this.context,{model:o}=this.state,{minZoom:s,maxZoom:r,width:a,animate:c}=G(this.props,re),{sourcePositions:l,targetPositions:u,sourceColors:d,opacities:g,transform:h}=this.state;l&&u&&d&&g&&h&&o&&Xt(i,s,r)&&(o.setAttributes({instanceSourcePositions:l,instanceTargetPositions:u,instanceColors:d,instanceOpacities:g}),o.setConstantAttributes({instanceSourcePositions64Low:new Float32Array([0,0,0]),instanceTargetPositions64Low:new Float32Array([0,0,0]),instanceWidths:new Float32Array([a])}),o.setParameters({...o.parameters,cullMode:"front",depthCompare:"always",...this.props.parameters}),super.draw(t),c&&this.step())}_setupTransformFeedback(){const{device:t}=this.context,{initialized:e}=this.state;e&&this._deleteTransformFeedback();const{numParticles:i,maxAge:o}=G(this.props,re),s=i*o,r=i*(o-1),a=t.createBuffer(new Float32Array(3*s)),c=t.createBuffer(new Float32Array(3*s)),l=t.createBuffer(new Float32Array(4*s)),u=t.createBuffer(new Float32Array(4*s)),d=t.createBuffer(new Float32Array(new Array(s).fill(void 0).map(((h,p)=>1-Math.floor(p/i)/o)))),g=new Rt(t,{vs:`#version 300 es
#define SHADER_NAME  particle-line-layer-update-vertex-shader
#ifdef GL_ES
precision highp float;
#endif
vec4 AA(sampler2D AB,vec2 AC,vec2 AD,vec2 AE){vec2 uv=(AD+AE+0.5)/AC;return texture(AB,uv);}const vec4 AF=vec4(3.,-6.,0.,4.)/6.;const vec4 AG=vec4(-1.,6.,-12.,8.)/6.;vec4 AH(float J){return vec4(J*J*J,J*J,J,1.);}vec4 AI(vec4 AJ,vec4 AK,vec4 AL,vec4 AM,float AN){vec4 O=AJ*dot(AG,AH(AN+1.))+AK*dot(AF,AH(AN))+AL*dot(AF,AH(1.-AN))+AM*dot(AG,AH(2.-AN));O.a=(AJ.a>0.&&AK.a>0.&&AL.a>0.&&AM.a>0.)?max(max(max(AJ.a,AK.a),AL.a),AM.a):0.;return O;}vec4 AO(sampler2D AB,vec2 AC,vec2 uv){vec2 AP=uv*AC-0.5;vec2 AD=floor(AP);vec2 AQ=fract(AP);return AI(AI(AA(AB,AC,AD,vec2(-1,-1)),AA(AB,AC,AD,vec2(0,-1)),AA(AB,AC,AD,vec2(1,-1)),AA(AB,AC,AD,vec2(2,-1)),AQ.x),AI(AA(AB,AC,AD,vec2(-1,0)),AA(AB,AC,AD,vec2(0,0)),AA(AB,AC,AD,vec2(1,0)),AA(AB,AC,AD,vec2(2,0)),AQ.x),AI(AA(AB,AC,AD,vec2(-1,1)),AA(AB,AC,AD,vec2(0,1)),AA(AB,AC,AD,vec2(1,1)),AA(AB,AC,AD,vec2(2,1)),AQ.x),AI(AA(AB,AC,AD,vec2(-1,2)),AA(AB,AC,AD,vec2(0,2)),AA(AB,AC,AD,vec2(1,2)),AA(AB,AC,AD,vec2(2,2)),AQ.x),AQ.y);}vec4 AR(sampler2D AB,vec2 AC,vec2 uv){vec2 AP=uv*AC-0.5;vec2 AD=floor(AP);vec2 AQ=fract(AP);return mix(mix(AA(AB,AC,AD,vec2(0,0)),AA(AB,AC,AD,vec2(1,0)),AQ.x),mix(AA(AB,AC,AD,vec2(0,1)),AA(AB,AC,AD,vec2(1,1)),AQ.x),AQ.y);}vec4 AS(sampler2D AB,vec2 AC,vec2 uv){vec2 AP=uv*AC-0.5;vec2 AD=floor(AP+0.5);return AA(AB,AC,AD,vec2(0,0));}vec4 AT(sampler2D AB,vec2 AC,float a,vec2 uv){if(a==2.){return AO(AB,AC,uv);}if(a==1.){return AR(AB,AC,uv);}else{return AS(AB,AC,uv);}}vec4 AU(sampler2D AB,sampler2D AV,vec2 AC,float a,float b,bool B,vec2 uv){vec2 AW;AW.x=B?uv.x+0.5/AC.x:mix(0.+0.5/AC.x,1.-0.5/AC.x,uv.x);AW.y=mix(0.+0.5/AC.y,1.-0.5/AC.y,uv.y);if(b>0.){vec4 AX=AT(AB,AC,a,AW);vec4 AY=AT(AV,AC,a,AW);return mix(AX,AY,b);}else{return AT(AB,AC,a,AW);}}vec4 AZ(sampler2D AB,sampler2D AV,vec2 Y,float Z,float a,float b,bool B,vec2 uv){float Aa=1.+max(0.,Z);vec2 AC=Y/Aa;return AU(AB,AV,AC,a,b,B,uv);}float Ab(float K,float J){return J==0.?sign(K)*F/2.:atan(K,J);}bool Ac(float k){uint Ad=floatBitsToUint(k);return(Ad&0x7fffffffu)>0x7f800000u;}bool Ae(vec4 AX,vec2 d){if(d[0]<d[1]){return AX.a>=1.;}else{return!Ac(AX.x);}}float Af(vec4 AX,float c,vec2 d){if(c==1.){return 0.;}else{if(d[0]<d[1]){return mix(d[0],d[1],AX.x);}else{return AX.x;}}}vec2 Ag(vec4 AX,float c,vec2 d){if(c==1.){if(d[0]<d[1]){return mix(vec2(d[0]),vec2(d[1]),AX.xy);}else{return AX.xy;}}else{return vec2(0.);}}float Ah(vec4 AX,float c,vec2 d){if(c==1.){vec2 k=Ag(AX,c,d);return length(k);}else{return Af(AX,c,d);}}float Ai(vec4 AX,float c,vec2 d){if(c==1.){vec2 k=Ag(AX,c,d);return mod((360.-(Ab(k.y,k.x)/F*180.+180.))-270.,360.)/360.;}else{return 0.;}}in vec3 sourcePosition;in vec4 sourceColor;out vec3 targetPosition;out vec4 targetColor;const float Aj=-1.;const vec4 Ak=vec4(0);const float Al=6370972.;vec2 Am(vec2 An,float Ao,float Ap){float Aq=Ao/Al;float Ar=radians(Ap);float As=radians(An.y);float At=radians(An.x);float Au=sin(As)*cos(Aq)+cos(As)*sin(Aq)*cos(Ar);float Av=asin(Au);float K=sin(Ar)*sin(Aq)*cos(As);float J=cos(Aq)-sin(As)*Au;float Aw=At+Ab(K,J);float Ax=degrees(Av);float Ay=degrees(Aw);return vec2(Ay,Ax);}float Az(float BA){float BB=mod(BA+180.,360.)-180.;return BB;}float Az(float BA,float BC){float BB=Az(BA);if(BB<BC){BB+=360.;}return BB;}float BD(vec2 z){return fract(sin(dot(z.xy,vec2(12.9898,78.233)))*43758.5453);}vec2 BE(vec2 z){return vec2(BD(z+1.3),BD(z+2.1));}vec2 BF(vec2 BG){if(particle.q==1.){BG.x+=0.0001;BG.x=sqrt(BG.x);float Ao=BG.x*particle.s;float Ap=BG.y*360.;return Am(particle.r,Ao,Ap);}else{BG.y=smoothstep(0.,1.,BG.y);vec2 BH=particle.t.xy;vec2 BI=particle.t.zw;return mix(BH,BI,BG);}}vec2 BJ(vec2 BK,vec2 BL){float BM=cos(radians(BK.y));vec2 AE;if(particle.q==1.){AE=vec2(BL.x/BM,BL.y);}else{AE=vec2(BL.x,BL.y*BM);}return BK+AE;}bool BN(vec2 BK,vec4 A){vec2 BO=A.xy;vec2 BP=A.zw;float BA=Az(BK.x,BO.x);float Ax=BK.y;return(BO.x<=BA&&BA<=BP.x&&BO.y<=Ax&&Ax<=BP.y);}void main(){float BQ=mod(float(gl_VertexID),particle.v);float BR=floor(float(gl_VertexID)/particle.v);if(BR>0.){return;}if(sourcePosition.z==Aj){vec2 BS=vec2(BQ*particle.z/particle.v);vec2 BG=BE(BS);vec2 BK=BF(BG);targetPosition.xy=BK;targetPosition.x=Az(targetPosition.x);targetColor=Ak;return;}if(particle.u>1.&&mod(BQ,particle.u)>=1.){targetPosition.xy=sourcePosition.xy;targetPosition.z=Aj;targetColor=Ak;return;}if(abs(mod(BQ,particle.w+2.)-mod(particle.y,particle.w+2.))<1.){targetPosition.xy=sourcePosition.xy;targetPosition.z=Aj;targetColor=Ak;return;}if(!BN(sourcePosition.xy,bitmap2.A)){targetPosition.xy=sourcePosition.xy;targetColor=Ak;return;}vec2 uv=Q(sourcePosition.xy);vec4 AX=AZ(W,X,raster.Y,raster.Z,raster.a,raster.b,bitmap2.B,uv);if(!Ae(AX,raster.d)){targetPosition.xy=sourcePosition.xy;targetColor=Ak;return;}float k=Ah(AX,raster.c,raster.d);if((!Ac(raster.e)&&k<raster.e)||(!Ac(raster.f)&&k>raster.f)){targetPosition.xy=sourcePosition.xy;targetColor=Ak;return;}vec2 BL=Ag(AX,raster.c,raster.d)*particle.x;targetPosition.xy=BJ(sourcePosition.xy,BL);targetPosition.x=Az(targetPosition.x);targetColor=sourceColor;targetColor=l(g,palette.h,palette.i,k);}`,modules:[Gt,jt,Zt,Go],vertexCount:i,attributes:{[mi]:a,[Ci]:l},bufferLayout:[{name:mi,format:"float32x3"},{name:Ci,format:"float32x4"}],feedbackBuffers:{[vi]:c,[yi]:u},varyings:[vi,yi]});this.setState({initialized:!0,numInstances:s,numAgedInstances:r,sourcePositions:a,targetPositions:c,sourceColors:l,targetColors:u,opacities:d,transform:g,previousViewportZoom:0,previousTime:0})}_runTransformFeedback(){const{initialized:t}=this.state;if(!t)return;const{device:e,viewport:i,timeline:o}=this.context,{imageTexture:s,imageTexture2:r,imageSmoothing:a,imageInterpolation:c,imageWeight:l,imageType:u,imageUnscale:d,imageMinValue:g,imageMaxValue:h,bounds:p,color:A,numParticles:f,maxAge:C,speedFactor:y}=G(this.props,re),{paletteTexture:v,paletteBounds:b,numAgedInstances:x,sourcePositions:I,targetPositions:Q,sourceColors:R,targetColors:M,transform:z,previousViewportZoom:j,previousTime:X}=this.state;if(!(s&&typeof x=="number"&&I&&Q&&R&&M&&z))return;const Z=o.getTime();if(typeof X=="number"&&Z<X+1e3/30)return;const W=lt(i),gt=lt(i)?Xi(i):void 0,yt=lt(i)?Js(i):void 0,$e=Zs(i)?qs(i):void 0,ti=2**(4*(typeof j=="number"?j-ce(i):0)),J=y/2**(ce(i)+7);z.model.shaderInputs.setProps({[Gt.name]:{viewportGlobe:W,bounds:p,_imageCoordinateSystem:H.LNGLAT},[jt.name]:{imageTexture:s??$(e),imageTexture2:r??$(e),imageSmoothing:a,imageInterpolation:c,imageWeight:l,imageType:u,imageUnscale:d,imageMinValue:g,imageMaxValue:h},[Zt.name]:{paletteTexture:v??$(e),paletteBounds:b,paletteColor:A},[Go.name]:{viewportGlobe:W,viewportGlobeCenter:gt,viewportGlobeRadius:yt,viewportBounds:$e,viewportZoomChangeFactor:ti,numParticles:f,maxAge:C,speedFactor:J,time:Z,seed:Math.random()}}),z.run({clearColor:!1,clearDepth:!1,clearStencil:!1,depthReadOnly:!0,stencilReadOnly:!0});const Bt=e.createCommandEncoder();Bt.copyBufferToBuffer({sourceBuffer:I,sourceOffset:0,destinationBuffer:Q,destinationOffset:4*f*3,size:4*x*3}),Bt.copyBufferToBuffer({sourceBuffer:R,sourceOffset:0,destinationBuffer:M,destinationOffset:4*f*4,size:4*x*4}),Bt.finish(),Bt.destroy(),this._swapTransformFeedback(),this.state.previousViewportZoom=ce(i),this.state.previousTime=Z}_swapTransformFeedback(){const{sourcePositions:t,targetPositions:e,sourceColors:i,targetColors:o,transform:s}=this.state;t&&e&&i&&o&&s&&(this.state.sourcePositions=e,this.state.targetPositions=t,this.state.sourceColors=o,this.state.targetColors=i,s.model.setAttributes({[mi]:e,[Ci]:o}),s.transformFeedback.setBuffers({[vi]:t,[yi]:i}))}_resetTransformFeedback(){const{initialized:t}=this.state;if(!t)return;const{numInstances:e,sourcePositions:i,targetPositions:o,sourceColors:s,targetColors:r}=this.state;typeof e=="number"&&i&&o&&s&&r&&(i.write(new Float32Array(3*e)),o.write(new Float32Array(3*e)),s.write(new Float32Array(4*e)),r.write(new Float32Array(4*e)))}_deleteTransformFeedback(){const{initialized:t}=this.state;if(!t)return;const{sourcePositions:e,targetPositions:i,sourceColors:o,targetColors:s,opacities:r,transform:a}=this.state;e&&i&&o&&s&&r&&a&&(e.destroy(),i.destroy(),o.destroy(),s.destroy(),r.destroy(),a.destroy(),this.setState({initialized:!1,sourcePositions:void 0,targetPositions:void 0,sourceColors:void 0,targetColors:void 0,opacities:void 0,transform:void 0}))}_updatePalette(){const{device:t}=this.context,{palette:e}=G(this.props,re);if(!e)return void this.setState({paletteTexture:void 0,paletteBounds:void 0});const i=Jt(e),{paletteBounds:o,paletteTexture:s}=Yi(t,i);this.setState({paletteTexture:s,paletteBounds:o})}step(){this._runTransformFeedback(),this.setNeedsRedraw()}clear(){this._resetTransformFeedback(),this.setNeedsRedraw()}}Ke.layerName="ParticleLineLayer",Ke.defaultProps=re;const wu={...Ke.defaultProps,imageTexture:void 0,imageTexture2:void 0,image:{type:"object",value:null},image2:{type:"object",value:null}};class jo extends dt{renderLayers(){const{device:t}=this.context,{props:e,imageTexture:i,imageTexture2:o}=this.state;return e&&i?[new Ke(this.props,this.getSubLayerProps({id:"line",data:[],imageTexture:i,imageTexture2:o,image:$(t),image2:$(t)}))]:[]}updateState(t){const{image:e,image2:i,imageUnscale:o,bounds:s}=t.props;if(super.updateState(t),e&&o&&!(e.data instanceof Uint8Array||e.data instanceof Uint8ClampedArray))throw new Error("imageUnscale can be applied to Uint8 data only");if(e!==t.oldProps.image||i!==t.oldProps.image2){const{device:r}=this.context,{image:a,image2:c}=this.props,l=a?Tt(r,a,At(s)):null,u=c?Tt(r,c,At(s)):null;this.setState({imageTexture:l,imageTexture2:u})}this.setState({props:t.props})}}jo.layerName="ParticleLayer",jo.defaultProps=wu;class ge{addTo(t){t.appendChild(this.onAdd())}prependTo(t){t.prepend(this.onAdd())}remove(){this.onRemove()}updateConfig(t){this.setConfig({...this.getConfig(),...t})}}function he(n,t){t===void 0&&(t={});var e=t.insertAt;if(n&&typeof document<"u"){var i=document.head||document.getElementsByTagName("head")[0],o=document.createElement("style");o.type="text/css",e==="top"&&i.firstChild?i.insertBefore(o,i.firstChild):i.appendChild(o),o.styleSheet?o.styleSheet.cssText=n:o.appendChild(document.createTextNode(n))}}he(".weatherlayers-legend-control{margin:10px;pointer-events:auto}.weatherlayers-legend-control>div{background:hsla(0,0%,100%,.5);color:rgba(0,0,0,.75);display:inline-block;font-family:Helvetica Neue,Arial,Helvetica,sans-serif;font-size:12px;line-height:14px;width:100%}.weatherlayers-legend-control header,.weatherlayers-legend-control main{margin:5px 10px}.weatherlayers-legend-control header{font-weight:700}.weatherlayers-legend-control__legend{margin-top:5px;vertical-align:middle;width:100%}");const Hs="weatherlayers-legend-control",Pu=`${Hs}__text`;class sd extends ge{constructor(t={}){super(),this._container=void 0,this._config=t}onAdd(){return this._container=document.createElement("div"),this._container.classList.add(Hs),this.setConfig(this._config),this._container}onRemove(){this._container&&this._container.parentNode&&(this._container.parentNode.removeChild(this._container),this._container=void 0)}getConfig(){return{...this._config}}setConfig(t){if(!this._container||!t.title||!t.unitFormat||!t.palette||this._container.children.length>0&&this._config.width===t.width&&this._config.ticksCount===t.ticksCount&&this._config.title===t.title&&this._config.unitFormat===t.unitFormat&&this._config.palette===t.palette)return;this._config=t;const e=this._config.width??300,i=this._config.ticksCount??6,o=this._config.title,s=this._config.unitFormat,r=this._config.palette,a=Jt(r),c=a.domain(),l=[c[0],c[c.length-1]],u=qo(a).toDataURL();this._container.innerHTML="",this._container.style.width=`${e}px`;const d=document.createElement("div");this._container.appendChild(d);const g=document.createElement("header");d.appendChild(g);const h=document.createElement("span");h.classList.add(Pu),h.innerHTML=`${o} [${Ss(s)}]`,g.appendChild(h);const p=document.createElement("main");d.appendChild(p);const A="http://www.w3.org/2000/svg",f=document.createElementNS(A,"svg");f.setAttribute("height","24px"),f.setAttribute("class","weatherlayers-legend-control__legend"),p.appendChild(f);const C=document.createElementNS(A,"image");C.setAttribute("href",u),C.setAttribute("width","100%"),C.setAttribute("height","5"),C.setAttribute("preserveAspectRatio","none"),f.appendChild(C);const y=(l[1]-l[0])/(i-1);for(let v=0;v<i;v++){const b=l[0]+v*y,x=Zi(b,s),I=document.createElementNS(A,"g");I.style.transform=`translate(${(b-l[0])/(l[1]-l[0])*100}%, 0)`,f.appendChild(I);const Q=document.createElementNS(A,"line");Q.setAttribute("y1","0"),Q.setAttribute("y2","10"),Q.style.stroke="currentColor",v===0?Q.style.transform="translate(0.5px, 0)":v===i-1&&(Q.style.transform="translate(-0.5px, 0)"),I.appendChild(Q);const R=document.createElementNS(A,"text");R.innerHTML=x,R.setAttribute("x","0"),R.setAttribute("y","22"),R.style.textAnchor=v===0?"start":v===i-1?"end":"middle",I.appendChild(R)}}}he(`.weatherlayers-tooltip-control{margin:10px;pointer-events:auto}.weatherlayers-tooltip-control>div{align-items:center;background:hsla(0,0%,100%,.5);color:rgba(0,0,0,.75);display:inline-flex;font-family:Helvetica Neue,Arial,Helvetica,sans-serif;font-size:12px;line-height:20px;padding:0 5px;white-space:nowrap}.weatherlayers-tooltip-control.follow-cursor{margin:0;pointer-events:none;position:absolute;z-index:1}.weatherlayers-tooltip-control.follow-cursor>div{position:absolute}.leaflet-map-pane .weatherlayers-tooltip-control.follow-cursor{z-index:101}.weatherlayers-tooltip-control.follow-cursor:before{content:"";height:0;position:absolute;width:0}.weatherlayers-tooltip-control.follow-cursor[data-follow-cursor-placement=BOTTOM]:before{border-bottom:5px solid hsla(0,0%,100%,.5);border-left:5px solid transparent;border-right:5px solid transparent;left:calc(50% - 5px);top:-5px}.weatherlayers-tooltip-control.follow-cursor[data-follow-cursor-placement=TOP]:before{border-left:5px solid transparent;border-right:5px solid transparent;border-top:5px solid hsla(0,0%,100%,.5);left:calc(50% - 5px);top:0}.weatherlayers-tooltip-control.follow-cursor[data-follow-cursor-placement=RIGHT]:before{border-bottom:5px solid transparent;border-right:5px solid hsla(0,0%,100%,.5);border-top:5px solid transparent;left:-5px;top:calc(50% - 5px)}.weatherlayers-tooltip-control.follow-cursor[data-follow-cursor-placement=LEFT]:before{border-bottom:5px solid transparent;border-left:5px solid hsla(0,0%,100%,.5);border-top:5px solid transparent;left:0;top:calc(50% - 5px)}.weatherlayers-tooltip-control .weatherlayers-tooltip-control__direction{align-items:center;display:inline-flex;margin-left:4px}.weatherlayers-tooltip-control .weatherlayers-tooltip-control__direction-icon{background:no-repeat 50%/contain;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30' style='enable-background:new 0 0 30 30' xml:space='preserve'%3E%3Cpath d='M3.74 14.5c0-2.04.51-3.93 1.52-5.66s2.38-3.1 4.11-4.11 3.61-1.51 5.64-1.51c1.52 0 2.98.3 4.37.89s2.58 1.4 3.59 2.4 1.81 2.2 2.4 3.6.89 2.85.89 4.39c0 1.52-.3 2.98-.89 4.37s-1.4 2.59-2.4 3.59-2.2 1.8-3.59 2.39-2.84.89-4.37.89c-1.53 0-3-.3-4.39-.89s-2.59-1.4-3.6-2.4-1.8-2.2-2.4-3.58-.88-2.84-.88-4.37zm2.48 0c0 2.37.86 4.43 2.59 6.18 1.73 1.73 3.79 2.59 6.2 2.59 1.58 0 3.05-.39 4.39-1.18s2.42-1.85 3.21-3.2 1.19-2.81 1.19-4.39-.4-3.05-1.19-4.4-1.86-2.42-3.21-3.21-2.81-1.18-4.39-1.18-3.05.39-4.39 1.18S8.2 8.75 7.4 10.1s-1.18 2.82-1.18 4.4zm4.89 5.85 3.75-13.11c.01-.1.06-.15.15-.15s.14.05.15.15l3.74 13.11c.04.11.03.19-.02.25s-.13.06-.24 0l-3.47-1.3c-.1-.04-.2-.04-.29 0l-3.5 1.3c-.1.06-.17.06-.21 0s-.08-.15-.06-.25z'/%3E%3C/svg%3E");display:inline-block;height:20px;opacity:.75;vertical-align:middle;width:20px}.weatherlayers-tooltip-control .weatherlayers-tooltip-control__direction-text{margin-left:2px}.weatherlayers-tooltip-control:not(.has-direction) .weatherlayers-tooltip-control__direction,.weatherlayers-tooltip-control:not(.has-value){display:none}`);const fe="weatherlayers-tooltip-control",Tu=`${fe}__value`,Bu=`${fe}__direction`,_u=`${fe}__direction-icon`,Su=`${fe}__direction-text`;class rd extends ge{constructor(t={}){super(),this._container=void 0,this._value=void 0,this._direction=void 0,this._directionIcon=void 0,this._directionText=void 0,this._config=t}onAdd(){return this._container=document.createElement("div"),this._container.classList.add(fe),this.setConfig(this._config),this._container}onRemove(){this._container&&this._container.parentNode&&(this._container.parentNode.removeChild(this._container),this._container=void 0)}getConfig(){return{...this._config}}setConfig(t){if(!this._container||!t.unitFormat||this._container.children.length>0&&this._config.directionType===t.directionType&&this._config.directionFormat===t.directionFormat&&this._config.unitFormat===t.unitFormat&&this._config.followCursor===t.followCursor&&this._config.followCursorOffset===t.followCursorOffset&&this._config.followCursorPlacement===t.followCursorPlacement)return;this._config=t,this._container.innerHTML="";const e=document.createElement("div");this._container.appendChild(e),this._value=document.createElement("span"),this._value.classList.add(Tu),e.appendChild(this._value),this._direction=document.createElement("span"),this._direction.classList.add(Bu),e.appendChild(this._direction),this._directionIcon=document.createElement("span"),this._directionIcon.classList.add(_u),this._direction.appendChild(this._directionIcon),this._directionText=document.createElement("span"),this._directionText.classList.add(Su),this._direction.appendChild(this._directionText)}update(t){if(!(this._container&&this._value&&this._directionIcon&&this._directionText))return;const{value:e,direction:i}=t??{};this._container.classList.toggle("follow-cursor",this._config.followCursor??!1),this._container.setAttribute("data-follow-cursor-placement",this._config.followCursorPlacement??rt.BOTTOM),this._container.classList.toggle("has-value",e!==void 0),this._container.classList.toggle("has-direction",i!==void 0),this._value.innerHTML=e!==void 0?ql(e,this._config.unitFormat):"",i!==void 0?(this._directionIcon.style.transform=`rotate(${(i+180)%360}deg)`,this._directionText.innerHTML=Kl(i,this._config.directionType??_s.INWARD,this._config.directionFormat??It.VALUE)):(this._directionIcon.style.transform="",this._directionText.innerHTML="")}updatePickingInfo(t){if(!this._container||!this._value||!this._direction)return;if(!t)return void this.update(void 0);this.update(t.raster);const e=t.raster?.direction!==void 0,i=this._container.firstChild;if(this._config.followCursor){const o=i.getBoundingClientRect(),s=this._value.getBoundingClientRect(),r=this._config.followCursorOffset??16,a=this._config.followCursorPlacement??rt.BOTTOM;let c=t.x,l=t.y;if(a===rt.BOTTOM)l+=r;else if(a===rt.TOP)l-=r;else if(a===rt.RIGHT)c+=r;else{if(a!==rt.LEFT)throw new Error(`Invalid placement ${a}`);c-=r}if(this._container.style.left=`${c}px`,this._container.style.top=`${l}px`,a===rt.BOTTOM||a===rt.TOP){const u=parseFloat(window.getComputedStyle(i).paddingLeft),d=parseFloat(window.getComputedStyle(this._direction).marginLeft),g=-(u+(e?s.width+d:s.width/2));i.style.left=`${g}px`}if(a===rt.RIGHT||a===rt.LEFT){const u=-o.height/2;i.style.top=`${u}px`}if(a===rt.TOP){const u=-o.height;i.style.top=`${u}px`}if(a===rt.LEFT){const u=-o.width;i.style.left=`${u}px`}document.addEventListener("mousedown",(()=>this.update(void 0)),{once:!0})}else this._container.style.left="",this._container.style.top="",i.style.left="",i.style.top=""}}he(`.weatherlayers-timeline-control{margin:10px;pointer-events:auto}.weatherlayers-timeline-control>div{background:hsla(0,0%,100%,.5);color:rgba(0,0,0,.75);display:inline-block;font-family:Helvetica Neue,Arial,Helvetica,sans-serif;font-size:12px;line-height:14px;width:100%}.weatherlayers-timeline-control footer,.weatherlayers-timeline-control header,.weatherlayers-timeline-control main{margin:5px 10px;text-align:center}.weatherlayers-timeline-control header{font-weight:700}.weatherlayers-timeline-control footer{display:flex;gap:10px}.weatherlayers-timeline-control__progress-input{margin:-2px 0 2px;vertical-align:middle;width:100%}.weatherlayers-timeline-control__end-datetime,.weatherlayers-timeline-control__start-datetime{flex:0 0}.weatherlayers-timeline-control__buttons{flex:1 0}.weatherlayers-timeline-control__start-datetime{text-align:left}.weatherlayers-timeline-control__end-datetime{text-align:right}.weatherlayers-timeline-control__button{background:no-repeat 50%/contain;display:inline-block;height:16px;vertical-align:middle;width:16px}.weatherlayers-timeline-control__button+.weatherlayers-timeline-control__button{margin-left:5px}.weatherlayers-timeline-control__play-button{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='1792' height='1792' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1576 927 248 1665q-23 13-39.5 3t-16.5-36V160q0-26 16.5-36t39.5 3l1328 738q23 13 23 31t-23 31z'/%3E%3C/svg%3E")}.weatherlayers-timeline-control__pause-button{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='1792' height='1792' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1664 192v1408q0 26-19 45t-45 19h-512q-26 0-45-19t-19-45V192q0-26 19-45t45-19h512q26 0 45 19t19 45zm-896 0v1408q0 26-19 45t-45 19H192q-26 0-45-19t-19-45V192q0-26 19-45t45-19h512q26 0 45 19t19 45z'/%3E%3C/svg%3E")}.weatherlayers-timeline-control__step-backward-button{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='1792' height='1792' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1363 141q19-19 32-13t13 32v1472q0 26-13 32t-32-13L653 941q-9-9-13-19v678q0 26-19 45t-45 19H448q-26 0-45-19t-19-45V192q0-26 19-45t45-19h128q26 0 45 19t19 45v678q4-10 13-19z'/%3E%3C/svg%3E")}.weatherlayers-timeline-control__step-forward-button{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='1792' height='1792' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M429 1651q-19 19-32 13t-13-32V160q0-26 13-32t32 13l710 710q9 9 13 19V192q0-26 19-45t45-19h128q26 0 45 19t19 45v1408q0 26-19 45t-45 19h-128q-26 0-45-19t-19-45V922q-4 10-13 19z'/%3E%3C/svg%3E")}.weatherlayers-timeline-control__loader{display:block;margin-top:2px}.weatherlayers-timeline-control__loader-icon{background:no-repeat 50%/contain;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' style='margin:auto;background:0 0;display:block;shape-rendering:auto' width='16' height='16' viewBox='0 0 100 100' preserveAspectRatio='xMidYMid'%3E%3Ccircle cx='50' cy='50' fill='none' stroke='rgba(0, 0, 0, 0.4)' stroke-width='10' r='25' stroke-dasharray='117.80972450961724 41.269908169872416'%3E%3CanimateTransform attributeName='transform' type='rotate' repeatCount='indefinite' dur='1s' values='0 50 50;360 50 50' keyTimes='0;1'/%3E%3C/circle%3E%3C/svg%3E");display:inline-block;height:16px;vertical-align:middle;width:16px}.weatherlayers-timeline-control__loader-text{color:rgba(0,0,0,.4);margin-left:2px;vertical-align:middle}.weatherlayers-timeline-control.loading *{pointer-events:none}.weatherlayers-timeline-control.running .weatherlayers-timeline-control__play-button,.weatherlayers-timeline-control:not(.running) .weatherlayers-timeline-control__pause-button{display:none}.weatherlayers-timeline-control:not(.loading) .weatherlayers-timeline-control__loader{visibility:hidden}`);const nt="weatherlayers-timeline-control",Lu=`${nt}__current-datetime`,Zo=`${nt}__progress-input`,Mu=`${nt}__start-datetime`,Qu=`${nt}__buttons`,Ou=`${nt}__end-datetime`,Be=`${nt}__button`,Ru=`${nt}__step-backward-button`,Fu=`${nt}__play-button`,Uu=`${nt}__pause-button`,Du=`${nt}__step-forward-button`,ku=`${nt}__loader`,Nu=`${nt}__loader-icon`,zu=`${nt}__loader-text`,Jo="loading",Ei="running";class ad extends ge{constructor(t={}){super(),this._container=void 0,this._currentDatetime=void 0,this._progressInput=void 0,this._loaderText=void 0,this._loading=!1,this._config=t,this._animation=new Yl({onUpdate:()=>this._animationUpdated(),fps:this._config.fps??15})}onAdd(){return this._container=document.createElement("div"),this._container.classList.add(nt),this.setConfig(this._config),this._container}onRemove(){this._container&&this._container.parentNode&&(this._container.parentNode.removeChild(this._container),this._container=void 0,this._currentDatetime=void 0,this._progressInput=void 0)}get loading(){return this._loading}get running(){return this._running}get _running(){return this._animation.running}async toggle(t=!this._running){return t?await this.start():this.pause()}async start(){!this._container||this._loading||this._running||(await this._preload(this._config.datetimes),this._animation.start(),this._container.classList.add(Ei),this._updateProgress())}pause(){this._container&&!this._loading&&this._running&&(this._animation.stop(),this._container.classList.remove(Ei),this._updateProgress())}stop(){this._container&&this._progressInput&&!this._loading&&this._running&&(this._animation.stop(),this._container.classList.remove(Ei),this._progressInput.valueAsNumber=0,this._updateProgress())}reset(){!this._progressInput||this._loading||this._running||(this._progressInput.valueAsNumber=0,this._updateProgress())}async stepBackward(){!this._progressInput||this._loading||this._running||(this._progressInput.value!==this._progressInput.min?this._progressInput.stepDown():this._progressInput.value=this._progressInput.max,await this._preload(this._startEndDatetimes),this._updateProgress())}async stepForward(){!this._progressInput||this._loading||this._running||(this._progressInput.value!==this._progressInput.max?this._progressInput.stepUp():this._progressInput.value=this._progressInput.min,await this._preload(this._startEndDatetimes),this._updateProgress())}get _startEndDatetimes(){if(!this._progressInput)return[];const t=this._config.datetimes[Math.floor(this._progressInput.valueAsNumber)],e=this._config.datetimes[Math.ceil(this._progressInput.valueAsNumber)];return t===e?[t]:[t,e]}_updateProgress(){if(!this._progressInput||!this._currentDatetime)return;const t=eu(this._config.datetimes[Math.floor(this._progressInput.valueAsNumber)],this._config.datetimes[Math.ceil(this._progressInput.valueAsNumber)],this._progressInput.valueAsNumber%1);this._config.datetime=t;const e=this._config.datetimeFormatFunction??Zn;this._currentDatetime.innerHTML=e(t),this._config.onUpdate&&this._config.onUpdate(t)}async _progressInputClicked(){this._loading||this._running||(await this._preload(this._startEndDatetimes),this._updateProgress())}_animationUpdated(){this._progressInput&&!this._loading&&this._running&&(this._progressInput.value!==this._progressInput.max?this._progressInput.stepUp():this._progressInput.value=this._progressInput.min,this._updateProgress())}async _preload(t){if(!this._container||!this._loaderText||!this._config.onPreload)return;this._loading=!0,this._container.classList.add(Jo);const e=this._config.onPreload(t);if(Array.isArray(e)){let i=0;const o=()=>{this._loaderText.innerHTML=`Loading... ${i}/${e.length}`};o();for(let s of e)s.then((()=>{i++,o()}));await Promise.all(e),this._loaderText.innerHTML=""}else this._loaderText.innerHTML="Loading...",await e,this._loaderText.innerHTML="";this._loading=!1,this._container.classList.remove(Jo)}getConfig(){return{...this._config}}setConfig(t){if(!this._container||!t.datetimes||t.datetimes.length<2||!t.datetime||t.datetime<t.datetimes[0]||t.datetime>t.datetimes[t.datetimes.length-1]||this._container.children.length>0&&this._config.width===t.width&&this._config.datetimes.length===t.datetimes.length&&this._config.datetimes.every(((j,X)=>j===t.datetimes[X]))&&this._config.datetime===t.datetime&&this._config.datetimeInterpolate===t.datetimeInterpolate&&this._config.datetimeFormatFunction===t.datetimeFormatFunction&&this._config.onPreload===t.onPreload&&this._config.onUpdate===t.onUpdate)return;this._config=t;const e=this._config.width??300,i=this._config.datetimes,o=this._config.datetime,s=this._config.datetimeInterpolate??!1,r=this._config.datetimeFormatFunction??Zn,a=Ys(i,(j=>j<=o));if(a<0)throw new Error("Invalid state");const c=a<i.length-1?a+1:null,l=iu(i[a],typeof c=="number"?i[a+1]:null,o),u=s?.25:1,d=a+Math.floor(l/u)*u;this._container.innerHTML="",this._container.style.width=`${e}px`;const g=document.createElement("div");this._container.appendChild(g);const h=document.createElement("header");g.appendChild(h),this._currentDatetime=document.createElement("span"),this._currentDatetime.classList.add(Lu),this._currentDatetime.innerHTML=r(o),h.appendChild(this._currentDatetime);const p=document.createElement("main");g.appendChild(p);const A=`${Zo}-ticks-${Xs()}`;this._progressInput=document.createElement("input"),this._progressInput.classList.add(Zo),this._progressInput.type="range",this._progressInput.min="0",this._progressInput.max=""+(i.length-1),this._progressInput.step=`${u}`,this._progressInput.valueAsNumber=d,this._progressInput.setAttribute("list",A),this._progressInput.addEventListener("input",(()=>this._progressInputClicked())),p.appendChild(this._progressInput);const f=document.createElement("datalist");f.id=A,p.appendChild(f);for(let j=0;j<i.length;j++){const X=document.createElement("option");X.innerHTML=`${j}`,f.appendChild(X)}const C=document.createElement("footer");g.appendChild(C);const y=document.createElement("span");y.classList.add(Mu),y.innerHTML=r(i[0]),C.appendChild(y);const v=document.createElement("span");v.classList.add(Qu),C.appendChild(v);const b=document.createElement("span");b.classList.add(Ou),b.innerHTML=r(i[i.length-1]),C.appendChild(b);const x=document.createElement("a");x.href="javascript:void(0)",x.classList.add(Be),x.classList.add(Ru),x.addEventListener("click",(()=>this.stepBackward())),v.appendChild(x);const I=document.createElement("a");I.href="javascript:void(0)",I.classList.add(Be),I.classList.add(Fu),I.addEventListener("click",(()=>this.start())),v.appendChild(I);const Q=document.createElement("a");Q.href="javascript:void(0)",Q.classList.add(Be),Q.classList.add(Uu),Q.addEventListener("click",(()=>this.pause())),v.appendChild(Q);const R=document.createElement("a");R.href="javascript:void(0)",R.classList.add(Be),R.classList.add(Du),R.addEventListener("click",(()=>this.stepForward())),v.appendChild(R);const M=document.createElement("span");M.classList.add(ku),v.appendChild(M);const z=document.createElement("span");z.classList.add(Nu),M.appendChild(z),this._loaderText=document.createElement("span"),this._loaderText.classList.add(zu),M.appendChild(this._loaderText)}}he(".weatherlayers-attribution-control{margin-top:2px;pointer-events:auto}.weatherlayers-attribution-control>div{background:hsla(0,0%,100%,.5);color:rgba(0,0,0,.75);display:inline-block;font-family:Helvetica Neue,Arial,Helvetica,sans-serif;font-size:12px;line-height:20px;padding:0 5px}.weatherlayers-attribution-control a{color:rgba(0,0,0,.75);text-decoration:none}.weatherlayers-attribution-control a:hover{text-decoration:underline}");class cd extends ge{constructor(t={}){super(),this._container=void 0,this._config=t}onAdd(){return this._container=document.createElement("div"),this._container.classList.add("weatherlayers-attribution-control"),this.setConfig(this._config),this._container}onRemove(){this._container&&this._container.parentNode&&(this._container.parentNode.removeChild(this._container),this._container=void 0)}getConfig(){return{...this._config}}setConfig(t){if(!this._container||!t.attribution||this._container.children.length>0&&this._config.attribution===t.attribution)return;this._config=t;const e=this._config.attribution;this._container.innerHTML=`<div>${e}</div>`}}he(`.weatherlayers-logo-control{margin:10px;pointer-events:auto}.weatherlayers-logo-control a{background:no-repeat 50%/contain;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' xml:space='preserve' style='fill-rule:evenodd;clip-rule:evenodd;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:2' viewBox='0 0 131 23'%3E%3Cg opacity='.9'%3E%3Cpath d='M27.391 17.706h2.534l1.736-6.475h.132l1.765 6.475h2.52l2.761-10.569H36.07l-1.384 7.009h-.132l-1.75-7.009H30.65l-1.692 7.009h-.131L27.42 7.137h-2.79l2.761 10.569Zm15.092.19c2.615 0 3.611-1.53 3.846-2.504l.022-.088-2.373.007-.015.029c-.117.213-.564.711-1.428.711-.996 0-1.597-.674-1.619-1.839h5.486v-.747c0-2.49-1.56-4.101-4.014-4.101-2.461 0-4.021 1.633-4.021 4.262v.008c0 2.644 1.56 4.262 4.116 4.262Zm-.036-6.687c.805 0 1.377.52 1.501 1.495h-3.003c.125-.96.703-1.495 1.502-1.495Zm7.028 6.622c1.04 0 1.912-.44 2.271-1.136h.139v1.011h2.549v-5.559c0-1.758-1.282-2.783-3.531-2.783-2.204 0-3.611.989-3.757 2.49l-.007.088h2.351l.014-.037c.154-.41.572-.637 1.253-.637.718 0 1.128.33 1.128.879v.637l-1.78.103c-2.102.132-3.259.988-3.259 2.468v.015c0 1.486 1.069 2.461 2.629 2.461Zm-.132-2.644v-.015c0-.484.403-.791 1.172-.842l1.37-.088v.534c0 .703-.637 1.245-1.458 1.245-.652 0-1.084-.322-1.084-.834Zm9.944 2.534c.49 0 .966-.044 1.237-.103v-1.853a5.19 5.19 0 0 1-.651.029c-.674 0-.982-.293-.982-.908v-3.428h1.633V9.554h-1.633V7.687h-2.6v1.867h-1.245v1.904h1.245v4.014c0 1.597.85 2.249 2.996 2.249Zm2.267-.015h2.593v-4.658c0-.938.498-1.575 1.34-1.575.879 0 1.282.557 1.282 1.546v4.687h2.593V12.44c0-1.956-.945-3.076-2.754-3.076-1.15 0-1.97.571-2.322 1.465h-.139V6.5h-2.593v11.206Zm12.719.19c2.615 0 3.611-1.53 3.846-2.504l.022-.088-2.373.007-.015.029c-.117.213-.564.711-1.428.711-.996 0-1.597-.674-1.619-1.839h5.486v-.747c0-2.49-1.56-4.101-4.014-4.101-2.461 0-4.021 1.633-4.021 4.262v.008c0 2.644 1.56 4.262 4.116 4.262Zm-.036-6.687c.805 0 1.377.52 1.501 1.495h-3.003c.125-.96.703-1.495 1.502-1.495Zm4.816 6.497h2.593v-4.314c0-1.128.71-1.78 1.926-1.78.366 0 .74.052 1.084.139V9.562a2.733 2.733 0 0 0-.879-.132c-1.04 0-1.757.52-1.992 1.421h-.139V9.554h-2.593v8.152Zm6.443 0h7.177v-2.161h-4.489V7.137h-2.688v10.569Zm10.36.125c1.04 0 1.912-.44 2.271-1.136h.139v1.011h2.549v-5.559c0-1.758-1.282-2.783-3.53-2.783-2.205 0-3.611.989-3.758 2.49l-.007.088h2.351l.015-.037c.154-.41.571-.637 1.252-.637.718 0 1.128.33 1.128.879v.637l-1.78.103c-2.102.132-3.259.988-3.259 2.468v.015c0 1.486 1.069 2.461 2.629 2.461Zm-.131-2.644v-.015c0-.484.402-.791 1.171-.842l1.37-.088v.534c0 .703-.637 1.245-1.457 1.245-.652 0-1.084-.322-1.084-.834Zm7.233 5.397c2.3 0 3.589-.82 4.336-3.142l2.571-7.888h-2.74l-1.45 5.911h-.154l-1.45-5.911h-2.863l2.783 8.152-.037.227c-.08.476-.527.747-1.304.747-.212 0-.424 0-.571-.007v1.904c.293.007.586.007.879.007Zm10.896-2.688c2.614 0 3.61-1.53 3.845-2.504l.022-.088-2.373.007-.015.029c-.117.213-.564.711-1.428.711-.996 0-1.597-.674-1.619-1.839h5.486v-.747c0-2.49-1.56-4.101-4.014-4.101-2.461 0-4.021 1.633-4.021 4.262v.008c0 2.644 1.56 4.262 4.117 4.262Zm-.037-6.687c.806 0 1.377.52 1.501 1.495h-3.003c.125-.96.704-1.495 1.502-1.495Zm4.816 6.497h2.593v-4.314c0-1.128.711-1.78 1.926-1.78.367 0 .74.052 1.084.139V9.562a2.733 2.733 0 0 0-.879-.132c-1.04 0-1.757.52-1.992 1.421h-.139V9.554h-2.593v8.152Zm9.468.19c2.212 0 3.735-1.083 3.735-2.775v-.008c0-1.223-.769-1.911-2.454-2.248l-1.406-.279c-.776-.161-1.025-.373-1.025-.739v-.015c0-.454.432-.725 1.076-.725.718 0 1.121.381 1.202.718l.014.051h2.373v-.037c-.044-1.303-1.23-2.475-3.589-2.475-2.19 0-3.581 1.018-3.581 2.644v.007c0 1.245.805 2.066 2.38 2.381l1.406.278c.74.154 1.018.373 1.018.754v.008c0 .439-.446.71-1.142.71-.754 0-1.165-.315-1.318-.732l-.015-.044h-2.52v.051c.162 1.421 1.429 2.475 3.846 2.475Z' style='fill:none;fill-rule:nonzero;stroke:%23000;stroke-opacity:.3;stroke-width:3px' transform='translate(-2.33)'/%3E%3Cpath d='M27.391 17.706h2.534l1.736-6.475h.132l1.765 6.475h2.52l2.761-10.569H36.07l-1.384 7.009h-.132l-1.75-7.009H30.65l-1.692 7.009h-.131L27.42 7.137h-2.79l2.761 10.569Zm15.092.19c2.615 0 3.611-1.53 3.846-2.504l.022-.088-2.373.007-.015.029c-.117.213-.564.711-1.428.711-.996 0-1.597-.674-1.619-1.839h5.486v-.747c0-2.49-1.56-4.101-4.014-4.101-2.461 0-4.021 1.633-4.021 4.262v.008c0 2.644 1.56 4.262 4.116 4.262Zm-.036-6.687c.805 0 1.377.52 1.501 1.495h-3.003c.125-.96.703-1.495 1.502-1.495Zm7.028 6.622c1.04 0 1.912-.44 2.271-1.136h.139v1.011h2.549v-5.559c0-1.758-1.282-2.783-3.531-2.783-2.204 0-3.611.989-3.757 2.49l-.007.088h2.351l.014-.037c.154-.41.572-.637 1.253-.637.718 0 1.128.33 1.128.879v.637l-1.78.103c-2.102.132-3.259.988-3.259 2.468v.015c0 1.486 1.069 2.461 2.629 2.461Zm-.132-2.644v-.015c0-.484.403-.791 1.172-.842l1.37-.088v.534c0 .703-.637 1.245-1.458 1.245-.652 0-1.084-.322-1.084-.834Zm9.944 2.534c.49 0 .966-.044 1.237-.103v-1.853a5.19 5.19 0 0 1-.651.029c-.674 0-.982-.293-.982-.908v-3.428h1.633V9.554h-1.633V7.687h-2.6v1.867h-1.245v1.904h1.245v4.014c0 1.597.85 2.249 2.996 2.249Zm2.267-.015h2.593v-4.658c0-.938.498-1.575 1.34-1.575.879 0 1.282.557 1.282 1.546v4.687h2.593V12.44c0-1.956-.945-3.076-2.754-3.076-1.15 0-1.97.571-2.322 1.465h-.139V6.5h-2.593v11.206Zm12.719.19c2.615 0 3.611-1.53 3.846-2.504l.022-.088-2.373.007-.015.029c-.117.213-.564.711-1.428.711-.996 0-1.597-.674-1.619-1.839h5.486v-.747c0-2.49-1.56-4.101-4.014-4.101-2.461 0-4.021 1.633-4.021 4.262v.008c0 2.644 1.56 4.262 4.116 4.262Zm-.036-6.687c.805 0 1.377.52 1.501 1.495h-3.003c.125-.96.703-1.495 1.502-1.495Zm4.816 6.497h2.593v-4.314c0-1.128.71-1.78 1.926-1.78.366 0 .74.052 1.084.139V9.562a2.733 2.733 0 0 0-.879-.132c-1.04 0-1.757.52-1.992 1.421h-.139V9.554h-2.593v8.152Zm6.443 0h7.177v-2.161h-4.489V7.137h-2.688v10.569Zm10.36.125c1.04 0 1.912-.44 2.271-1.136h.139v1.011h2.549v-5.559c0-1.758-1.282-2.783-3.53-2.783-2.205 0-3.611.989-3.758 2.49l-.007.088h2.351l.015-.037c.154-.41.571-.637 1.252-.637.718 0 1.128.33 1.128.879v.637l-1.78.103c-2.102.132-3.259.988-3.259 2.468v.015c0 1.486 1.069 2.461 2.629 2.461Zm-.131-2.644v-.015c0-.484.402-.791 1.171-.842l1.37-.088v.534c0 .703-.637 1.245-1.457 1.245-.652 0-1.084-.322-1.084-.834Zm7.233 5.397c2.3 0 3.589-.82 4.336-3.142l2.571-7.888h-2.74l-1.45 5.911h-.154l-1.45-5.911h-2.863l2.783 8.152-.037.227c-.08.476-.527.747-1.304.747-.212 0-.424 0-.571-.007v1.904c.293.007.586.007.879.007Zm10.896-2.688c2.614 0 3.61-1.53 3.845-2.504l.022-.088-2.373.007-.015.029c-.117.213-.564.711-1.428.711-.996 0-1.597-.674-1.619-1.839h5.486v-.747c0-2.49-1.56-4.101-4.014-4.101-2.461 0-4.021 1.633-4.021 4.262v.008c0 2.644 1.56 4.262 4.117 4.262Zm-.037-6.687c.806 0 1.377.52 1.501 1.495h-3.003c.125-.96.704-1.495 1.502-1.495Zm4.816 6.497h2.593v-4.314c0-1.128.711-1.78 1.926-1.78.367 0 .74.052 1.084.139V9.562a2.733 2.733 0 0 0-.879-.132c-1.04 0-1.757.52-1.992 1.421h-.139V9.554h-2.593v8.152Zm9.468.19c2.212 0 3.735-1.083 3.735-2.775v-.008c0-1.223-.769-1.911-2.454-2.248l-1.406-.279c-.776-.161-1.025-.373-1.025-.739v-.015c0-.454.432-.725 1.076-.725.718 0 1.121.381 1.202.718l.014.051h2.373v-.037c-.044-1.303-1.23-2.475-3.589-2.475-2.19 0-3.581 1.018-3.581 2.644v.007c0 1.245.805 2.066 2.38 2.381l1.406.278c.74.154 1.018.373 1.018.754v.008c0 .439-.446.71-1.142.71-.754 0-1.165-.315-1.318-.732l-.015-.044h-2.52v.051c.162 1.421 1.429 2.475 3.846 2.475Z' style='fill:%23fff;fill-rule:nonzero' transform='translate(-2.33)'/%3E%3Cpath d='m6.107 9.12-2.749 1.193a.68.68 0 0 0-.408.628c0 .275.16.522.407.629l2.75 1.193-2.749 1.192a.684.684 0 0 0-.408.63c0 .275.16.521.407.628l6.213 2.696a1.103 1.103 0 0 0 .877 0l6.212-2.695a.683.683 0 0 0 .408-.629.682.682 0 0 0-.407-.629l-2.75-1.193 2.749-1.193a.683.683 0 0 0 .409-.629.68.68 0 0 0-.408-.628l-2.75-1.194-1.144.497 3.054 1.326-5.736 2.488a.181.181 0 0 1-.151 0l-5.736-2.489 3.054-1.325-1.144-.496Zm9.713 5.465-5.736 2.489a.189.189 0 0 1-.151 0l-5.736-2.49 3.054-1.325 2.319 1.006a1.09 1.09 0 0 0 .877 0l2.319-1.006 3.054 1.326Zm-2.289-7.966c-.011.04-.039.066-.083.079l-1.207.378v1.206a.122.122 0 0 1-.054.103.128.128 0 0 1-.12.016L10.86 8.03l-.744.978a.13.13 0 0 1-.107.051.134.134 0 0 1-.108-.051l-.744-.978-1.207.371c-.038.015-.078.01-.12-.016a.121.121 0 0 1-.053-.103V7.076l-1.208-.378c-.044-.013-.071-.039-.082-.079-.014-.045-.008-.083.016-.114l.744-.978-.744-.977a.121.121 0 0 1-.016-.114c.011-.04.038-.066.082-.079l1.208-.378V2.773c0-.042.017-.077.053-.103.042-.026.082-.032.12-.016l1.207.371.744-.978A.131.131 0 0 1 10.009 2c.047 0 .083.016.107.047l.744.978 1.207-.371c.039-.016.079-.01.12.016a.122.122 0 0 1 .054.103v1.206l1.207.378c.044.013.072.039.083.079a.119.119 0 0 1-.017.114l-.744.977.744.978c.025.031.031.069.017.114M12.39 5.527c0-.307-.063-.601-.188-.88a2.287 2.287 0 0 0-1.269-1.21 2.422 2.422 0 0 0-.924-.18c-.323 0-.631.06-.924.18a2.284 2.284 0 0 0-1.269 1.21 2.115 2.115 0 0 0-.188.88c0 .308.062.602.188.881a2.284 2.284 0 0 0 1.269 1.21c.293.12.601.18.924.18.322 0 .63-.06.924-.18a2.287 2.287 0 0 0 1.269-1.21c.125-.279.188-.573.188-.881' style='fill:none;fill-rule:nonzero;stroke:%23000;stroke-opacity:.3;stroke-width:2.4px' transform='matrix(1.25 0 0 1.25 -2.188 -1)'/%3E%3Cpath d='m6.107 9.12-2.749 1.193a.68.68 0 0 0-.408.628c0 .275.16.522.407.629l2.75 1.193-2.749 1.192a.684.684 0 0 0-.408.63c0 .275.16.521.407.628l6.213 2.696a1.103 1.103 0 0 0 .877 0l6.212-2.695a.683.683 0 0 0 .408-.629.682.682 0 0 0-.407-.629l-2.75-1.193 2.749-1.193a.683.683 0 0 0 .409-.629.68.68 0 0 0-.408-.628l-2.75-1.194-1.144.497 3.054 1.326-5.736 2.488a.181.181 0 0 1-.151 0l-5.736-2.489 3.054-1.325-1.144-.496Zm9.713 5.465-5.736 2.489a.189.189 0 0 1-.151 0l-5.736-2.49 3.054-1.325 2.319 1.006a1.09 1.09 0 0 0 .877 0l2.319-1.006 3.054 1.326Zm-2.289-7.966c-.011.04-.039.066-.083.079l-1.207.378v1.206a.122.122 0 0 1-.054.103.128.128 0 0 1-.12.016L10.86 8.03l-.744.978a.13.13 0 0 1-.107.051.134.134 0 0 1-.108-.051l-.744-.978-1.207.371c-.038.015-.078.01-.12-.016a.121.121 0 0 1-.053-.103V7.076l-1.208-.378c-.044-.013-.071-.039-.082-.079-.014-.045-.008-.083.016-.114l.744-.978-.744-.977a.121.121 0 0 1-.016-.114c.011-.04.038-.066.082-.079l1.208-.378V2.773c0-.042.017-.077.053-.103.042-.026.082-.032.12-.016l1.207.371.744-.978A.131.131 0 0 1 10.009 2c.047 0 .083.016.107.047l.744.978 1.207-.371c.039-.016.079-.01.12.016a.122.122 0 0 1 .054.103v1.206l1.207.378c.044.013.072.039.083.079a.119.119 0 0 1-.017.114l-.744.977.744.978c.025.031.031.069.017.114M12.39 5.527c0-.307-.063-.601-.188-.88a2.287 2.287 0 0 0-1.269-1.21 2.422 2.422 0 0 0-.924-.18c-.323 0-.631.06-.924.18a2.284 2.284 0 0 0-1.269 1.21 2.115 2.115 0 0 0-.188.88c0 .308.062.602.188.881a2.284 2.284 0 0 0 1.269 1.21c.293.12.601.18.924.18.322 0 .63-.06.924-.18a2.287 2.287 0 0 0 1.269-1.21c.125-.279.188-.573.188-.881' style='fill:%23fff;fill-rule:nonzero' transform='matrix(1.25 0 0 1.25 -2.188 -1)'/%3E%3C/g%3E%3C/svg%3E");display:inline-block;height:23px;margin:-1.5px;vertical-align:middle;width:131px}`);class ld extends ge{constructor(t={}){super(),this._container=void 0,this._config=t}onAdd(){return this._container=document.createElement("div"),this._container.classList.add("weatherlayers-logo-control"),this.setConfig(this._config),this._container}onRemove(){this._container&&this._container.parentNode&&(this._container.parentNode.removeChild(this._container),this._container=void 0)}getConfig(){return{...this._config}}setConfig(t){if(!this._container)return;this._config=t,this._container.innerHTML="";const e=document.createElement("a");e.href="https://weatherlayers.com",e.target="_blank",e.ariaLabel="WeatherLayers",this._container.appendChild(e)}}export{Yl as Animation,cd as AttributionControl,Io as ContourLayer,Ju as DATETIME,Xl as DEFAULT_ICON_COLOR,Hu as DEFAULT_ICON_SIZE,Ls as DEFAULT_LINE_COLOR,Ku as DEFAULT_LINE_WIDTH,qi as DEFAULT_TEXT_COLOR,Ji as DEFAULT_TEXT_FONT_FAMILY,Ms as DEFAULT_TEXT_FORMAT_FUNCTION,Ki as DEFAULT_TEXT_OUTLINE_COLOR,Yu as DEFAULT_TEXT_OUTLINE_WIDTH,Xu as DEFAULT_TEXT_SIZE,It as DirectionFormat,_s as DirectionType,So as FrontLayer,ot as FrontType,Mo as GridLayer,Di as GridStyle,Bo as HighLowLayer,ut as ImageInterpolation,tt as ImageType,sd as LegendControl,ld as LogoControl,jo as ParticleLayer,rt as Placement,mo as RasterLayer,ad as TimelineControl,rd as TooltipControl,nd as UnitSystem,Zu as VERSION,qo as colorRampCanvas,G as ensureDefaultProps,Zn as formatDatetime,Kl as formatDirection,Ss as formatUnit,Zi as formatValue,ql as formatValueWithUnit,ed as getClosestEndDatetime,td as getClosestStartDatetime,iu as getDatetimeWeight,od as getRasterMagnitudeData,ou as getRasterPoints,eu as interpolateDatetime,$u as loadJson,Os as loadTextureData,jn as offsetDatetime,id as offsetDatetimeRange,Jt as parsePalette,qu as setLibrary};
